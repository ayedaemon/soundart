import{r as We,P as De,s as Re,n as ye,d as m,c as R,Q as ie,A as p,f as _,g as C,k as w,m as Ee,x as hs,R as zs,C as Te,v as Me,S as $,b as re,e as c,i as Ls,T as ne,j as L,h as K,l as A,t as Z,U as wt,V as kt,W as Pt,X as zt,B as Ye,Y as Le}from"../chunks/CR7RWmmG.js";import{a as J,t as ee,S as Ne,i as Oe,g as Xe,c as Ke,d as de,m as ce,e as fe,b as he,f as Ae}from"../chunks/YapMt7o9.js";import{d as ut,w as Pe}from"../chunks/D5cg-Vx1.js";function je(t){return t?.length!==void 0?t:Array.from(t)}function ps(t,e){ee(t,1,1,()=>{e.delete(t.key)})}function ms(t,e,s,l,i,a,r,n,o,u,d,f){let g=t.length,k=a.length,h=g;const b={};for(;h--;)b[t[h].key]=h;const v=[],T=new Map,M=new Map,y=[];for(h=k;h--;){const F=f(i,a,h),z=s(F);let U=r.get(z);U?y.push(()=>U.p(F,e)):(U=u(z,F),U.c()),T.set(z,v[h]=U),z in b&&M.set(z,Math.abs(h-b[z]))}const S=new Set,I=new Set;function P(F){J(F,1),F.m(n,d),r.set(F.key,F),d=F.first,k--}for(;g&&k;){const F=v[k-1],z=t[g-1],U=F.key,N=z.key;F===z?(d=F.first,g--,k--):T.has(N)?!r.has(U)||S.has(U)?P(F):I.has(N)?g--:M.get(U)>M.get(N)?(I.add(U),P(F)):(S.add(N),g--):(o(z,r),g--)}for(;g--;){const F=t[g];T.has(F.key)||o(F,r)}for(;k;)P(v[k-1]);return We(y),v}const Lt=8,xe={energy:0,treble:1,bass:2,mids:3,highs:4,lows:5,beat:6};function lt(t,e,s){return t+(e-t)*s}function As(t,e,s){return Math.min(Math.max(t,e),s)}class Ds{context=null;analyser=null;source=null;freqData=null;stream=null;sharedBuffer=null;sharedFloatView=null;energy=0;treble=0;highs=0;mids=0;lows=0;bass=0;beatValue=0;beatCutoff=0;beatHold=0;smoothing=.3;beatFalloff=2.4;beatMin=.15;beatDecay=.98;beatHoldTime=.08;async init(e=2048){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});const s=window.AudioContext||window.webkitAudioContext;this.context=new s,this.source=this.context.createMediaStreamSource(this.stream),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=e,this.analyser.smoothingTimeConstant=.8,this.source.connect(this.analyser),this.freqData=new Uint8Array(this.analyser.frequencyBinCount);let l=!1;try{l=typeof window<"u"&&window.crossOriginIsolated&&typeof window.SharedArrayBuffer<"u"}catch{}if(l)try{const i=(Lt+this.analyser.frequencyBinCount)*4,a=window.SharedArrayBuffer;return this.sharedBuffer=new a(i),this.sharedFloatView=new Float32Array(this.sharedBuffer),this.sharedBuffer}catch(i){return console.error("[AudioAnalyzer] Failed to create SharedArrayBuffer despite checks:",i),null}else return console.warn("[AudioAnalyzer] SharedArrayBuffer not supported or not isolated, falling back to message passing"),null}catch(s){return console.error("Failed to initialize audio:",s),null}}dispose(){this.source&&(this.source.disconnect(),this.source=null),this.context&&(this.context.close(),this.context=null),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.analyser=null,this.freqData=null,this.sharedBuffer=null,this.sharedFloatView=null}update(e){if(!this.analyser||!this.freqData)return this.getEmptyMetrics();this.analyser.getByteFrequencyData(this.freqData);const s=this.freqData.length,i=(this.context?.sampleRate||44100)/this.analyser.fftSize,a=120,r=200,n=2e3,o=6e3,u=Math.max(2,Math.floor(a/i)),d=Math.max(u+1,Math.floor(r/i)),f=Math.max(d+1,Math.floor(n/i)),g=Math.max(f+1,Math.floor(o/i)),k=Math.min(s-1,d),h=Math.min(s-1,f),b=Math.min(s-1,g);let v=0,T=0,M=0,y=0,S=0,I=0;for(let B=0;B<s;B++){const Q=this.freqData[B];v+=Q,this.sharedFloatView&&(this.sharedFloatView[Lt+B]=Q/255),B<u&&(T+=Q),B<k?M+=Q:B<h?y+=Q:B<b?S+=Q:I+=Q}const P=v/(s*255),F=T/(Math.max(1,u)*255),z=M/(Math.max(1,k)*255),U=y/(Math.max(1,h-k)*255),N=S/(Math.max(1,b-h)*255),O=I/(Math.max(1,s-b)*255);this.energy=lt(this.energy,P,this.smoothing),this.treble=lt(this.treble,O,this.smoothing),this.highs=lt(this.highs,N,this.smoothing),this.mids=lt(this.mids,U,this.smoothing),this.lows=lt(this.lows,z,this.smoothing),this.bass=lt(this.bass,F,this.smoothing);const x=Math.max(0,e);return this.beatValue=Math.max(0,this.beatValue-x*this.beatFalloff),z>this.beatCutoff&&z>this.beatMin&&(this.beatValue=As(z*1.5,0,1),this.beatCutoff=z*1.1,this.beatHold=this.beatHoldTime),this.beatHold>0?this.beatHold-=x:this.beatCutoff=Math.max(this.beatMin,this.beatCutoff-x*this.beatDecay),this.sharedFloatView&&(this.sharedFloatView[xe.energy]=this.energy,this.sharedFloatView[xe.treble]=this.treble,this.sharedFloatView[xe.bass]=this.bass,this.sharedFloatView[xe.mids]=this.mids,this.sharedFloatView[xe.highs]=this.highs,this.sharedFloatView[xe.lows]=this.lows,this.sharedFloatView[xe.beat]=this.beatValue),{energy:this.energy,treble:this.treble,highs:this.highs,mids:this.mids,lows:this.lows,bass:this.bass,beat:this.beatValue}}getEmptyMetrics(){return{energy:0,treble:0,highs:0,mids:0,lows:0,bass:0,beat:0}}isInitialized(){return this.analyser!==null}}const Vs={energy:0,treble:0,bass:0,mids:0,highs:0,lows:0,beat:0};class Fs{analyzer=null;sharedBuffer=null;enabled=!1;async enable(e=2048){if(this.analyzer||(this.analyzer=new Ds),this.analyzer.isInitialized())return this.enabled=!0,!0;const s=await this.analyzer.init(e);return this.sharedBuffer=s??null,this.enabled=this.analyzer.isInitialized(),this.enabled}disable(){this.analyzer&&(this.analyzer.dispose(),this.analyzer=null),this.sharedBuffer=null,this.enabled=!1}update(e){return!this.analyzer||!this.analyzer.isInitialized()?Vs:this.analyzer.update(e)}getSharedBuffer(){return this.sharedBuffer}isEnabled(){return this.enabled}usesSharedBuffer(){return this.sharedBuffer!==null}}function Bs(t){return new Worker(""+new URL("../workers/render.worker-DbWpsnS3.js",import.meta.url).href,{name:t?.name})}class Rs{worker;constructor(e){this.worker=e}postMessage(e,s){s?this.worker.postMessage(e,s):this.worker.postMessage(e)}onMessage(e){this.worker.onmessage=s=>{e(s.data)}}terminate(){this.worker.terminate()}}const Ns={energy:0,treble:0,bass:0,mids:0,highs:0,lows:0,beat:0},Os={sensitivity:1,highsBoost:1,midsBoost:1,lowsBoost:1,trebleBoost:1,bassBoost:1,beatBoost:1,minMotion:.02,beatGate:.35,autoEnabled:!1,autoStrength:.4,autoDecay:.6,autoTarget:"all"},vs=Pe(Ns),Se=Pe(Os),pt=Pe(!1),bs=Pe(0);function ze(t,e,s){return Math.min(Math.max(t,e),s)}const St=ut([vs,Se,bs],([t,e,s])=>{const l=ze(e.sensitivity,0,2);let i=ze(t.energy*l,0,2),a=ze(t.treble*l*e.trebleBoost,0,2),r=ze(t.beat*l*e.beatBoost*e.bassBoost,0,2);const n=(e.highsBoost+e.midsBoost+e.lowsBoost)/3;if(i*=n,i=Math.max(i,e.minMotion),a=Math.max(a,e.minMotion),r=Math.max(r,e.minMotion),e.autoEnabled&&s>0){const o=s*e.autoStrength;switch(e.autoTarget){case"energy":i+=o;break;case"treble":a+=o;break;case"beat":r+=o;break;default:i+=o,a+=o,r+=o}}return{energy:ze(i,0,2),treble:ze(a,0,2),beat:ze(r,0,2),raw:{highs:ze(t.highs*l,0,2),mids:ze(t.mids*l,0,2),lows:ze(t.lows*l,0,2),treble:ze(t.treble*l,0,2),bass:ze(t.bass*l,0,2),beat:ze(t.beat*l,0,2)}}}),Us={position:{x:.5,y:.5},velocity:{x:0,y:0},speed:0,isDown:!1,clickPosition:{x:.5,y:.5},isInside:!1},ct=Pe(Us),At=.15,Hs=.1;let it={x:0,y:0},bt=0;function Je(t,e,s){return Math.min(Math.max(t,e),s)}const Gs=ut(ct,t=>(it.x+=(t.velocity.x-it.x)*At,it.y+=(t.velocity.y-it.y)*At,bt+=(t.speed-bt)*Hs,{x:t.position.x,y:t.position.y,velocityX:Je(it.x,-1,1),velocityY:Je(it.y,-1,1),speed:Je(bt,0,1),down:t.isDown?1:0,clickX:t.clickPosition.x,clickY:t.clickPosition.y,inside:t.isInside?1:0}));function js(t,e,s,l){ct.update(i=>{const a=Je((t-s.left)/s.width,0,1),r=Je((e-s.top)/s.height,0,1),n=Math.max(l,1),o=(a-i.position.x)/n*16.67,u=(r-i.position.y)/n*16.67,d=Math.sqrt(o*o+u*u);return{...i,position:{x:a,y:r},velocity:{x:o,y:u},speed:Je(d*10,0,1),isInside:!0}})}function Ys(t,e,s){ct.update(l=>{const i=Je((t-s.left)/s.width,0,1),a=Je((e-s.top)/s.height,0,1);return{...l,isDown:!0,clickPosition:{x:i,y:a}}})}function Ws(){ct.update(t=>({...t,isDown:!1}))}function Xs(){ct.update(t=>({...t,isInside:!1,velocity:{x:0,y:0},speed:0}))}const Ks={dark:.2,medium:.5,bright:1},Ge={auto:{targetFps:60,resolutionScale:1,maxActiveLayers:7,qualityLevel:1,feedbackEnabled:!0,audioFftSize:2048,audioSensitivity:1,audioAutoEnabled:!0,randomizerCooldown:2,randomizerMode:"flow",strobeMode:"flash",label:"Auto",icon:"üîÑ"},desktop:{targetFps:60,resolutionScale:1,maxActiveLayers:7,qualityLevel:1,feedbackEnabled:!0,audioFftSize:2048,audioSensitivity:1,audioAutoEnabled:!0,randomizerCooldown:2,randomizerMode:"flow",strobeMode:"flash",label:"Desktop",icon:"üñ•Ô∏è"},laptop:{targetFps:30,resolutionScale:.75,maxActiveLayers:5,qualityLevel:.6,feedbackEnabled:!0,audioFftSize:1024,audioSensitivity:1.2,audioAutoEnabled:!0,randomizerCooldown:3,randomizerMode:"flow",strobeMode:"pulse",label:"Laptop",icon:"üíª"},mobile:{targetFps:24,resolutionScale:.5,maxActiveLayers:3,qualityLevel:.3,feedbackEnabled:!1,audioFftSize:1024,audioSensitivity:1.5,audioAutoEnabled:!1,randomizerCooldown:4,randomizerMode:"subtle",strobeMode:"drift",label:"Mobile",icon:"üì±"}},Zs={isMobile:!1,isLowEnd:!1,cpuCores:4,deviceMemory:null,detectedPreset:"auto"},tt=Pe(Zs);function Qs(){const t=navigator.userAgent,e=/Android|iPhone|iPad|iPod/i.test(t)||navigator.maxTouchPoints>1&&/Macintosh/i.test(t),s=navigator.hardwareConcurrency||4,l=navigator.deviceMemory||null,i=window.innerWidth;let a="desktop";if(e)s>=6&&l&&l>=6?a="laptop":a="mobile";else{const r=s<4||l!==null&&l<4,n=s>=4&&s<8||l!==null&&l>=4&&l<8,o=s>=8&&(l===null||l>=8),u=i<1280,d=i>=1920;r||n&&u?a="laptop":o&&d?a="desktop":n?a="laptop":a="desktop"}tt.set({isMobile:e,isLowEnd:s<4||l!==null&&l<4,cpuCores:s,deviceMemory:l,detectedPreset:a})}const $s={panelsVisible:!0,fullscreen:!1,pipEnabled:!1,devicePreset:"auto",autoApplyPreset:!0,targetFps:60,resolutionScale:1,maxActiveLayers:7,feedbackEnabled:!0,randomizerCooldown:2,randomizerToggleChance:.3,randomizerMode:"flow",strobeMode:"flash",powerSaverEnabled:!1,cameraEnabled:!1},ge=Pe($s),gs=Pe(1),ys=Pe(1);function Dt(t){gs.update(e=>Math.max(.1,Math.min(5,e+t)))}function Vt(t){ys.update(e=>Math.max(.1,Math.min(5,e+t)))}function Js(){ge.update(t=>({...t,panelsVisible:!t.panelsVisible}))}function Mt(t){if(t==="auto"){const s=De(tt).detectedPreset,l=Ge[s];ge.update(i=>({...i,devicePreset:"auto",autoApplyPreset:!0,targetFps:l.targetFps,resolutionScale:l.resolutionScale,maxActiveLayers:l.maxActiveLayers,feedbackEnabled:l.feedbackEnabled,randomizerCooldown:l.randomizerCooldown,randomizerMode:l.randomizerMode,strobeMode:l.strobeMode})),Se.update(i=>({...i,sensitivity:l.audioSensitivity,autoEnabled:l.audioAutoEnabled}))}else{const e=Ge[t];ge.update(s=>({...s,devicePreset:t,autoApplyPreset:!1,targetFps:e.targetFps,resolutionScale:e.resolutionScale,maxActiveLayers:e.maxActiveLayers,feedbackEnabled:e.feedbackEnabled,randomizerCooldown:e.randomizerCooldown,randomizerMode:e.randomizerMode,strobeMode:e.strobeMode})),Se.update(s=>({...s,sensitivity:e.audioSensitivity,autoEnabled:e.audioAutoEnabled}))}}function _s(){De(tt);const t=["auto","desktop","laptop","mobile"],e=De(ge).devicePreset,l=(t.indexOf(e)+1)%t.length,i=t[l];Mt(i)}function ws(){ge.update(t=>{const e=["flow","chaos","subtle"],s=(e.indexOf(t.randomizerMode)+1)%e.length;return{...t,randomizerMode:e[s]}})}function ks(){ge.update(t=>{const e=["flash","pulse","drift"],s=(e.indexOf(t.strobeMode)+1)%e.length;return{...t,strobeMode:e[s]}})}const xs={enabled:!1,minConfidence:.6,smoothing:.7},el=Pe(null),tl=Pe(xs);ut([ge],([t])=>t.cameraEnabled);let et=[],ft=[];const sl=ut([el,tl],([t,e])=>{if(!t||!e.enabled)return et=[],ft=[],null;const s=e.smoothing;if(t.faces&&t.faces.length>0){const i=t.faces[0];if(et.length===0)et=[i];else{const a=et[0];et[0]={...i,center:{x:a.center.x*s+i.center.x*(1-s),y:a.center.y*s+i.center.y*(1-s)}}}}else et=[];ft=t.hands?.map((i,a)=>{const r=ft[a];return r?{...i,center:i.center?{x:r.center?.x?r.center.x*s+i.center.x*(1-s):i.center.x,y:r.center?.y?r.center.y*s+i.center.y*(1-s):i.center.y}:i.center}:i})||[];const l=ft.filter(i=>!i.gesture||!i.gestureIntensity?!0:i.gestureIntensity>=e.minConfidence);return{faces:et,hands:l}}),_e=(t,e,s,l,i,a,r=.01,n=!0,o,u)=>({id:t,label:e,type:"float",default:s,min:l,max:i,step:r,uniform:a,randomizable:n,randomMin:o,randomMax:u}),$e=(t,e,s,l,i,a,r=1,n=!0,o,u)=>({id:t,label:e,type:"int",default:s,min:l,max:i,step:r,uniform:a,randomizable:n,randomMin:o,randomMax:u}),ll=(t,e,s,l,i,a=!0)=>({id:t,label:e,type:"select",default:s,options:l,uniform:i,randomizable:a}),Ue=(t,e)=>{const s=`uLayer${t.charAt(0).toUpperCase()+t.slice(1)}`;return[_e("intensity","Intensity",.5,0,1,`${s}`),_e("speed","Speed",1,0,3,`${s}Speed`),_e("zoom","Zoom",1,.5,2,`${s}Zoom`),ll("theme","Theme",0,[],`${s}Theme`)]},Ce=[{id:"mandala",label:"Mandala",description:"Radial symmetries",properties:[...Ue("mandala"),$e("segments","Segments",6,4,32,"uLayerMandalaSegments"),_e("rotation","Rotation",.2,-1,1,"uLayerMandalaRotation"),{id:"symmetry",label:"Symmetry",type:"boolean",default:!0,uniform:"uLayerMandalaSymmetry",randomizable:!0,ui:{shortLabel:"Sym",tooltip:"Toggle mirrored symmetry on/off"}}],shaderPath:"layers/mandala.glsl",randomizable:!0},{id:"kaleidoscope",label:"Kaleidoscope",description:"Sacred geometry mirroring",properties:[...Ue("kaleidoscope"),$e("slices","Slices",6,6,24,"uLayerKaleidoscopeSlices"),_e("feedback","Feedback",.5,0,.95,"uLayerKaleidoscopeFeedback"),_e("distortion","Distortion",.5,0,2,"uLayerKaleidoscopeDistortion"),_e("raymarchMode","3D Mode",0,0,1,"uLayerKaleidoscopeRaymarchMode",.05,!0,0,.7)],shaderPath:"layers/kaleidoscope.glsl",randomizable:!0},{id:"metatron",label:"Metatron's Cube",description:"Sacred geometry with nested rings",properties:[...Ue("metatron"),$e("rings","Rings",2,1,10,"uLayerMetatronRings"),_e("thickness","Thickness",.008,.001,.02,"uLayerMetatronThickness",.001,!0,.003,.015),_e("spin","Spin",.5,-2,2,"uLayerMetatronSpin")],shaderPath:"layers/metatron.glsl",randomizable:!0},{id:"lissajous",label:"Lissajous",description:"Symmetric line trails",properties:[...Ue("lissajous"),{id:"frequencies",label:"Complexity",type:"float",default:3,min:1,max:10,step:.1,uniform:"uLayerLissajousFrequencies",randomizable:!0,randomMin:2,randomMax:8,ui:{shortLabel:"Cplx",tooltip:"Curve frequency ratio / knot complexity"}},{id:"slices",label:"Symmetry",type:"int",default:8,min:3,max:24,step:1,uniform:"uLayerLissajousSlices",randomizable:!0,randomMin:4,randomMax:16,ui:{shortLabel:"Sym",tooltip:"Kaleidoscope slices (higher = more symmetry)"}},{id:"damping",label:"Trail Decay",type:"float",default:.1,min:0,max:1,step:.01,uniform:"uLayerLissajousDamping",randomizable:!0,randomMin:0,randomMax:.8,ui:{shortLabel:"Decy",tooltip:"Higher = shorter trail"}},{id:"thickness",label:"Line Width",type:"float",default:.008,min:.001,max:.02,step:.001,uniform:"uLayerLissajousThickness",randomizable:!0,randomMin:.003,randomMax:.012,ui:{shortLabel:"Line",tooltip:"Line thickness"}}],shaderPath:"layers/lissajous.glsl",randomizable:!0},{id:"cymatics",label:"Cymatics",description:"Standing-wave nodal line patterns",properties:[...Ue("cymatics"),{id:"mode",label:"Pattern Style",type:"select",default:0,options:[{value:0,label:"Plate"},{value:1,label:"Radial"},{value:2,label:"Hybrid"}],uniform:"uLayerCymaticsMode",randomizable:!0,ui:{shortLabel:"Style",tooltip:"Plate = grid-like patterns, Radial = circular patterns, Hybrid = mix of both"}},{id:"m",label:"Pattern Detail",type:"int",default:5,min:1,max:16,step:1,uniform:"uLayerCymaticsM",randomizable:!0,randomMin:2,randomMax:12,ui:{shortLabel:"Detail",tooltip:"Higher = more intricate pattern with more lines"}},{id:"n",label:"Pattern Complexity",type:"int",default:8,min:1,max:16,step:1,uniform:"uLayerCymaticsN",randomizable:!0,randomMin:3,randomMax:16,ui:{shortLabel:"Cplx",tooltip:"Higher = more complex wave patterns"}},{id:"thickness",label:"Line Width",type:"float",default:.06,min:.005,max:.2,step:.001,uniform:"uLayerCymaticsThickness",randomizable:!0,randomMin:.02,randomMax:.12,ui:{shortLabel:"Width",tooltip:"Thickness of the pattern lines (thinner = more delicate)"}},{id:"sharpness",label:"Line Sharpness",type:"float",default:1.4,min:.35,max:4,step:.05,uniform:"uLayerCymaticsSharpness",randomizable:!0,randomMin:.7,randomMax:2.6,ui:{shortLabel:"Sharp",tooltip:"Higher = crisper, more defined lines (lower = softer, more blurred)"}},{id:"warp",label:"Flow Distortion",type:"float",default:.35,min:0,max:1,step:.01,uniform:"uLayerCymaticsWarp",randomizable:!0,randomMin:0,randomMax:.85,ui:{shortLabel:"Flow",tooltip:"Adds flowing, wavy distortion to the pattern (0 = straight lines, higher = more movement)"}}],shaderPath:"layers/cymatics.glsl",randomizable:!0},{id:"turbulence",label:"Turbulence",description:"Audio-reactive turbulence",properties:[...Ue("turbulence"),$e("complexity","Complexity",3,1,6,"uLayerTurbulenceComplexity"),_e("flow","Flow",.5,-1,1,"uLayerTurbulenceFlow")],shaderPath:"layers/turbulence.glsl",randomizable:!0},{id:"displacement",label:"Displacement",description:"Cellular displacement waves",properties:[...Ue("displacement"),_e("strength","Strength",.5,0,2,"uLayerDisplacementStrength"),_e("cellSize","Cell Size",1,.1,5,"uLayerDisplacementCellSize"),_e("ripple","Ripple",1,0,3,"uLayerDisplacementRipple")],shaderPath:"layers/displacement.glsl",randomizable:!0},{id:"glow",label:"Center Glow",description:"Pulsing core with arcs",properties:[...Ue("glow"),_e("coreSize","Core Size",.5,.1,2,"uLayerGlowCoreSize"),$e("ringCount","Ring Count",3,0,10,"uLayerGlowRingCount"),_e("arcIntensity","Arc Intensity",.5,0,10,"uLayerGlowArcIntensity")],shaderPath:"layers/glow.glsl",randomizable:!0},{id:"starfield",label:"Starfield",description:"Warp tunnel streaks",properties:[...Ue("starfield"),_e("density","Density",1,.1,3,"uLayerStarfieldDensity"),_e("warp","Warp",1,.1,5,"uLayerStarfieldWarp"),$e("layers","Layers",4,1,8,"uLayerStarfieldLayers")],shaderPath:"layers/starfield.glsl",randomizable:!0},{id:"hopalong",label:"Hopalong Orbits",description:"Barry Martin attractor with kaleidoscope splits",properties:[...Ue("hopalong"),_e("divergence","Divergence",1,.1,5,"uLayerHopalongDivergence"),$e("iterations","Iterations",5,1,10,"uLayerHopalongIterations"),$e("slices","Slices",1,1,16,"uLayerHopalongSlices",1,!0,1,12),_e("rotation","Rotation",0,-1,1,"uLayerHopalongRotation",.01,!0,-.5,.5)],shaderPath:"layers/hopalong.glsl",randomizable:!0},{id:"fractal",label:"Fractal Pattern",description:"Fractal patterns with palette-based coloring",properties:[...Ue("fractal"),_e("iterations","Iterations",3.5,1,5,"uLayerFractalIterations",.1,!0,2,4.5),_e("scale","Scale",1,.1,4,"uLayerFractalScale",.05,!0,.3,1.5),_e("power","Power",1.2,.5,2.5,"uLayerFractalPower",.05,!0,.8,1.8)],shaderPath:"layers/fractal.glsl",randomizable:!0}];function il(){const t=new Map;for(const e of Ce){const s={};for(const l of e.properties)s[l.id]=l.default;t.set(e.id,{id:e.id,enabled:!1,properties:s,includeInRandomizer:e.randomizable!==!1,includeInStrobe:e.randomizable!==!1})}return t}const ke=Pe(il());function gt(t,e,s){ke.update(l=>{const i=l.get(t);return i&&(i.properties[e]=s),l})}function Et(t){let e=0;for(const s of t.values())s.enabled&&e++;return e}function al(t,e){let s=!1;return ke.update(l=>{const i=l.get(t);if(i){if(!i.enabled&&e!==void 0&&Et(l)>=e)return l;if(i.enabled=!i.enabled,s=i.enabled,i.enabled){const r=Ce.find(n=>n.id===t)?.properties.find(n=>n.id==="intensity");r&&(i.properties.intensity=r.default)}}return l}),s}function nl(t){ke.update(e=>{const s=e.get(t);return s&&(s.includeInRandomizer=!s.includeInRandomizer),e})}function rl(t){ke.update(e=>{const s=e.get(t);return s&&(s.includeInStrobe=!s.includeInStrobe),e})}function ol(t){ke.update(e=>{for(const s of e.values())s.includeInRandomizer=t;return e})}function ul(t){ke.update(e=>{for(const s of e.values())s.includeInStrobe=t;return e})}function Ss(t,e){ke.update(s=>{let l=0;for(const i of s.values()){if(t&&e!==void 0&&l>=e){i.enabled=!1;continue}if(i.enabled=t,t&&l++,i.enabled){const r=Ce.find(n=>n.id===i.id)?.properties.find(n=>n.id==="intensity");r&&(i.properties.intensity=r.default)}}return s})}ut(ke,t=>Array.from(t.values()).map(e=>{const s={},l=Ce.find(i=>i.id===e.id);if(l)for(const i of l.properties){const a=e.properties[i.id];s[i.uniform]=typeof a=="boolean"?a?1:0:a}return{id:e.id,enabled:e.enabled,uniforms:s}}));const Ms=ut([ke,St,gs,ys],([t,e,s,l])=>{const i={};for(const a of Ce){const r=t.get(a.id);if(r)for(const n of a.properties){const o=r.properties[n.id]??n.default;let u=typeof o=="boolean"?o?1:0:o;n.id==="intensity"&&!r.enabled&&(u=0),n.id==="zoom"&&(u=u*s),n.id==="speed"&&(u=u*l),i[n.uniform]=u}}return i});class dl{bridge=null;resizeObserver=null;statsHandler=null;initialized=!1;usingSharedBuffer=!1;resolutionScale=1;canvas=null;subscriptions=[];init(e,s,l=1){if(this.initialized)return;this.canvas=e,this.resolutionScale=l;const i=e.transferControlToOffscreen(),a=new Bs;this.bridge=new Rs(a),this.usingSharedBuffer=!!s;const r=Math.min(window.devicePixelRatio||1,1.5)*l;this.bridge.postMessage({type:"INIT",canvas:i,audioBuffer:s,dpr:r,useFallback:!s},[i]),this.statsHandler&&this.bridge.onMessage(this.statsHandler),this.resizeObserver=new ResizeObserver(n=>{for(const o of n){const u=Math.min(window.devicePixelRatio||1,1.5)*this.resolutionScale;this.bridge?.postMessage({type:"RESIZE",width:o.contentRect.width,height:o.contentRect.height,dpr:u})}}),this.resizeObserver.observe(e),this.initialized=!0,this.setupStoreSubscriptions()}setupStoreSubscriptions(){this.bridge&&(this.subscriptions.push(St.subscribe(e=>{e&&this.bridge?.postMessage({type:"UPDATE_AUDIO",metrics:{beat:e.beat,energy:e.energy,treble:e.treble,bass:e.raw.bass,mids:e.raw.mids,highs:e.raw.highs,lows:e.raw.lows}})})),this.subscriptions.push(Gs.subscribe(e=>{e&&this.bridge?.postMessage({type:"UPDATE_MOUSE",mouse:{x:e.x,y:e.y,down:e.down,clickX:e.clickX,clickY:e.clickY,velocityX:e.velocityX,velocityY:e.velocityY,speed:e.speed,inside:e.inside}})})),this.subscriptions.push(sl.subscribe(e=>{e&&this.bridge?.postMessage({type:"UPDATE_GESTURES",gestures:{faces:e.faces||[],hands:e.hands||[]}})})),this.subscriptions.push(Ms.subscribe(e=>{})))}updateResolutionScale(e){if(this.resolutionScale!==e&&(this.resolutionScale=e,this.canvas&&this.bridge)){const s=this.canvas.getBoundingClientRect(),l=Math.min(window.devicePixelRatio||1,1.5)*e;this.bridge.postMessage({type:"RESIZE",width:s.width,height:s.height,dpr:l})}}updateQualityLevel(e){this.bridge?.postMessage({type:"UPDATE_QUALITY",quality:e})}updateFeedbackEnabled(e){this.bridge?.postMessage({type:"UPDATE_FEEDBACK",enabled:e})}postCameraFrame(e,s){this.bridge&&this.bridge.postMessage({type:"CAMERA_FRAME",bitmap:e,gestures:s},[e])}setAudioBuffer(e){!this.bridge||!e||this.usingSharedBuffer||(this.usingSharedBuffer=!0,this.bridge.postMessage({type:"SET_AUDIO_BUFFER",audioBuffer:e}))}updateMouse(e){this.bridge?.postMessage({type:"UPDATE_MOUSE",mouse:{x:e.x,y:e.y,down:e.down,clickX:e.clickX,clickY:e.clickY,velocityX:e.velocityX,velocityY:e.velocityY,speed:e.speed,inside:e.inside}})}updateConfig(e){this.bridge?.postMessage({type:"UPDATE_CONFIG",layers:e})}updateAudio(e){this.bridge?.postMessage({type:"UPDATE_AUDIO",metrics:e})}onStats(e){this.statsHandler=e,this.bridge&&this.bridge.onMessage(e)}usesSharedBuffer(){return this.usingSharedBuffer}dispose(){this.subscriptions.forEach(e=>e()),this.subscriptions=[],this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.bridge&&(this.bridge.terminate(),this.bridge=null),this.initialized=!1,this.usingSharedBuffer=!1}}const Ct=[{id:0,label:"LSD (Rainbow)",preview:"linear-gradient(90deg, #ff0000, #ff8800, #ffff00, #00ff00, #00ffff, #0088ff, #8800ff, #ff00ff)",brightness:"bright",temperature:"neutral",saturation:"high",family:"spectrum"},{id:1,label:"Sunset",preview:"linear-gradient(90deg, #ff2e1f, #ff8c1f, #ffd940)",brightness:"bright",temperature:"warm",saturation:"high",family:"fire"},{id:2,label:"Aurora",preview:"linear-gradient(90deg, #0dd9b3, #1a59ff, #8ce6ff)",brightness:"medium",temperature:"cool",saturation:"high",family:"ocean"},{id:3,label:"Ultraviolet",preview:"linear-gradient(90deg, #8c26ff, #ff33bf, #3366ff)",brightness:"medium",temperature:"cool",saturation:"high",family:"cosmic"},{id:4,label:"Neon",preview:"linear-gradient(90deg, #1aff73, #ff1ad9)",brightness:"bright",temperature:"neutral",saturation:"high",family:"neon"},{id:5,label:"Split Complement",preview:"linear-gradient(90deg, #14d1ff, #ff7333, #cc33ff)",brightness:"bright",temperature:"neutral",saturation:"high",family:"spectrum"},{id:6,label:"Analogous Cool",preview:"linear-gradient(90deg, #14e6bf, #268cff, #6640ff)",brightness:"medium",temperature:"cool",saturation:"high",family:"ocean"},{id:7,label:"Tetradic",preview:"linear-gradient(90deg, #ff4d59, #33e699, #4073ff, #ffd933)",brightness:"bright",temperature:"neutral",saturation:"high",family:"spectrum"},{id:8,label:"Pastel Triad",preview:"linear-gradient(90deg, #e6a3a3, #a3e6b8, #a3b8e6)",brightness:"medium",temperature:"neutral",saturation:"low",family:"twilight"},{id:9,label:"Bioluminescent",preview:"linear-gradient(90deg, #001426, #00a3cc, #4dff99, #004066)",brightness:"dark",temperature:"cool",saturation:"medium",family:"ocean"},{id:10,label:"Iridescent",preview:"linear-gradient(90deg, #1a004d, #0080a6, #e6338c, #ffcc33, #33e666)",brightness:"medium",temperature:"neutral",saturation:"medium",family:"twilight"},{id:11,label:"Chromatic",preview:"linear-gradient(90deg, #ff0066, #00ff88, #0066ff, #ff0066)",brightness:"bright",temperature:"neutral",saturation:"high",family:"neon"},{id:12,label:"Golden Liminal",preview:"linear-gradient(90deg, #ffbf4d, #d9738c, #664db3, #261a59)",brightness:"medium",temperature:"warm",saturation:"medium",family:"twilight"},{id:13,label:"OK Rainbow",preview:"linear-gradient(90deg, #ff6b8a, #e6a040, #8fbf40, #40bfbf, #6b8aff, #bf40bf)",brightness:"medium",temperature:"neutral",saturation:"medium",family:"spectrum"},{id:14,label:"Synesthetic",preview:"linear-gradient(90deg, #7733ff, #cc33cc, #ff33aa, #ff66cc)",brightness:"medium",temperature:"cool",saturation:"high",family:"cosmic"},{id:15,label:"Entropy",preview:"linear-gradient(90deg, #00ffff, #1a0033, #ff4d00, #00cc33)",brightness:"medium",temperature:"neutral",saturation:"high",family:"neon"},{id:16,label:"Velvet Depths",preview:"linear-gradient(90deg, #1f142e, #8c59a6, #e6d9f2, #402659)",brightness:"dark",temperature:"cool",saturation:"low",family:"cosmic"},{id:17,label:"Solar Flare",preview:"linear-gradient(90deg, #1a0000, #cc1a00, #ff9900, #ffffb3)",brightness:"bright",temperature:"warm",saturation:"high",family:"fire"},{id:18,label:"Void Pulse",preview:"linear-gradient(90deg, #000000, #660019, #cc3366, #000000)",brightness:"dark",temperature:"warm",saturation:"low",family:"cosmic"},{id:19,label:"Starless Night",preview:"linear-gradient(90deg, #050a14, #1a3a66, #050a14)",brightness:"dark",temperature:"cool",saturation:"low",family:"ocean"},{id:20,label:"Event Horizon",preview:"linear-gradient(90deg, #000000, #000000, #ff6619, #99ccff, #000000)",brightness:"dark",temperature:"neutral",saturation:"medium",family:"cosmic"},{id:21,label:"Cyberpunk",preview:"linear-gradient(90deg, #0d0221, #ff1493, #00ffff, #9400d3)",brightness:"medium",temperature:"cool",saturation:"high",family:"neon"},{id:22,label:"Crimson Mono",preview:"linear-gradient(90deg, #2a0a0a, #8b0000, #cd5c5c, #f5deb3)",brightness:"medium",temperature:"warm",saturation:"medium",family:"fire"},{id:23,label:"Earth Tones",preview:"linear-gradient(90deg, #cc7351, #9caf88, #a0522d, #b87333)",brightness:"medium",temperature:"warm",saturation:"medium",family:"earth"},{id:24,label:"True Complement",preview:"linear-gradient(90deg, #0066ff, #ff6600)",brightness:"bright",temperature:"neutral",saturation:"high",family:"spectrum"},{id:25,label:"Noir",preview:"linear-gradient(90deg, #000000, #333333, #666666, #ffffff, #00ffff)",brightness:"dark",temperature:"neutral",saturation:"low",family:"twilight"},{id:26,label:"Sepia",preview:"linear-gradient(90deg, #3d2314, #704214, #f5deb3, #faebd7)",brightness:"medium",temperature:"warm",saturation:"low",family:"twilight"}],cl={spectrum:[0,5,7,13,24],fire:[1,12,17,18,22],ocean:[2,6,9,19],cosmic:[3,14,16,18,20],neon:[4,11,15,21],twilight:[8,10,12,25,26],earth:[23]};function mt(t){return Ct.find(e=>e.id===t)}const Ft=Pe({lastChangeTime:0,cooldown:2}),Bt=2.5;function nt(t,e){return t+Math.random()*(e-t)}function rt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function yt(t){if(t.length===0)throw new Error("randomChoice called with empty array");return t[rt(0,t.length-1)]}function fl(t,e){let s=0;for(const[l,i]of t)if(i.enabled&&l!==e){const a=mt(i.properties.theme);a&&(s+=Ks[a.brightness])}return s}function hl(t){return Ct.filter(e=>t.includes(e.brightness))}function pl(t,e){const s={};for(const[a,r]of t)if(r.enabled&&a!==e){const n=mt(r.properties.theme);n&&(s[n.family]=(s[n.family]||0)+1)}let l=0,i=null;for(const[a,r]of Object.entries(s))r>l&&(l=r,i=a);return i}function Es(t,e){const s=fl(t,e),l=pl(t,e);let i;s>=Bt?i=["dark"]:s>=Bt-.5?i=["dark","medium"]:i=["dark","medium","bright"];const a=hl(i);if(a.length===0)return 0;if(l&&Math.random()<.5){const r=cl[l],n=a.filter(o=>r.includes(o.id));if(n.length>0)return yt(n).id}if(Math.random()<.3){const r=new Set;for(const[n,o]of t)if(o.enabled&&n!==e){const u=mt(o.properties.theme);u&&r.add(u.temperature)}if(r.size===1){const n=[...r][0];let o=null;if(n==="warm"?o="cool":n==="cool"&&(o="warm"),o){const u=a.filter(d=>d.temperature===o);if(u.length>0)return yt(u).id}}}return yt(a).id}function Cs(t){const e=mt(t);if(!e)return{min:.3,max:.7};switch(e.brightness){case"dark":return{min:.5,max:.9};case"medium":return{min:.3,max:.7};case"bright":return{min:.2,max:.5}}}function ml(t){const e=De(ge),s=De(Ft),l=performance.now()/1e3;let i=e.randomizerCooldown;if(e.randomizerMode==="chaos"&&(i*=.25),e.randomizerMode==="subtle"&&(i*=2.5),l-s.lastChangeTime<i)return;let a=.6;if(e.randomizerMode==="chaos"&&(a=.4),e.randomizerMode==="subtle"&&(a=.8),t<a)return;const r=De(ke),n=Ce.filter(d=>{if(d.requiresCamera&&!e.cameraEnabled)return!1;const f=r.get(d.id);return d.randomizable!==!1&&(f?.includeInRandomizer||f?.includeInStrobe)});if(n.length===0)return;const o=n[rt(0,n.length-1)];r.get(o.id)&&(ke.update(d=>{const f=d.get(o.id);if(!f)return d;if(f.includeInStrobe){let g=e.randomizerToggleChance;if(e.strobeMode==="pulse"&&(g=.8),e.strobeMode==="drift"&&(g=.05),Math.random()<g){if(!f.enabled&&Et(d)>=e.maxActiveLayers)return d;f.enabled=!f.enabled}}if(f.enabled&&f.includeInRandomizer){const g=Ce.find(h=>h.id===o.id);if(!g)return d;let k=1;e.randomizerMode==="flow"&&(k=.5),e.randomizerMode==="subtle"&&(k=.2);for(const h of g.properties)if(h.randomizable&&!(Math.random()>k)){if(h.id==="theme"){if(e.randomizerMode==="subtle"&&Math.random()>.1)continue;f.properties.theme=Es(d,o.id);continue}if(h.id==="intensity"){const b=Cs(f.properties.theme);f.properties.intensity=nt(b.min,b.max);continue}if(h.type==="boolean"){f.properties[h.id]=Math.random()<.5;continue}if(h.type==="select"){const b=h.options?.map(M=>M.value)??[];if(b.length===0)continue;const v=f.properties[h.id];let T=b[Math.floor(Math.random()*b.length)];if(b.length>1&&typeof v=="number"&&T===v){const M=b.indexOf(v),y=1+Math.floor(Math.random()*(b.length-1));T=b[(Math.max(0,M)+y)%b.length]}f.properties[h.id]=T;continue}if((h.type==="float"||h.type==="int")&&h.min!==void 0&&h.max!==void 0){const b=h.randomMin??h.min,v=h.randomMax??h.max,T=h.min,M=h.max;let y;if(h.type==="int"||h.step&&h.step>=1?y=rt(b,v):y=nt(b,v),e.randomizerMode!=="chaos"){const S=f.properties[h.id],I=e.randomizerMode==="subtle"?.1:.3,F=(v-b)*I,z=Math.max(T,Math.max(b,S-F)),U=Math.min(M,Math.min(v,S+F));h.step&&h.step>=1?y=rt(Math.floor(z),Math.ceil(U)):y=nt(z,U)}y=Math.max(T,Math.min(M,y)),f.properties[h.id]=y;continue}if(h.type==="boolean"){const b=f.properties[h.id],v=typeof b=="boolean"?!b:!h.default;f.properties[h.id]=v;continue}}}return d}),Ft.update(d=>({...d,lastChangeTime:l})))}function vl(t){const e=De(ge),s=Ce.find(l=>l.id===t);!s||s.randomizable===!1||ke.update(l=>{const i=l.get(t);if(!i)return l;const a=1;for(const r of s.properties)if(r.randomizable&&!(Math.random()>a)){if(r.id==="theme"){if(e.randomizerMode==="subtle"&&Math.random()>.1)continue;i.properties.theme=Es(l,t);continue}if(r.id==="intensity"){const n=Cs(i.properties.theme);i.properties.intensity=nt(n.min,n.max);continue}if(r.type==="boolean"){i.properties[r.id]=Math.random()<.5;continue}if(r.type==="select"){const n=r.options?.map(d=>d.value)??[];if(n.length===0)continue;const o=i.properties[r.id];let u=n[Math.floor(Math.random()*n.length)];if(n.length>1&&typeof o=="number"&&u===o){const d=n.indexOf(o),f=1+Math.floor(Math.random()*(n.length-1));u=n[(Math.max(0,d)+f)%n.length]}i.properties[r.id]=u;continue}if((r.type==="float"||r.type==="int")&&r.min!==void 0&&r.max!==void 0){const n=r.randomMin??r.min,o=r.randomMax??r.max,u=r.min,d=r.max;let f;if(r.type==="int"||r.step&&r.step>=1?f=rt(n,o):f=nt(n,o),e.randomizerMode!=="chaos"){const g=i.properties[r.id],k=e.randomizerMode==="subtle"?.1:.3,b=(o-n)*k,v=Math.max(u,Math.max(n,g-b)),T=Math.min(d,Math.min(o,g+b));r.step&&r.step>=1?f=rt(Math.floor(v),Math.ceil(T)):f=nt(v,T)}f=Math.max(u,Math.min(d,f)),i.properties[r.id]=f}}return l})}const bl={fps:0,frameTime:0,targetFps:60,cpuSavings:0,mode:"normal"},Is=Pe(bl);class gl{sensors=new Map;initializationPromises=new Map;register(e){if(this.sensors.has(e.id)){console.warn(`SensorRegistry: Sensor ${e.id} is already registered`);return}this.sensors.set(e.id,e)}get(e){return this.sensors.get(e)}async enable(e){const s=this.sensors.get(e);if(!s){console.warn(`SensorRegistry: Sensor ${e} not found`);return}if(!s.enabled){if(!this.initializationPromises.has(e)){const l=s.initialize().then(()=>{this.initializationPromises.delete(e)}).catch(i=>{throw this.initializationPromises.delete(e),console.error(`SensorRegistry: Failed to initialize sensor ${e}:`,i),i});this.initializationPromises.set(e,l)}await this.initializationPromises.get(e),await s.enable()}}disable(e){const s=this.sensors.get(e);s&&s.disable()}isEnabled(e){return this.sensors.get(e)?.enabled??!1}getRegisteredIds(){return Array.from(this.sensors.keys())}getEnabledIds(){return Array.from(this.sensors.entries()).filter(([e,s])=>s.enabled).map(([e])=>e)}disposeAll(){for(const e of this.sensors.values())e.dispose();this.sensors.clear(),this.initializationPromises.clear()}dispose(e){const s=this.sensors.get(e);s&&(s.dispose(),this.sensors.delete(e),this.initializationPromises.delete(e))}}const Rt=new gl;class yl{features=new Map;initializationPromises=new Map;register(e){if(this.features.has(e.id)){console.warn(`FeatureRegistry: Feature ${e.id} is already registered`);return}this.features.set(e.id,e)}get(e){return this.features.get(e)}async enable(e){const s=this.features.get(e);if(!s){console.warn(`FeatureRegistry: Feature ${e} not found`);return}if(!s.isEnabled()){for(const l of s.requires)Rt.isEnabled(l)||(console.warn(`FeatureRegistry: Feature ${e} requires sensor ${l} which is not enabled`),await Rt.enable(l));if(!this.initializationPromises.has(e)){const l=s.initialize().then(()=>{this.initializationPromises.delete(e)}).catch(i=>{throw this.initializationPromises.delete(e),console.error(`FeatureRegistry: Failed to initialize feature ${e}:`,i),i});this.initializationPromises.set(e,l)}await this.initializationPromises.get(e),await s.enable()}}disable(e){const s=this.features.get(e);s&&s.disable()}isEnabled(e){return this.features.get(e)?.isEnabled()??!1}getRegisteredIds(){return Array.from(this.features.keys())}getEnabledIds(){return Array.from(this.features.entries()).filter(([e,s])=>s.isEnabled()).map(([e])=>e)}updateAll(e){for(const s of this.features.values())s.isEnabled()&&s.update(e)}renderAll(){for(const e of this.features.values())e.isEnabled()&&e.render&&e.render()}disposeAll(){for(const e of this.features.values())e.dispose();this.features.clear(),this.initializationPromises.clear()}dispose(e){const s=this.features.get(e);s&&(s.dispose(),this.features.delete(e),this.initializationPromises.delete(e))}}const _l=new yl;class wl{frameTimes=new Map;startTime=0;frameCount=0;currentLayer=null;samplesPerLayer=60;isProfiling=!1;results=[];startProfiling(e){this.currentLayer=e,this.frameTimes.set(e,[]),this.frameCount=0,this.isProfiling=!0,this.startTime=performance.now()}recordFrame(){if(!this.isProfiling||!this.currentLayer)return;const e=performance.now(),s=e-this.startTime;this.startTime=e;const l=this.frameTimes.get(this.currentLayer)||[];l.push(s),this.frameTimes.set(this.currentLayer,l),this.frameCount++}isCurrentLayerComplete(){return this.frameCount>=this.samplesPerLayer}stopProfiling(){this.isProfiling=!1,this.currentLayer=null,this.frameCount=0}getLayerResult(e){const s=this.frameTimes.get(e);if(!s||s.length===0)return null;const l=s.reduce((u,d)=>u+d,0)/s.length,i=Math.min(...s),a=Math.max(...s),r=1e3/l,o=Ce.find(u=>u.id===e)?.label||e;return{layerId:e,layerName:o,avgFrameTime:l,minFrameTime:i,maxFrameTime:a,fps:r,relativeCost:0}}calculateRelativeCosts(){const e=[];for(const[l,i]of this.frameTimes.entries()){const a=this.getLayerResult(l);a&&e.push(a)}const s=Math.min(...e.map(l=>l.avgFrameTime));e.forEach(l=>{l.relativeCost=l.avgFrameTime/s}),e.sort((l,i)=>i.avgFrameTime-l.avgFrameTime),this.results=e}getResults(){return this.results}getMostExpensiveLayer(){return this.results.length===0?null:this.results[0]}reset(){this.frameTimes.clear(),this.results=[],this.currentLayer=null,this.isProfiling=!1,this.frameCount=0}isCurrentlyProfiling(){return this.isProfiling}getCurrentLayer(){return this.currentLayer}getProgress(){return this.isProfiling?this.frameCount/this.samplesPerLayer:0}}const qe=new wl,kl={isActive:!1,currentLayerIndex:-1,progress:0,results:[],savedLayerStates:null},ot=Pe(kl);async function Sl(){if(qe.isCurrentlyProfiling())return;const t=De(ke),e=new Map;for(const[l,i]of t.entries())e.set(l,i.enabled);qe.reset(),Ss(!1,void 0);const s=Ce[0];s&&(ke.update(l=>{const i=l.get(s.id);return i&&(i.enabled=!0),l}),qe.startProfiling(s.id),ot.set({isActive:!0,currentLayerIndex:0,progress:0,results:[],savedLayerStates:e}))}function Ts(){const t=De(ot);if(!t.isActive)return;qe.isCurrentlyProfiling()&&qe.stopProfiling(),qe.calculateRelativeCosts();const e=qe.getResults();t.savedLayerStates&&ke.update(s=>{for(const[l,i]of t.savedLayerStates.entries()){const a=s.get(l);a&&a.enabled!==i&&(a.enabled=i)}return s}),ot.set({isActive:!1,currentLayerIndex:-1,progress:0,results:e,savedLayerStates:null})}function Ml(){if(!qe.isCurrentlyProfiling())return;const t=qe.getCurrentLayer();if(!t)return;const e=qe.getProgress(),s=Ce.findIndex(l=>l.id===t);if(ot.update(l=>({...l,progress:e,currentLayerIndex:s})),qe.isCurrentLayerComplete()){const l=s+1;if(l<Ce.length){qe.stopProfiling();const i=Ce[l];ke.update(a=>{const r=a.get(t);return r&&(r.enabled=!1),a}),requestAnimationFrame(()=>{ke.update(a=>{const r=a.get(i.id);return r&&(r.enabled=!0),a}),qe.startProfiling(i.id),ot.update(a=>({...a,currentLayerIndex:l,progress:0}))})}else Ts()}}function El(t){let e,s,l;return{c(){e=w("canvas"),this.h()},l(i){e=_(i,"CANVAS",{class:!0,"aria-label":!0}),C(e).forEach(m),this.h()},h(){p(e,"class","visualizer-canvas svelte-1nin8xa"),p(e,"aria-label","Audio reactive canvas")},m(i,a){R(i,e,a),t[11](e),s||(l=[ie(e,"click",t[1]),ie(e,"touchend",t[2]),ie(e,"mousemove",t[3]),ie(e,"mousedown",t[4]),ie(e,"mouseup",t[5]),ie(e,"mouseleave",t[6])],s=!0)},p:ye,i:ye,o:ye,d(i){i&&m(e),t[11](null),s=!1,We(l)}}}const Cl=5e3,ht=32;function Il(t,e,s){let l,i,a,r;Ee(t,ge,q=>s(10,l=q)),Ee(t,Ms,q=>s(24,i=q)),Ee(t,ke,q=>s(25,a=q)),Ee(t,Se,q=>s(26,r=q));let n,o=null,u=null,d,f=0,g=0,k=0,h=0,b=0,v=null,T=null,M=null;function y(){v=document.createElement("canvas"),v.width=ht,v.height=ht,T=v.getContext("2d"),M=document.querySelector('link[rel="icon"]'),M||(M=document.createElement("link"),M.rel="icon",M.type="image/png",document.head.appendChild(M))}function S(q){if(!v||!T||!M||!n||q-k<Cl)return;k=q;const V=Math.min(n.width,n.height),Y=(n.width-V)/2,W=(n.height-V)/2;T.drawImage(n,Y,W,V,V,0,0,ht,ht);try{M.href=v.toDataURL("image/png")}catch{}}async function I(){u||(u=new Fs);let q=2048;if(l.devicePreset==="auto"){const W=De(tt).detectedPreset;q=Ge[W].audioFftSize}else q=Ge[l.devicePreset].audioFftSize;const V=await u.enable(q);return pt.set(V),V&&o?.setAudioBuffer(u.getSharedBuffer()),V}function P(){u&&(u.disable(),u=null),pt.set(!1)}function F(q){const V=1e3/l.targetFps,Y=l.targetFps<60;if(Y){const E=q-f;if(E<V){d=window.setTimeout(()=>requestAnimationFrame(F),V-E);return}}Y?d=window.setTimeout(()=>requestAnimationFrame(F),V):d=requestAnimationFrame(F);const W=(q-f)/1e3;if(f=q,b+=W,h++,u?.isEnabled()){const H=l.devicePreset==="desktop"||l.devicePreset==="auto"?1:2;if(h%H===0){const te=b,be=u.update(te);b=0,vs.set(be),o&&!o.usesSharedBuffer()&&o.updateAudio(be);const ve=r.beatGate,oe=be.beat>ve;bs.update(me=>{if(r.autoEnabled){if(oe)return 1;const se=.5+r.autoDecay*3.5;return Math.max(0,me-te*se)}return 0}),ml(be.beat)}}if(_l.updateAll(W),o){const E=Ce.map(H=>{const te=a.get(H.id);return{id:H.id,enabled:te?.enabled??!0,uniforms:i}});o.updateConfig(E)}S(q),qe.isCurrentlyProfiling()&&(qe.recordFrame(),Ml())}hs(()=>{if(n){s(9,o=new dl),o.onStats(Y=>{Y.type==="STATS"&&Is.update(W=>({...W,fps:Y.fps,frameTime:Y.frameTime}))});const V=u?.getSharedBuffer()??null;o.init(n,V,l.resolutionScale)}f=performance.now(),y(),d=requestAnimationFrame(F)}),zs(()=>{d&&(cancelAnimationFrame(d),clearTimeout(d)),o&&(o.dispose(),s(9,o=null)),u&&(u.disable(),u=null)});function z(){ge.update(q=>({...q,panelsVisible:!q.panelsVisible}))}let U=0;function N(q){const V=Date.now();V-U<300&&O(),U=V}async function O(){document.fullscreenElement?(await document.exitFullscreen(),ge.update(q=>({...q,fullscreen:!1}))):(await document.documentElement.requestFullscreen(),ge.update(q=>({...q,fullscreen:!0})))}function x(q){if(!n)return;const V=performance.now(),Y=V-g;g=V;const W=n.getBoundingClientRect();js(q.clientX,q.clientY,W,Y)}function B(q){if(!n)return;const V=n.getBoundingClientRect();Ys(q.clientX,q.clientY,V)}function Q(){Ws()}function G(){Xs()}function X(q){Te[q?"unshift":"push"](()=>{n=q,s(0,n)})}return t.$$.update=()=>{if(t.$$.dirty&1536&&o&&l.resolutionScale&&o.updateResolutionScale(l.resolutionScale),t.$$.dirty&1536&&o&&l.devicePreset){let q=1;if(l.devicePreset==="auto"){const Y=De(tt).detectedPreset;q=Ge[Y].qualityLevel}else q=Ge[l.devicePreset].qualityLevel;o.updateQualityLevel(q)}t.$$.dirty&1536&&o&&o.updateFeedbackEnabled(l.feedbackEnabled)},[n,z,N,x,B,Q,G,I,P,o,l,X]}class Tl extends Ne{constructor(e){super(),Oe(this,e,Il,El,Re,{enableMicrophone:7,disableMicrophone:8})}get enableMicrophone(){return this.$$.ctx[7]}get disableMicrophone(){return this.$$.ctx[8]}}function Nt(t){let e,s,l='<span class="panel-title svelte-1s13ndm">CONTROLS</span>',i,a,r,n,o,u,d,f,g='<span class="label">FULLSCR</span>',k,h,b,v,T=t[4].randomizerMode.toUpperCase()+"",M,y,S,I,P,F=t[4].strobeMode.toUpperCase()+"",z,U,N,O,x,B,Q,G,X,q,V='<span class="label">HELP</span>',Y,W,E='<kbd class="svelte-1s13ndm">‚Üë‚Üì</kbd> zoom <kbd class="svelte-1s13ndm">‚Üê‚Üí</kbd> speed <kbd class="svelte-1s13ndm">M</kbd> mic <kbd class="svelte-1s13ndm">F</kbd> full <kbd class="svelte-1s13ndm">P</kbd> preset <kbd class="svelte-1s13ndm">H</kbd> panels <kbd class="svelte-1s13ndm">?</kbd> help',H,te;function be(me,se){return me[5]?zl:me[12]?Pl:ql}let ve=be(t),oe=ve(t);return{c(){e=w("div"),s=w("div"),s.innerHTML=l,i=A(),a=w("div"),r=w("button"),n=w("span"),o=A(),u=w("span"),oe.c(),d=A(),f=w("button"),f.innerHTML=g,k=A(),h=w("button"),b=w("span"),v=Z("RND: "),M=Z(T),y=A(),S=w("button"),I=w("span"),P=Z("STR: "),z=Z(F),U=A(),N=w("button"),O=w("span"),x=Z(t[6]),B=A(),Q=Z(t[7]),X=A(),q=w("button"),q.innerHTML=V,Y=A(),W=w("div"),W.innerHTML=E,this.h()},l(me){e=_(me,"DIV",{class:!0});var se=C(e);s=_(se,"DIV",{class:!0,"data-svelte-h":!0}),ne(s)!=="svelte-i65zl2"&&(s.innerHTML=l),i=L(se),a=_(se,"DIV",{class:!0});var le=C(a);r=_(le,"BUTTON",{class:!0,title:!0});var pe=C(r);n=_(pe,"SPAN",{class:!0}),C(n).forEach(m),o=L(pe),u=_(pe,"SPAN",{class:!0});var we=C(u);oe.l(we),we.forEach(m),pe.forEach(m),d=L(le),f=_(le,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ne(f)!=="svelte-1xg66l0"&&(f.innerHTML=g),k=L(le),h=_(le,"BUTTON",{class:!0,title:!0});var Ze=C(h);b=_(Ze,"SPAN",{class:!0});var ue=C(b);v=K(ue,"RND: "),M=K(ue,T),ue.forEach(m),Ze.forEach(m),y=L(le),S=_(le,"BUTTON",{class:!0,title:!0});var D=C(S);I=_(D,"SPAN",{class:!0});var j=C(I);P=K(j,"STR: "),z=K(j,F),j.forEach(m),D.forEach(m),U=L(le),N=_(le,"BUTTON",{class:!0,"data-preset":!0,title:!0});var ae=C(N);O=_(ae,"SPAN",{class:!0});var Ie=C(O);x=K(Ie,t[6]),B=L(Ie),Q=K(Ie,t[7]),Ie.forEach(m),ae.forEach(m),X=L(le),q=_(le,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ne(q)!=="svelte-17725cn"&&(q.innerHTML=V),le.forEach(m),Y=L(se),W=_(se,"DIV",{class:!0,title:!0,"data-svelte-h":!0}),ne(W)!=="svelte-12drq0y"&&(W.innerHTML=E),se.forEach(m),this.h()},h(){p(s,"class","panel-header svelte-1s13ndm"),p(n,"class","indicator svelte-1s13ndm"),$(n,"on",t[12]),p(u,"class","label"),p(r,"class","ctrl-btn mic svelte-1s13ndm"),r.disabled=t[5],p(r,"title","Enable microphone to let visuals react to music and sounds around you"),$(r,"active",t[12]),$(r,"loading",t[5]),p(f,"class","ctrl-btn svelte-1s13ndm"),p(f,"title","Enter or exit fullscreen mode for an immersive experience"),$(f,"active",t[4].fullscreen),p(b,"class","label"),p(h,"class","ctrl-btn svelte-1s13ndm"),p(h,"title","Randomizer preset: Flow / Chaos / Subtle"),p(I,"class","label"),p(S,"class","ctrl-btn svelte-1s13ndm"),p(S,"title","Strobe preset: Flash / Pulse / Drift"),p(O,"class","label"),p(N,"class","ctrl-btn device-preset svelte-1s13ndm"),p(N,"data-preset",t[2]),p(N,"title",G="Device preset: "+t[3].label+" ("+t[3].targetFps+"fps, "+Math.round(t[3].resolutionScale*100)+"% res, max "+t[3].maxActiveLayers+" layers, quality "+Math.round(t[3].qualityLevel*100)+"%)"),$(N,"active",t[11]),$(N,"desktop",t[10]),$(N,"laptop",t[9]),$(N,"mobile",t[8]),p(q,"class","ctrl-btn svelte-1s13ndm"),p(q,"title","Show help and information (press ?)"),p(a,"class","controls-grid svelte-1s13ndm"),p(W,"class","panel-footer svelte-1s13ndm"),p(W,"title","Keyboard shortcuts for quick access"),p(e,"class","panel controls-panel svelte-1s13ndm")},m(me,se){R(me,e,se),c(e,s),c(e,i),c(e,a),c(a,r),c(r,n),c(r,o),c(r,u),oe.m(u,null),c(a,d),c(a,f),c(a,k),c(a,h),c(h,b),c(b,v),c(b,M),c(a,y),c(a,S),c(S,I),c(I,P),c(I,z),c(a,U),c(a,N),c(N,O),c(O,x),c(O,B),c(O,Q),c(a,X),c(a,q),c(e,Y),c(e,W),H||(te=[ie(r,"click",t[13]),ie(f,"click",t[14]),ie(h,"click",ws),ie(S,"click",ks),ie(N,"click",_s),ie(q,"click",function(){Ls(t[0])&&t[0].apply(this,arguments)})],H=!0)},p(me,se){t=me,se&4096&&$(n,"on",t[12]),ve!==(ve=be(t))&&(oe.d(1),oe=ve(t),oe&&(oe.c(),oe.m(u,null))),se&32&&(r.disabled=t[5]),se&4096&&$(r,"active",t[12]),se&32&&$(r,"loading",t[5]),se&16&&$(f,"active",t[4].fullscreen),se&16&&T!==(T=t[4].randomizerMode.toUpperCase()+"")&&re(M,T),se&16&&F!==(F=t[4].strobeMode.toUpperCase()+"")&&re(z,F),se&64&&re(x,t[6]),se&128&&re(Q,t[7]),se&4&&p(N,"data-preset",t[2]),se&8&&G!==(G="Device preset: "+t[3].label+" ("+t[3].targetFps+"fps, "+Math.round(t[3].resolutionScale*100)+"% res, max "+t[3].maxActiveLayers+" layers, quality "+Math.round(t[3].qualityLevel*100)+"%)")&&p(N,"title",G),se&2048&&$(N,"active",t[11]),se&1024&&$(N,"desktop",t[10]),se&512&&$(N,"laptop",t[9]),se&256&&$(N,"mobile",t[8])},d(me){me&&m(e),oe.d(),H=!1,We(te)}}}function ql(t){let e;return{c(){e=Z("MIC OFF")},l(s){e=K(s,"MIC OFF")},m(s,l){R(s,e,l)},d(s){s&&m(e)}}}function Pl(t){let e;return{c(){e=Z("MIC ON")},l(s){e=K(s,"MIC ON")},m(s,l){R(s,e,l)},d(s){s&&m(e)}}}function zl(t){let e;return{c(){e=Z("...")},l(s){e=K(s,"...")},m(s,l){R(s,e,l)},d(s){s&&m(e)}}}function Ll(t){let e,s=t[1]&&Nt(t);return{c(){s&&s.c(),e=Me()},l(l){s&&s.l(l),e=Me()},m(l,i){s&&s.m(l,i),R(l,e,i)},p(l,[i]){l[1]?s?s.p(l,i):(s=Nt(l),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i:ye,o:ye,d(l){l&&m(e),s&&s.d(l)}}}function Al(t,e,s){let l,i,a,r,n,o,u,d,f,g;Ee(t,pt,S=>s(12,f=S)),Ee(t,ge,S=>s(4,g=S));let{onEnableMic:k}=e,{onDisableMic:h}=e,{onShowInfo:b}=e,{visible:v=!0}=e,T=!1;async function M(){if(f){h();return}s(5,T=!0),await k(),s(5,T=!1)}async function y(){document.fullscreenElement?(await document.exitFullscreen(),ge.update(S=>({...S,fullscreen:!1}))):(await document.documentElement.requestFullscreen(),ge.update(S=>({...S,fullscreen:!0})))}return t.$$set=S=>{"onEnableMic"in S&&s(15,k=S.onEnableMic),"onDisableMic"in S&&s(16,h=S.onDisableMic),"onShowInfo"in S&&s(0,b=S.onShowInfo),"visible"in S&&s(1,v=S.visible)},t.$$.update=()=>{t.$$.dirty&16&&s(3,l=Ge[g.devicePreset]),t.$$.dirty&16&&s(2,i=g.devicePreset),t.$$.dirty&4&&s(11,a=i==="auto"),t.$$.dirty&4&&s(10,r=i==="desktop"),t.$$.dirty&4&&s(9,n=i==="laptop"),t.$$.dirty&4&&s(8,o=i==="mobile"),t.$$.dirty&8&&s(7,u=l.label.toUpperCase()),t.$$.dirty&8&&s(6,d=l.icon),t.$$.dirty&4},[b,v,i,l,g,T,d,u,o,n,r,a,f,M,y,k,h]}class Dl extends Ne{constructor(e){super(),Oe(this,e,Al,Ll,Re,{onEnableMic:15,onDisableMic:16,onShowInfo:0,visible:1})}}function Ot(t){let e,s=t[6](t[0])+"",l;return{c(){e=w("span"),l=Z(s),this.h()},l(i){e=_(i,"SPAN",{class:!0});var a=C(e);l=K(a,s),a.forEach(m),this.h()},h(){p(e,"class","slider-value svelte-c5l8zh")},m(i,a){R(i,e,a),c(e,l)},p(i,a){a&65&&s!==(s=i[6](i[0])+"")&&re(l,s)},d(i){i&&m(e)}}}function Vl(t){let e,s,l,i,a,r,n,o,u,d=t[5]&&Ot(t);return{c(){e=w("div"),s=w("div"),l=w("span"),i=Z(t[1]),a=A(),d&&d.c(),r=A(),n=w("input"),this.h()},l(f){e=_(f,"DIV",{class:!0});var g=C(e);s=_(g,"DIV",{class:!0});var k=C(s);l=_(k,"SPAN",{class:!0});var h=C(l);i=K(h,t[1]),h.forEach(m),a=L(k),d&&d.l(k),k.forEach(m),r=L(g),n=_(g,"INPUT",{type:!0,min:!0,max:!0,step:!0,"aria-label":!0,class:!0}),g.forEach(m),this.h()},h(){p(l,"class","slider-label svelte-c5l8zh"),p(s,"class","slider-header svelte-c5l8zh"),p(n,"type","range"),p(n,"min",t[2]),p(n,"max",t[3]),p(n,"step",t[4]),n.value=t[0],n.disabled=t[8],p(n,"aria-label",t[1]),p(n,"class","svelte-c5l8zh"),p(e,"class","slider svelte-c5l8zh"),$(e,"compact",t[7])},m(f,g){R(f,e,g),c(e,s),c(s,l),c(l,i),c(s,a),d&&d.m(s,null),c(e,r),c(e,n),o||(u=ie(n,"input",t[9]),o=!0)},p(f,[g]){g&2&&re(i,f[1]),f[5]?d?d.p(f,g):(d=Ot(f),d.c(),d.m(s,null)):d&&(d.d(1),d=null),g&4&&p(n,"min",f[2]),g&8&&p(n,"max",f[3]),g&16&&p(n,"step",f[4]),g&1&&(n.value=f[0]),g&256&&(n.disabled=f[8]),g&2&&p(n,"aria-label",f[1]),g&128&&$(e,"compact",f[7])},i:ye,o:ye,d(f){f&&m(e),d&&d.d(),o=!1,u()}}}function Fl(t,e,s){let{label:l}=e,{value:i}=e,{min:a=0}=e,{max:r=1}=e,{step:n=.01}=e,{showValue:o=!0}=e,{formatValue:u=h=>h.toFixed(2)}=e,{compact:d=!0}=e,{disabled:f=!1}=e;const g=wt();function k(h){const b=h.target;s(0,i=parseFloat(b.value)),g("input",i)}return t.$$set=h=>{"label"in h&&s(1,l=h.label),"value"in h&&s(0,i=h.value),"min"in h&&s(2,a=h.min),"max"in h&&s(3,r=h.max),"step"in h&&s(4,n=h.step),"showValue"in h&&s(5,o=h.showValue),"formatValue"in h&&s(6,u=h.formatValue),"compact"in h&&s(7,d=h.compact),"disabled"in h&&s(8,f=h.disabled)},[i,l,a,r,n,o,u,d,f,k]}class Be extends Ne{constructor(e){super(),Oe(this,e,Fl,Vl,Re,{label:1,value:0,min:2,max:3,step:4,showValue:5,formatValue:6,compact:7,disabled:8})}}function Bl(t){let e,s,l,i,a,r,n;return{c(){e=w("button"),s=w("span"),l=A(),i=w("span"),a=Z(t[1]),this.h()},l(o){e=_(o,"BUTTON",{class:!0,"aria-pressed":!0,type:!0});var u=C(e);s=_(u,"SPAN",{class:!0}),C(s).forEach(m),l=L(u),i=_(u,"SPAN",{class:!0});var d=C(i);a=K(d,t[1]),d.forEach(m),u.forEach(m),this.h()},h(){p(s,"class","toggle-indicator svelte-1qxicao"),p(i,"class","toggle-label svelte-1qxicao"),p(e,"class","toggle svelte-1qxicao"),p(e,"aria-pressed",t[0]),e.disabled=t[2],p(e,"type","button"),$(e,"checked",t[0]),$(e,"disabled",t[2]),$(e,"compact",t[3])},m(o,u){R(o,e,u),c(e,s),c(e,l),c(e,i),c(i,a),r||(n=ie(e,"click",t[4]),r=!0)},p(o,[u]){u&2&&re(a,o[1]),u&1&&p(e,"aria-pressed",o[0]),u&4&&(e.disabled=o[2]),u&1&&$(e,"checked",o[0]),u&4&&$(e,"disabled",o[2]),u&8&&$(e,"compact",o[3])},i:ye,o:ye,d(o){o&&m(e),r=!1,n()}}}function Rl(t,e,s){let{label:l}=e,{checked:i=!1}=e,{disabled:a=!1}=e,{compact:r=!0}=e;const n=wt();function o(){a||(s(0,i=!i),n("change",i))}return t.$$set=u=>{"label"in u&&s(1,l=u.label),"checked"in u&&s(0,i=u.checked),"disabled"in u&&s(2,a=u.disabled),"compact"in u&&s(3,r=u.compact)},[i,l,a,r,o]}class qs extends Ne{constructor(e){super(),Oe(this,e,Rl,Bl,Re,{label:1,checked:0,disabled:2,compact:3})}}function Ut(t,e,s){const l=t.slice();return l[8]=e[s],l}function Ht(t){let e;return{c(){e=w("span"),this.h()},l(s){e=_(s,"SPAN",{class:!0,style:!0}),C(e).forEach(m),this.h()},h(){p(e,"class","select-preview svelte-1weciec"),Ye(e,"background",t[2].find(t[6])?.preview)},m(s,l){R(s,e,l)},p(s,l){l&5&&Ye(e,"background",s[2].find(s[6])?.preview)},d(s){s&&m(e)}}}function Gt(t){let e,s=t[8].label+"",l,i;return{c(){e=w("option"),l=Z(s),this.h()},l(a){e=_(a,"OPTION",{});var r=C(e);l=K(r,s),r.forEach(m),this.h()},h(){e.__value=i=t[8].value,zt(e,e.__value)},m(a,r){R(a,e,r),c(e,l)},p(a,r){r&4&&s!==(s=a[8].label+"")&&re(l,s),r&4&&i!==(i=a[8].value)&&(e.__value=i,zt(e,e.__value))},d(a){a&&m(e)}}}function Nl(t){let e,s,l,i,a,r=t[2].find(t[5])?.preview,n,o,u,d,f=r&&Ht(t),g=je(t[2]),k=[];for(let h=0;h<g.length;h+=1)k[h]=Gt(Ut(t,g,h));return{c(){e=w("div"),s=w("span"),l=Z(t[1]),i=A(),a=w("div"),f&&f.c(),n=A(),o=w("select");for(let h=0;h<k.length;h+=1)k[h].c();this.h()},l(h){e=_(h,"DIV",{class:!0});var b=C(e);s=_(b,"SPAN",{class:!0});var v=C(s);l=K(v,t[1]),v.forEach(m),i=L(b),a=_(b,"DIV",{class:!0});var T=C(a);f&&f.l(T),n=L(T),o=_(T,"SELECT",{"aria-label":!0,class:!0});var M=C(o);for(let y=0;y<k.length;y+=1)k[y].l(M);M.forEach(m),T.forEach(m),b.forEach(m),this.h()},h(){p(s,"class","select-label svelte-1weciec"),p(o,"aria-label",t[1]),p(o,"class","svelte-1weciec"),p(a,"class","select-container svelte-1weciec"),p(e,"class","select-wrapper svelte-1weciec"),$(e,"compact",t[3])},m(h,b){R(h,e,b),c(e,s),c(s,l),c(e,i),c(e,a),f&&f.m(a,null),c(a,n),c(a,o);for(let v=0;v<k.length;v+=1)k[v]&&k[v].m(o,null);Pt(o,t[0]),u||(d=ie(o,"change",t[4]),u=!0)},p(h,[b]){if(b&2&&re(l,h[1]),b&5&&(r=h[2].find(h[5])?.preview),r?f?f.p(h,b):(f=Ht(h),f.c(),f.m(a,n)):f&&(f.d(1),f=null),b&4){g=je(h[2]);let v;for(v=0;v<g.length;v+=1){const T=Ut(h,g,v);k[v]?k[v].p(T,b):(k[v]=Gt(T),k[v].c(),k[v].m(o,null))}for(;v<k.length;v+=1)k[v].d(1);k.length=g.length}b&5&&Pt(o,h[0]),b&2&&p(o,"aria-label",h[1]),b&8&&$(e,"compact",h[3])},i:ye,o:ye,d(h){h&&m(e),f&&f.d(),kt(k,h),u=!1,d()}}}function Ol(t,e,s){let{label:l}=e,{value:i}=e,{options:a=[]}=e,{compact:r=!0}=e;const n=wt();function o(f){const g=f.target;s(0,i=isNaN(Number(g.value))?g.value:Number(g.value)),n("change",i)}const u=f=>f.value===i,d=f=>f.value===i;return t.$$set=f=>{"label"in f&&s(1,l=f.label),"value"in f&&s(0,i=f.value),"options"in f&&s(2,a=f.options),"compact"in f&&s(3,r=f.compact)},[i,l,a,r,o,u,d]}class Ps extends Ne{constructor(e){super(),Oe(this,e,Ol,Nl,Re,{label:1,value:0,options:2,compact:3})}}function Ul(t){let e,s,l,i,a,r,n,o,u;return{c(){e=w("div"),s=w("span"),l=Z(t[0]),i=A(),a=w("div"),r=w("div"),n=A(),o=w("span"),u=Z(t[1]),this.h()},l(d){e=_(d,"DIV",{class:!0});var f=C(e);s=_(f,"SPAN",{class:!0});var g=C(s);l=K(g,t[0]),g.forEach(m),i=L(f),a=_(f,"DIV",{class:!0});var k=C(a);r=_(k,"DIV",{class:!0,style:!0}),C(r).forEach(m),k.forEach(m),n=L(f),o=_(f,"SPAN",{class:!0});var h=C(o);u=K(h,t[1]),h.forEach(m),f.forEach(m),this.h()},h(){p(s,"class","level-label svelte-2vktfp"),p(r,"class","level-fill svelte-2vktfp"),Ye(r,"width",t[2]+"%"),p(a,"class","level-bar svelte-2vktfp"),p(o,"class","level-value svelte-2vktfp"),p(e,"class","level-meter svelte-2vktfp")},m(d,f){R(d,e,f),c(e,s),c(s,l),c(e,i),c(e,a),c(a,r),c(e,n),c(e,o),c(o,u)},p(d,[f]){f&1&&re(l,d[0]),f&4&&Ye(r,"width",d[2]+"%"),f&2&&re(u,d[1])},i:ye,o:ye,d(d){d&&m(e)}}}function Hl(t,e,s){let l,i,{label:a}=e,{value:r=0}=e,{max:n=1}=e;return t.$$set=o=>{"label"in o&&s(0,a=o.label),"value"in o&&s(3,r=o.value),"max"in o&&s(4,n=o.max)},t.$$.update=()=>{t.$$.dirty&24&&s(2,l=Math.min(100,r/n*100)),t.$$.dirty&8&&s(1,i=r.toFixed(2))},[a,i,l,r,n]}class at extends Ne{constructor(e){super(),Oe(this,e,Hl,Ul,Re,{label:0,value:3,max:4})}}function jt(t,e,s){const l=t.slice();return l[34]=e[s].definition,l[35]=e[s].state,l}function Yt(t,e,s){const l=t.slice();return l[38]=e[s],l}function Wt(t){let e,s,l,i,a,r,n,o="LAYERS",u,d,f,g,k,h,b,v="?",T,M,y,S,I,P,F,z,U,N,O,x,B=[],Q=new Map,G,X,q,V=t[5]&&Xt(t),Y=je(t[3]);const W=E=>E[34].id;for(let E=0;E<Y.length;E+=1){let H=jt(t,Y,E),te=W(H);Q.set(te,B[E]=$t(te,H))}return{c(){e=w("div"),s=w("div"),l=w("button"),i=w("span"),r=A(),n=w("span"),n.textContent=o,u=A(),d=w("span"),f=Z(t[2]),g=Z("/"),k=Z(t[1]),h=A(),b=w("button"),b.textContent=v,T=A(),V&&V.c(),M=A(),y=w("div"),S=w("button"),I=Z("All R"),F=A(),z=w("button"),U=Z("All S"),O=A(),x=w("div");for(let E=0;E<B.length;E+=1)B[E].c();this.h()},l(E){e=_(E,"DIV",{class:!0});var H=C(e);s=_(H,"DIV",{class:!0});var te=C(s);l=_(te,"BUTTON",{class:!0,title:!0,type:!0});var be=C(l);i=_(be,"SPAN",{class:!0}),C(i).forEach(m),be.forEach(m),r=L(te),n=_(te,"SPAN",{class:!0,title:!0,"data-svelte-h":!0}),ne(n)!=="svelte-1k3t9ew"&&(n.textContent=o),u=L(te),d=_(te,"SPAN",{class:!0,title:!0});var ve=C(d);f=K(ve,t[2]),g=K(ve,"/"),k=K(ve,t[1]),ve.forEach(m),h=L(te),b=_(te,"BUTTON",{class:!0,title:!0,type:!0,"data-svelte-h":!0}),ne(b)!=="svelte-bv0qfb"&&(b.textContent=v),te.forEach(m),T=L(H),V&&V.l(H),M=L(H),y=_(H,"DIV",{class:!0});var oe=C(y);S=_(oe,"BUTTON",{class:!0,title:!0,type:!0});var me=C(S);I=K(me,"All R"),me.forEach(m),F=L(oe),z=_(oe,"BUTTON",{class:!0,title:!0,type:!0});var se=C(z);U=K(se,"All S"),se.forEach(m),oe.forEach(m),O=L(H),x=_(H,"DIV",{class:!0});var le=C(x);for(let pe=0;pe<B.length;pe+=1)B[pe].l(le);le.forEach(m),H.forEach(m),this.h()},h(){p(i,"class","master-indicator svelte-1dtr99t"),p(l,"class","master-toggle svelte-1dtr99t"),p(l,"title",a=t[6]?"Turn off all layers":"Turn on all layers"),p(l,"type","button"),$(l,"active",t[6]),p(n,"class","panel-title svelte-1dtr99t"),p(n,"title","Visual effect layers - toggle and customize each one"),p(d,"class","panel-count svelte-1dtr99t"),p(d,"title","Active layers / max allowed"),$(d,"at-limit",t[7]),p(b,"class","help-btn svelte-1dtr99t"),p(b,"title","What do these buttons mean?"),p(b,"type","button"),p(s,"class","panel-header svelte-1dtr99t"),p(S,"class","global-btn svelte-1dtr99t"),p(S,"title",P=t[9]?"All layers in randomizer - click to exclude all":"Include all layers in randomizer (auto parameter changes)"),p(S,"type","button"),$(S,"active",t[9]),p(z,"class","global-btn strobe svelte-1dtr99t"),p(z,"title",N=t[8]?"All layers in strobe - click to exclude all":"Include all layers in strobe (flash on/off with beat)"),p(z,"type","button"),$(z,"active",t[8]),p(y,"class","global-controls svelte-1dtr99t"),p(x,"class","layer-list svelte-1dtr99t"),p(e,"class","panel layers-panel svelte-1dtr99t")},m(E,H){R(E,e,H),c(e,s),c(s,l),c(l,i),c(s,r),c(s,n),c(s,u),c(s,d),c(d,f),c(d,g),c(d,k),c(s,h),c(s,b),c(e,T),V&&V.m(e,null),c(e,M),c(e,y),c(y,S),c(S,I),c(y,F),c(y,z),c(z,U),c(e,O),c(e,x);for(let te=0;te<B.length;te+=1)B[te]&&B[te].m(x,null);G=!0,X||(q=[ie(l,"click",t[10]),ie(b,"click",t[20]),ie(S,"click",t[22]),ie(z,"click",t[23])],X=!0)},p(E,H){(!G||H[0]&64&&a!==(a=E[6]?"Turn off all layers":"Turn on all layers"))&&p(l,"title",a),(!G||H[0]&64)&&$(l,"active",E[6]),(!G||H[0]&4)&&re(f,E[2]),(!G||H[0]&2)&&re(k,E[1]),(!G||H[0]&128)&&$(d,"at-limit",E[7]),E[5]?V?V.p(E,H):(V=Xt(E),V.c(),V.m(e,M)):V&&(V.d(1),V=null),(!G||H[0]&512&&P!==(P=E[9]?"All layers in randomizer - click to exclude all":"Include all layers in randomizer (auto parameter changes)"))&&p(S,"title",P),(!G||H[0]&512)&&$(S,"active",E[9]),(!G||H[0]&256&&N!==(N=E[8]?"All layers in strobe - click to exclude all":"Include all layers in strobe (flash on/off with beat)"))&&p(z,"title",N),(!G||H[0]&256)&&$(z,"active",E[8]),H[0]&260250&&(Y=je(E[3]),Xe(),B=ms(B,H,W,1,E,Y,Q,x,ps,$t,null,jt),Ke())},i(E){if(!G){for(let H=0;H<Y.length;H+=1)J(B[H]);G=!0}},o(E){for(let H=0;H<B.length;H+=1)ee(B[H]);G=!1},d(E){E&&m(e),V&&V.d();for(let H=0;H<B.length;H+=1)B[H].d();X=!1,We(q)}}}function Xt(t){let e,s,l,i="How It Works",a,r,n="√ó",o,u,d='<div class="help-section svelte-1dtr99t"><div class="help-title svelte-1dtr99t">Layer Controls</div> <div class="help-item svelte-1dtr99t"><span class="help-icon dot green svelte-1dtr99t"></span> <span>Turn layer on/off</span></div> <div class="help-item svelte-1dtr99t"><span class="help-icon box svelte-1dtr99t">+</span> <span>Show more settings</span></div></div> <div class="help-section svelte-1dtr99t"><div class="help-title svelte-1dtr99t">Per-layer buttons</div> <div class="help-item svelte-1dtr99t"><span class="help-icon box svelte-1dtr99t">‚öÑ</span> <span>Randomize this layer&#39;s parameters now</span></div> <div class="help-item svelte-1dtr99t"><span class="help-icon box purple svelte-1dtr99t">R</span> <span>Include in randomizer (auto parameter changes on beat)</span></div> <div class="help-item svelte-1dtr99t"><span class="help-icon box pink svelte-1dtr99t">S</span> <span>Include in strobe (layer flashes on/off with beat)</span></div></div> <div class="help-section svelte-1dtr99t"><div class="help-title svelte-1dtr99t">Global</div> <div class="help-item svelte-1dtr99t"><span class="help-badge svelte-1dtr99t">All R</span> <span>Include or exclude all layers from randomizer</span></div> <div class="help-item svelte-1dtr99t"><span class="help-badge pink svelte-1dtr99t">All S</span> <span>Include or exclude all layers from strobe</span></div></div>',f,g;return{c(){e=w("div"),s=w("div"),l=w("span"),l.textContent=i,a=A(),r=w("button"),r.textContent=n,o=A(),u=w("div"),u.innerHTML=d,this.h()},l(k){e=_(k,"DIV",{class:!0});var h=C(e);s=_(h,"DIV",{class:!0});var b=C(s);l=_(b,"SPAN",{"data-svelte-h":!0}),ne(l)!=="svelte-72lls3"&&(l.textContent=i),a=L(b),r=_(b,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),ne(r)!=="svelte-1eac6wf"&&(r.textContent=n),b.forEach(m),o=L(h),u=_(h,"DIV",{class:!0,"data-svelte-h":!0}),ne(u)!=="svelte-uulh5r"&&(u.innerHTML=d),h.forEach(m),this.h()},h(){p(r,"class","help-close svelte-1dtr99t"),p(r,"type","button"),p(s,"class","help-header svelte-1dtr99t"),p(u,"class","help-content svelte-1dtr99t"),p(e,"class","help-popup svelte-1dtr99t")},m(k,h){R(k,e,h),c(e,s),c(s,l),c(s,a),c(s,r),c(e,o),c(e,u),f||(g=ie(r,"click",t[21]),f=!0)},p:ye,d(k){k&&m(e),f=!1,g()}}}function Kt(t){let e,s="‚öÑ",l,i,a,r,n,o,u,d,f,g;function k(){return t[26](t[34])}function h(){return t[27](t[34])}function b(){return t[28](t[34])}return{c(){e=w("button"),e.textContent=s,l=A(),i=w("button"),a=Z("R"),n=A(),o=w("button"),u=Z("S"),this.h()},l(v){e=_(v,"BUTTON",{class:!0,title:!0,type:!0,"data-svelte-h":!0}),ne(e)!=="svelte-m1cs1q"&&(e.textContent=s),l=L(v),i=_(v,"BUTTON",{class:!0,title:!0,type:!0});var T=C(i);a=K(T,"R"),T.forEach(m),n=L(v),o=_(v,"BUTTON",{class:!0,title:!0,type:!0});var M=C(o);u=K(M,"S"),M.forEach(m),this.h()},h(){p(e,"class","quick-btn randomize-btn svelte-1dtr99t"),p(e,"title","Randomize this layer's parameters now (theme, intensity, zoom, etc.)"),p(e,"type","button"),p(i,"class","quick-btn random-btn svelte-1dtr99t"),p(i,"title",r=t[35].includeInRandomizer?"Included in randomizer - click to exclude":"Include in randomizer - parameters change automatically with beat"),p(i,"type","button"),$(i,"active",t[35].includeInRandomizer),p(o,"class","quick-btn strobe-btn svelte-1dtr99t"),p(o,"title",d=t[35].includeInStrobe?"Included in strobe - click to exclude":"Include in strobe - layer can flash on/off with the beat"),p(o,"type","button"),$(o,"active",t[35].includeInStrobe)},m(v,T){R(v,e,T),R(v,l,T),R(v,i,T),c(i,a),R(v,n,T),R(v,o,T),c(o,u),f||(g=[ie(e,"click",k),ie(i,"click",h),ie(o,"click",b)],f=!0)},p(v,T){t=v,T[0]&8&&r!==(r=t[35].includeInRandomizer?"Included in randomizer - click to exclude":"Include in randomizer - parameters change automatically with beat")&&p(i,"title",r),T[0]&8&&$(i,"active",t[35].includeInRandomizer),T[0]&8&&d!==(d=t[35].includeInStrobe?"Included in strobe - click to exclude":"Include in strobe - layer can flash on/off with the beat")&&p(o,"title",d),T[0]&8&&$(o,"active",t[35].includeInStrobe)},d(v){v&&(m(e),m(l),m(i),m(n),m(o)),f=!1,We(g)}}}function Zt(t){let e,s=[],l=new Map,i,a=je(t[34].properties);const r=n=>n[38].id;for(let n=0;n<a.length;n+=1){let o=Yt(t,a,n),u=r(o);l.set(u,s[n]=Qt(u,o))}return{c(){e=w("div");for(let n=0;n<s.length;n+=1)s[n].c();this.h()},l(n){e=_(n,"DIV",{class:!0});var o=C(e);for(let u=0;u<s.length;u+=1)s[u].l(o);o.forEach(m),this.h()},h(){p(e,"class","layer-controls svelte-1dtr99t")},m(n,o){R(n,e,o);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);i=!0},p(n,o){o[0]&126984&&(a=je(n[34].properties),Xe(),s=ms(s,o,r,1,n,a,l,e,ps,Qt,null,Yt),Ke())},i(n){if(!i){for(let o=0;o<a.length;o+=1)J(s[o]);i=!0}},o(n){for(let o=0;o<s.length;o+=1)ee(s[o]);i=!1},d(n){n&&m(e);for(let o=0;o<s.length;o+=1)s[o].d()}}}function Gl(t){let e,s=t[12](t[38])+"",l,i,a;return{c(){e=w("div"),l=Z(s),i=Z(`: Unsupported
                `),this.h()},l(r){e=_(r,"DIV",{class:!0,title:!0});var n=C(e);l=K(n,s),i=K(n,`: Unsupported
                `),n.forEach(m),this.h()},h(){p(e,"class","unsupported-prop svelte-1dtr99t"),p(e,"title",a=`Unsupported parameter type: ${t[38].type}`)},m(r,n){R(r,e,n),c(e,l),c(e,i)},p(r,n){n[0]&8&&s!==(s=r[12](r[38])+"")&&re(l,s),n[0]&8&&a!==(a=`Unsupported parameter type: ${r[38].type}`)&&p(e,"title",a)},i:ye,o:ye,d(r){r&&m(e)}}}function jl(t){let e,s,l,i,a;function r(...n){return t[32](t[34],t[38],...n)}return s=new qs({props:{label:t[12](t[38]),checked:t[16](t[35].properties[t[38].id],t[38].default)}}),s.$on("change",r),{c(){e=w("div"),he(s.$$.fragment),l=A(),this.h()},l(n){e=_(n,"DIV",{title:!0});var o=C(e);fe(s.$$.fragment,o),l=L(o),o.forEach(m),this.h()},h(){p(e,"title",i=t[38].ui?.tooltip??t[38].label)},m(n,o){R(n,e,o),ce(s,e,null),c(e,l),a=!0},p(n,o){t=n;const u={};o[0]&8&&(u.label=t[12](t[38])),o[0]&8&&(u.checked=t[16](t[35].properties[t[38].id],t[38].default)),s.$set(u),(!a||o[0]&8&&i!==(i=t[38].ui?.tooltip??t[38].label))&&p(e,"title",i)},i(n){a||(J(s.$$.fragment,n),a=!0)},o(n){ee(s.$$.fragment,n),a=!1},d(n){n&&m(e),de(s)}}}function Yl(t){let e,s,l,i,a;function r(...n){return t[31](t[34],t[38],...n)}return s=new Ps({props:{label:t[12](t[38]),value:t[35].properties[t[38].id]??t[38].default,options:t[15](t[38])}}),s.$on("change",r),{c(){e=w("div"),he(s.$$.fragment),l=A(),this.h()},l(n){e=_(n,"DIV",{title:!0});var o=C(e);fe(s.$$.fragment,o),l=L(o),o.forEach(m),this.h()},h(){p(e,"title",i=t[38].ui?.tooltip??t[38].label)},m(n,o){R(n,e,o),ce(s,e,null),c(e,l),a=!0},p(n,o){t=n;const u={};o[0]&8&&(u.label=t[12](t[38])),o[0]&8&&(u.value=t[35].properties[t[38].id]??t[38].default),o[0]&8&&(u.options=t[15](t[38])),s.$set(u),(!a||o[0]&8&&i!==(i=t[38].ui?.tooltip??t[38].label))&&p(e,"title",i)},i(n){a||(J(s.$$.fragment,n),a=!0)},o(n){ee(s.$$.fragment,n),a=!1},d(n){n&&m(e),de(s)}}}function Wl(t){let e,s,l,i,a;function r(...n){return t[30](t[34],t[38],...n)}return s=new Be({props:{label:t[12](t[38]),value:t[35].properties[t[38].id]??t[38].default,min:t[38].min,max:t[38].max,step:t[14](t[38])}}),s.$on("input",r),{c(){e=w("div"),he(s.$$.fragment),l=A(),this.h()},l(n){e=_(n,"DIV",{title:!0});var o=C(e);fe(s.$$.fragment,o),l=L(o),o.forEach(m),this.h()},h(){p(e,"title",i=t[13](t[38]))},m(n,o){R(n,e,o),ce(s,e,null),c(e,l),a=!0},p(n,o){t=n;const u={};o[0]&8&&(u.label=t[12](t[38])),o[0]&8&&(u.value=t[35].properties[t[38].id]??t[38].default),o[0]&8&&(u.min=t[38].min),o[0]&8&&(u.max=t[38].max),o[0]&8&&(u.step=t[14](t[38])),s.$set(u),(!a||o[0]&8&&i!==(i=t[13](t[38])))&&p(e,"title",i)},i(n){a||(J(s.$$.fragment,n),a=!0)},o(n){ee(s.$$.fragment,n),a=!1},d(n){n&&m(e),de(s)}}}function Qt(t,e){let s,l,i,a,r;const n=[Wl,Yl,jl,Gl],o=[];function u(d,f){return d[38].type==="float"||d[38].type==="int"?0:d[38].type==="select"?1:d[38].type==="boolean"?2:3}return l=u(e),i=o[l]=n[l](e),{key:t,first:null,c(){s=Me(),i.c(),a=Me(),this.h()},l(d){s=Me(),i.l(d),a=Me(),this.h()},h(){this.first=s},m(d,f){R(d,s,f),o[l].m(d,f),R(d,a,f),r=!0},p(d,f){e=d;let g=l;l=u(e),l===g?o[l].p(e,f):(Xe(),ee(o[g],1,1,()=>{o[g]=null}),Ke(),i=o[l],i?i.p(e,f):(i=o[l]=n[l](e),i.c()),J(i,1),i.m(a.parentNode,a))},i(d){r||(J(i),r=!0)},o(d){ee(i),r=!1},d(d){d&&(m(s),m(a)),o[l].d(d)}}}function $t(t,e){let s,l,i,a,r,n,o,u,d=e[34].label+"",f,g,k,h,b,v,T=e[4].has(e[34].id)?"‚àí":"+",M,y,S=e[4].has(e[34].id),I,P,F,z;function U(){return e[24](e[34])}function N(){return e[25](e[34])}let O=e[34].randomizable!==!1&&Kt(e);function x(){return e[29](e[34])}let B=S&&Zt(e);return{key:t,first:null,c(){s=w("div"),l=w("div"),i=w("button"),a=w("span"),o=A(),u=w("button"),f=Z(d),k=A(),h=w("div"),O&&O.c(),b=A(),v=w("button"),M=Z(T),y=A(),B&&B.c(),I=A(),this.h()},l(Q){s=_(Q,"DIV",{class:!0});var G=C(s);l=_(G,"DIV",{class:!0});var X=C(l);i=_(X,"BUTTON",{class:!0,type:!0,title:!0});var q=C(i);a=_(q,"SPAN",{class:!0}),C(a).forEach(m),q.forEach(m),o=L(X),u=_(X,"BUTTON",{class:!0,type:!0,title:!0});var V=C(u);f=K(V,d),V.forEach(m),k=L(X),h=_(X,"DIV",{class:!0});var Y=C(h);O&&O.l(Y),b=L(Y),v=_(Y,"BUTTON",{class:!0,type:!0,title:!0});var W=C(v);M=K(W,T),W.forEach(m),Y.forEach(m),X.forEach(m),y=L(G),B&&B.l(G),I=L(G),G.forEach(m),this.h()},h(){p(a,"class","indicator svelte-1dtr99t"),$(a,"active",e[35].enabled),p(i,"class","layer-toggle svelte-1dtr99t"),p(i,"type","button"),p(i,"title",r=!e[35].enabled&&e[7]?`Layer limit reached (${e[1]} max)`:"Turn this visual effect on or off"),i.disabled=n=!e[35].enabled&&e[7],p(u,"class","layer-name svelte-1dtr99t"),p(u,"type","button"),p(u,"title",g=e[34].description+" - click to adjust settings"),p(v,"class","quick-btn expand-btn svelte-1dtr99t"),p(v,"type","button"),p(v,"title","Expand to see detailed controls for this layer"),p(h,"class","layer-quick svelte-1dtr99t"),p(l,"class","layer-row svelte-1dtr99t"),p(s,"class","layer-item svelte-1dtr99t"),$(s,"disabled",!e[35].enabled),$(s,"expanded",e[4].has(e[34].id)),this.first=s},m(Q,G){R(Q,s,G),c(s,l),c(l,i),c(i,a),c(l,o),c(l,u),c(u,f),c(l,k),c(l,h),O&&O.m(h,null),c(h,b),c(h,v),c(v,M),c(s,y),B&&B.m(s,null),c(s,I),P=!0,F||(z=[ie(i,"click",U),ie(u,"click",N),ie(v,"click",x)],F=!0)},p(Q,G){e=Q,(!P||G[0]&8)&&$(a,"active",e[35].enabled),(!P||G[0]&138&&r!==(r=!e[35].enabled&&e[7]?`Layer limit reached (${e[1]} max)`:"Turn this visual effect on or off"))&&p(i,"title",r),(!P||G[0]&136&&n!==(n=!e[35].enabled&&e[7]))&&(i.disabled=n),(!P||G[0]&8)&&d!==(d=e[34].label+"")&&re(f,d),(!P||G[0]&8&&g!==(g=e[34].description+" - click to adjust settings"))&&p(u,"title",g),e[34].randomizable!==!1?O?O.p(e,G):(O=Kt(e),O.c(),O.m(h,b)):O&&(O.d(1),O=null),(!P||G[0]&24)&&T!==(T=e[4].has(e[34].id)?"‚àí":"+")&&re(M,T),G[0]&24&&(S=e[4].has(e[34].id)),S?B?(B.p(e,G),G[0]&24&&J(B,1)):(B=Zt(e),B.c(),J(B,1),B.m(s,I)):B&&(Xe(),ee(B,1,1,()=>{B=null}),Ke()),(!P||G[0]&8)&&$(s,"disabled",!e[35].enabled),(!P||G[0]&24)&&$(s,"expanded",e[4].has(e[34].id))},i(Q){P||(J(B),P=!0)},o(Q){ee(B),P=!1},d(Q){Q&&m(s),O&&O.d(),B&&B.d(),F=!1,We(z)}}}function Xl(t){let e,s,l=t[0]&&Wt(t);return{c(){l&&l.c(),e=Me()},l(i){l&&l.l(i),e=Me()},m(i,a){l&&l.m(i,a),R(i,e,a),s=!0},p(i,a){i[0]?l?(l.p(i,a),a[0]&1&&J(l,1)):(l=Wt(i),l.c(),J(l,1),l.m(e.parentNode,e)):l&&(Xe(),ee(l,1,1,()=>{l=null}),Ke())},i(i){s||(J(l),s=!0)},o(i){ee(l),s=!1},d(i){i&&m(e),l&&l.d(i)}}}function Kl(t,e,s){let l,i,a,r,n,o,u,d,f;Ee(t,ge,E=>s(18,d=E)),Ee(t,ke,E=>s(19,f=E));let{visible:g=!0}=e,k=new Set,h=!1;function b(){Ss(!i,o)}function v(E){al(E,o)}const T=Ct.map(E=>({value:E.id,label:E.label,preview:E.preview})),M=E=>E.ui?.shortLabel??E.label.slice(0,4),y=E=>E.ui?.tooltip??(E.id==="intensity"?"How visible/strong this effect is":E.id==="zoom"?"Scale/size of the effect pattern":E.id==="sensitivity"?"How much this layer reacts to audio":E.label),S=E=>E.type==="int"?E.step??1:E.step??.01,I=E=>E.id==="theme"?T:E.type==="select"?E.options:[],P=(E,H)=>typeof E=="boolean"?E:H;function F(E){k.has(E)?k.delete(E):k.add(E),s(4,k=new Set(k))}const z=()=>s(5,h=!h),U=()=>s(5,h=!1),N=()=>ol(!a),O=()=>ul(!r),x=E=>v(E.id),B=E=>F(E.id),Q=E=>vl(E.id),G=E=>nl(E.id),X=E=>rl(E.id),q=E=>F(E.id),V=(E,H,te)=>gt(E.id,H.id,te.detail),Y=(E,H,te)=>gt(E.id,H.id,te.detail),W=(E,H,te)=>gt(E.id,H.id,te.detail);return t.$$set=E=>{"visible"in E&&s(0,g=E.visible)},t.$$.update=()=>{t.$$.dirty[0]&524288&&s(3,l=Ce.map(E=>({definition:E,state:f.get(E.id)})).filter(E=>E.state)),t.$$.dirty[0]&8&&s(6,i=l.some(E=>E.state.enabled)),t.$$.dirty[0]&8&&s(9,a=l.length>0&&l.every(E=>E.state.includeInRandomizer)),t.$$.dirty[0]&8&&s(8,r=l.length>0&&l.every(E=>E.state.includeInStrobe)),t.$$.dirty[0]&524288&&s(2,n=Et(f)),t.$$.dirty[0]&262144&&s(1,o=d.maxActiveLayers),t.$$.dirty[0]&6&&s(7,u=n>=o)},[g,o,n,l,k,h,i,u,r,a,b,v,M,y,S,I,P,F,d,f,z,U,N,O,x,B,Q,G,X,q,V,Y,W]}class Zl extends Ne{constructor(e){super(),Oe(this,e,Kl,Xl,Re,{visible:0},null,[-1,-1])}}function Jt(t){let e,s,l='<span class="panel-title svelte-smr4zp">LEVELS</span>',i,a,r,n,o,u,d,f,g,k,h,b,v,T,M,y,S,I,P,F;return n=new at({props:{label:"HI",value:t[1].raw.highs}}),d=new at({props:{label:"MD",value:t[1].raw.mids}}),k=new at({props:{label:"LO",value:t[1].raw.lows}}),v=new at({props:{label:"TR",value:t[1].raw.treble}}),y=new at({props:{label:"BS",value:t[1].raw.bass}}),P=new at({props:{label:"BT",value:t[1].raw.beat}}),{c(){e=w("div"),s=w("div"),s.innerHTML=l,i=A(),a=w("div"),r=w("div"),he(n.$$.fragment),o=A(),u=w("div"),he(d.$$.fragment),f=A(),g=w("div"),he(k.$$.fragment),h=A(),b=w("div"),he(v.$$.fragment),T=A(),M=w("div"),he(y.$$.fragment),S=A(),I=w("div"),he(P.$$.fragment),this.h()},l(z){e=_(z,"DIV",{class:!0});var U=C(e);s=_(U,"DIV",{class:!0,title:!0,"data-svelte-h":!0}),ne(s)!=="svelte-1qdq6z0"&&(s.innerHTML=l),i=L(U),a=_(U,"DIV",{class:!0});var N=C(a);r=_(N,"DIV",{title:!0});var O=C(r);fe(n.$$.fragment,O),O.forEach(m),o=L(N),u=_(N,"DIV",{title:!0});var x=C(u);fe(d.$$.fragment,x),x.forEach(m),f=L(N),g=_(N,"DIV",{title:!0});var B=C(g);fe(k.$$.fragment,B),B.forEach(m),h=L(N),b=_(N,"DIV",{title:!0});var Q=C(b);fe(v.$$.fragment,Q),Q.forEach(m),T=L(N),M=_(N,"DIV",{title:!0});var G=C(M);fe(y.$$.fragment,G),G.forEach(m),S=L(N),I=_(N,"DIV",{title:!0});var X=C(I);fe(P.$$.fragment,X),X.forEach(m),N.forEach(m),U.forEach(m),this.h()},h(){p(s,"class","panel-header svelte-smr4zp"),p(s,"title","Real-time audio levels from your microphone"),p(r,"title","High frequencies - cymbals, hi-hats, bright sounds"),p(u,"title","Mid frequencies - vocals, guitars, main melody"),p(g,"title","Low frequencies - bass, kick drum, rumble"),p(b,"title","Treble - combined high-pitched sounds"),p(M,"title","Bass - combined low-pitched sounds"),p(I,"title","Beat detection - pulses when drums or strong beats hit"),p(a,"class","levels-grid svelte-smr4zp"),p(e,"class","panel levels-panel svelte-smr4zp")},m(z,U){R(z,e,U),c(e,s),c(e,i),c(e,a),c(a,r),ce(n,r,null),c(a,o),c(a,u),ce(d,u,null),c(a,f),c(a,g),ce(k,g,null),c(a,h),c(a,b),ce(v,b,null),c(a,T),c(a,M),ce(y,M,null),c(a,S),c(a,I),ce(P,I,null),F=!0},p(z,U){const N={};U&2&&(N.value=z[1].raw.highs),n.$set(N);const O={};U&2&&(O.value=z[1].raw.mids),d.$set(O);const x={};U&2&&(x.value=z[1].raw.lows),k.$set(x);const B={};U&2&&(B.value=z[1].raw.treble),v.$set(B);const Q={};U&2&&(Q.value=z[1].raw.bass),y.$set(Q);const G={};U&2&&(G.value=z[1].raw.beat),P.$set(G)},i(z){F||(J(n.$$.fragment,z),J(d.$$.fragment,z),J(k.$$.fragment,z),J(v.$$.fragment,z),J(y.$$.fragment,z),J(P.$$.fragment,z),F=!0)},o(z){ee(n.$$.fragment,z),ee(d.$$.fragment,z),ee(k.$$.fragment,z),ee(v.$$.fragment,z),ee(y.$$.fragment,z),ee(P.$$.fragment,z),F=!1},d(z){z&&m(e),de(n),de(d),de(k),de(v),de(y),de(P)}}}function Ql(t){let e,s,l=t[0]&&Jt(t);return{c(){l&&l.c(),e=Me()},l(i){l&&l.l(i),e=Me()},m(i,a){l&&l.m(i,a),R(i,e,a),s=!0},p(i,[a]){i[0]?l?(l.p(i,a),a&1&&J(l,1)):(l=Jt(i),l.c(),J(l,1),l.m(e.parentNode,e)):l&&(Xe(),ee(l,1,1,()=>{l=null}),Ke())},i(i){s||(J(l),s=!0)},o(i){ee(l),s=!1},d(i){i&&m(e),l&&l.d(i)}}}function $l(t,e,s){let l;Ee(t,St,a=>s(1,l=a));let{visible:i=!0}=e;return t.$$set=a=>{"visible"in a&&s(0,i=a.visible)},[i,l]}class Jl extends Ne{constructor(e){super(),Oe(this,e,$l,Ql,Re,{visible:0})}}function xt(t){let e,s,l,i="TUNING",a,r,n=t[1]?"‚àí":"+",o,u,d,f,g,k,h,b,v,T,M,y,S,I,P,F,z,U;function N(q){t[5](q)}let O={label:"Sens",min:0,max:2,formatValue:t[3]};t[2].sensitivity!==void 0&&(O.value=t[2].sensitivity),g=new Be({props:O}),Te.push(()=>Ae(g,"value",N));function x(q){t[6](q)}let B={label:"Beat",min:0,max:2,formatValue:t[3]};t[2].beatBoost!==void 0&&(B.value=t[2].beatBoost),v=new Be({props:B}),Te.push(()=>Ae(v,"value",x));function Q(q){t[7](q)}let G={label:"Gate",min:0,max:1,formatValue:t[3]};t[2].beatGate!==void 0&&(G.value=t[2].beatGate),S=new Be({props:G}),Te.push(()=>Ae(S,"value",Q));let X=t[1]&&es(t);return{c(){e=w("div"),s=w("div"),l=w("span"),l.textContent=i,a=A(),r=w("button"),o=Z(n),u=A(),d=w("div"),f=w("div"),he(g.$$.fragment),h=A(),b=w("div"),he(v.$$.fragment),M=A(),y=w("div"),he(S.$$.fragment),P=A(),X&&X.c(),this.h()},l(q){e=_(q,"DIV",{class:!0});var V=C(e);s=_(V,"DIV",{class:!0});var Y=C(s);l=_(Y,"SPAN",{class:!0,title:!0,"data-svelte-h":!0}),ne(l)!=="svelte-hff578"&&(l.textContent=i),a=L(Y),r=_(Y,"BUTTON",{class:!0,title:!0});var W=C(r);o=K(W,n),W.forEach(m),Y.forEach(m),u=L(V),d=_(V,"DIV",{class:!0});var E=C(d);f=_(E,"DIV",{title:!0});var H=C(f);fe(g.$$.fragment,H),H.forEach(m),h=L(E),b=_(E,"DIV",{title:!0});var te=C(b);fe(v.$$.fragment,te),te.forEach(m),M=L(E),y=_(E,"DIV",{title:!0});var be=C(y);fe(S.$$.fragment,be),be.forEach(m),P=L(E),X&&X.l(E),E.forEach(m),V.forEach(m),this.h()},h(){p(l,"class","panel-title svelte-13l7qrq"),p(l,"title","Adjust how visuals respond to audio"),p(r,"class","toggle-advanced svelte-13l7qrq"),p(r,"title","Show more advanced audio controls"),p(s,"class","panel-header svelte-13l7qrq"),p(f,"title","Overall sensitivity - how much visuals react to sound"),p(b,"title","Beat boost - make beat reactions stronger or weaker"),p(y,"title","Beat gate - ignore quiet sounds, only react to loud beats"),p(d,"class","tuning-grid svelte-13l7qrq"),p(e,"class","panel tuning-panel svelte-13l7qrq")},m(q,V){R(q,e,V),c(e,s),c(s,l),c(s,a),c(s,r),c(r,o),c(e,u),c(e,d),c(d,f),ce(g,f,null),c(d,h),c(d,b),ce(v,b,null),c(d,M),c(d,y),ce(S,y,null),c(d,P),X&&X.m(d,null),F=!0,z||(U=ie(r,"click",t[4]),z=!0)},p(q,V){(!F||V&2)&&n!==(n=q[1]?"‚àí":"+")&&re(o,n);const Y={};!k&&V&4&&(k=!0,Y.value=q[2].sensitivity,Le(()=>k=!1)),g.$set(Y);const W={};!T&&V&4&&(T=!0,W.value=q[2].beatBoost,Le(()=>T=!1)),v.$set(W);const E={};!I&&V&4&&(I=!0,E.value=q[2].beatGate,Le(()=>I=!1)),S.$set(E),q[1]?X?(X.p(q,V),V&2&&J(X,1)):(X=es(q),X.c(),J(X,1),X.m(d,null)):X&&(Xe(),ee(X,1,1,()=>{X=null}),Ke())},i(q){F||(J(g.$$.fragment,q),J(v.$$.fragment,q),J(S.$$.fragment,q),J(X),F=!0)},o(q){ee(g.$$.fragment,q),ee(v.$$.fragment,q),ee(S.$$.fragment,q),ee(X),F=!1},d(q){q&&m(e),de(g),de(v),de(S),X&&X.d(),z=!1,U()}}}function es(t){let e,s,l,i,a,r,n,o,u,d,f,g,k,h,b,v,T,M,y,S,I,P,F,z,U,N,O,x,B,Q,G,X,q,V;function Y(D){t[8](D)}let W={label:"Hi+",min:0,max:2,formatValue:t[3]};t[2].highsBoost!==void 0&&(W.value=t[2].highsBoost),i=new Be({props:W}),Te.push(()=>Ae(i,"value",Y));function E(D){t[9](D)}let H={label:"Mid+",min:0,max:2,formatValue:t[3]};t[2].midsBoost!==void 0&&(H.value=t[2].midsBoost),o=new Be({props:H}),Te.push(()=>Ae(o,"value",E));function te(D){t[10](D)}let be={label:"Low+",min:0,max:2,formatValue:t[3]};t[2].lowsBoost!==void 0&&(be.value=t[2].lowsBoost),g=new Be({props:be}),Te.push(()=>Ae(g,"value",te));function ve(D){t[11](D)}let oe={label:"Trbl",min:0,max:2,formatValue:t[3]};t[2].trebleBoost!==void 0&&(oe.value=t[2].trebleBoost),v=new Be({props:oe}),Te.push(()=>Ae(v,"value",ve));function me(D){t[12](D)}let se={label:"Bass",min:0,max:2,formatValue:t[3]};t[2].bassBoost!==void 0&&(se.value=t[2].bassBoost),S=new Be({props:se}),Te.push(()=>Ae(S,"value",me));function le(D){t[13](D)}let pe={label:"Min",min:0,max:.1,step:.005,formatValue:t[3]};t[2].minMotion!==void 0&&(pe.value=t[2].minMotion),z=new Be({props:pe}),Te.push(()=>Ae(z,"value",le));function we(D){t[14](D)}let Ze={label:"Auto Suggest"};t[2].autoEnabled!==void 0&&(Ze.checked=t[2].autoEnabled),Q=new qs({props:Ze}),Te.push(()=>Ae(Q,"checked",we));let ue=t[2].autoEnabled&&ts(t);return{c(){e=w("div"),s=A(),l=w("div"),he(i.$$.fragment),r=A(),n=w("div"),he(o.$$.fragment),d=A(),f=w("div"),he(g.$$.fragment),h=A(),b=w("div"),he(v.$$.fragment),M=A(),y=w("div"),he(S.$$.fragment),P=A(),F=w("div"),he(z.$$.fragment),N=A(),O=w("div"),x=A(),B=w("div"),he(Q.$$.fragment),X=A(),ue&&ue.c(),q=Me(),this.h()},l(D){e=_(D,"DIV",{class:!0}),C(e).forEach(m),s=L(D),l=_(D,"DIV",{title:!0});var j=C(l);fe(i.$$.fragment,j),j.forEach(m),r=L(D),n=_(D,"DIV",{title:!0});var ae=C(n);fe(o.$$.fragment,ae),ae.forEach(m),d=L(D),f=_(D,"DIV",{title:!0});var Ie=C(f);fe(g.$$.fragment,Ie),Ie.forEach(m),h=L(D),b=_(D,"DIV",{title:!0});var He=C(b);fe(v.$$.fragment,He),He.forEach(m),M=L(D),y=_(D,"DIV",{title:!0});var Qe=C(y);fe(S.$$.fragment,Qe),Qe.forEach(m),P=L(D),F=_(D,"DIV",{title:!0});var Ve=C(F);fe(z.$$.fragment,Ve),Ve.forEach(m),N=L(D),O=_(D,"DIV",{class:!0}),C(O).forEach(m),x=L(D),B=_(D,"DIV",{title:!0});var Fe=C(B);fe(Q.$$.fragment,Fe),Fe.forEach(m),X=L(D),ue&&ue.l(D),q=Me(),this.h()},h(){p(e,"class","divider svelte-13l7qrq"),p(l,"title","Boost high frequency response (cymbals, hi-hats)"),p(n,"title","Boost mid frequency response (vocals, guitars)"),p(f,"title","Boost low frequency response (bass, kick drums)"),p(b,"title","Boost treble (bright, high-pitched sounds)"),p(y,"title","Boost bass (deep, low-pitched sounds)"),p(F,"title","Minimum motion - keep some movement even in silence"),p(O,"class","divider svelte-13l7qrq"),p(B,"title","Automatically adjust settings based on audio levels")},m(D,j){R(D,e,j),R(D,s,j),R(D,l,j),ce(i,l,null),R(D,r,j),R(D,n,j),ce(o,n,null),R(D,d,j),R(D,f,j),ce(g,f,null),R(D,h,j),R(D,b,j),ce(v,b,null),R(D,M,j),R(D,y,j),ce(S,y,null),R(D,P,j),R(D,F,j),ce(z,F,null),R(D,N,j),R(D,O,j),R(D,x,j),R(D,B,j),ce(Q,B,null),R(D,X,j),ue&&ue.m(D,j),R(D,q,j),V=!0},p(D,j){const ae={};!a&&j&4&&(a=!0,ae.value=D[2].highsBoost,Le(()=>a=!1)),i.$set(ae);const Ie={};!u&&j&4&&(u=!0,Ie.value=D[2].midsBoost,Le(()=>u=!1)),o.$set(Ie);const He={};!k&&j&4&&(k=!0,He.value=D[2].lowsBoost,Le(()=>k=!1)),g.$set(He);const Qe={};!T&&j&4&&(T=!0,Qe.value=D[2].trebleBoost,Le(()=>T=!1)),v.$set(Qe);const Ve={};!I&&j&4&&(I=!0,Ve.value=D[2].bassBoost,Le(()=>I=!1)),S.$set(Ve);const Fe={};!U&&j&4&&(U=!0,Fe.value=D[2].minMotion,Le(()=>U=!1)),z.$set(Fe);const dt={};!G&&j&4&&(G=!0,dt.checked=D[2].autoEnabled,Le(()=>G=!1)),Q.$set(dt),D[2].autoEnabled?ue?(ue.p(D,j),j&4&&J(ue,1)):(ue=ts(D),ue.c(),J(ue,1),ue.m(q.parentNode,q)):ue&&(Xe(),ee(ue,1,1,()=>{ue=null}),Ke())},i(D){V||(J(i.$$.fragment,D),J(o.$$.fragment,D),J(g.$$.fragment,D),J(v.$$.fragment,D),J(S.$$.fragment,D),J(z.$$.fragment,D),J(Q.$$.fragment,D),J(ue),V=!0)},o(D){ee(i.$$.fragment,D),ee(o.$$.fragment,D),ee(g.$$.fragment,D),ee(v.$$.fragment,D),ee(S.$$.fragment,D),ee(z.$$.fragment,D),ee(Q.$$.fragment,D),ee(ue),V=!1},d(D){D&&(m(e),m(s),m(l),m(r),m(n),m(d),m(f),m(h),m(b),m(M),m(y),m(P),m(F),m(N),m(O),m(x),m(B),m(X),m(q)),de(i),de(o),de(g),de(v),de(S),de(z),de(Q),ue&&ue.d(D)}}}function ts(t){let e,s,l,i,a,r,n,o,u,d,f,g;function k(y){t[15](y)}let h={label:"Str",min:0,max:1,formatValue:t[3]};t[2].autoStrength!==void 0&&(h.value=t[2].autoStrength),s=new Be({props:h}),Te.push(()=>Ae(s,"value",k));function b(y){t[16](y)}let v={label:"Dec",min:0,max:1,formatValue:t[3]};t[2].autoDecay!==void 0&&(v.value=t[2].autoDecay),r=new Be({props:v}),Te.push(()=>Ae(r,"value",b));function T(y){t[17](y)}let M={label:"Tgt",options:[{value:"all",label:"All"},{value:"energy",label:"Energy"},{value:"treble",label:"Treble"},{value:"beat",label:"Beat"}]};return t[2].autoTarget!==void 0&&(M.value=t[2].autoTarget),d=new Ps({props:M}),Te.push(()=>Ae(d,"value",T)),{c(){e=w("div"),he(s.$$.fragment),i=A(),a=w("div"),he(r.$$.fragment),o=A(),u=w("div"),he(d.$$.fragment),this.h()},l(y){e=_(y,"DIV",{title:!0});var S=C(e);fe(s.$$.fragment,S),S.forEach(m),i=L(y),a=_(y,"DIV",{title:!0});var I=C(a);fe(r.$$.fragment,I),I.forEach(m),o=L(y),u=_(y,"DIV",{title:!0});var P=C(u);fe(d.$$.fragment,P),P.forEach(m),this.h()},h(){p(e,"title","How strongly auto-adjust affects the visuals"),p(a,"title","How quickly auto-adjustments fade back to normal"),p(u,"title","Which audio metric to use for auto-adjustment")},m(y,S){R(y,e,S),ce(s,e,null),R(y,i,S),R(y,a,S),ce(r,a,null),R(y,o,S),R(y,u,S),ce(d,u,null),g=!0},p(y,S){const I={};!l&&S&4&&(l=!0,I.value=y[2].autoStrength,Le(()=>l=!1)),s.$set(I);const P={};!n&&S&4&&(n=!0,P.value=y[2].autoDecay,Le(()=>n=!1)),r.$set(P);const F={};!f&&S&4&&(f=!0,F.value=y[2].autoTarget,Le(()=>f=!1)),d.$set(F)},i(y){g||(J(s.$$.fragment,y),J(r.$$.fragment,y),J(d.$$.fragment,y),g=!0)},o(y){ee(s.$$.fragment,y),ee(r.$$.fragment,y),ee(d.$$.fragment,y),g=!1},d(y){y&&(m(e),m(i),m(a),m(o),m(u)),de(s),de(r),de(d)}}}function xl(t){let e,s,l=t[0]&&xt(t);return{c(){l&&l.c(),e=Me()},l(i){l&&l.l(i),e=Me()},m(i,a){l&&l.m(i,a),R(i,e,a),s=!0},p(i,[a]){i[0]?l?(l.p(i,a),a&1&&J(l,1)):(l=xt(i),l.c(),J(l,1),l.m(e.parentNode,e)):l&&(Xe(),ee(l,1,1,()=>{l=null}),Ke())},i(i){s||(J(l),s=!0)},o(i){ee(l),s=!1},d(i){i&&m(e),l&&l.d(i)}}}function ei(t,e,s){let l;Ee(t,Se,I=>s(2,l=I));let{visible:i=!0}=e,a=!1;const r=I=>`${Math.round(I*100)}%`,n=()=>s(1,a=!a);function o(I){t.$$.not_equal(l.sensitivity,I)&&(l.sensitivity=I,Se.set(l))}function u(I){t.$$.not_equal(l.beatBoost,I)&&(l.beatBoost=I,Se.set(l))}function d(I){t.$$.not_equal(l.beatGate,I)&&(l.beatGate=I,Se.set(l))}function f(I){t.$$.not_equal(l.highsBoost,I)&&(l.highsBoost=I,Se.set(l))}function g(I){t.$$.not_equal(l.midsBoost,I)&&(l.midsBoost=I,Se.set(l))}function k(I){t.$$.not_equal(l.lowsBoost,I)&&(l.lowsBoost=I,Se.set(l))}function h(I){t.$$.not_equal(l.trebleBoost,I)&&(l.trebleBoost=I,Se.set(l))}function b(I){t.$$.not_equal(l.bassBoost,I)&&(l.bassBoost=I,Se.set(l))}function v(I){t.$$.not_equal(l.minMotion,I)&&(l.minMotion=I,Se.set(l))}function T(I){t.$$.not_equal(l.autoEnabled,I)&&(l.autoEnabled=I,Se.set(l))}function M(I){t.$$.not_equal(l.autoStrength,I)&&(l.autoStrength=I,Se.set(l))}function y(I){t.$$.not_equal(l.autoDecay,I)&&(l.autoDecay=I,Se.set(l))}function S(I){t.$$.not_equal(l.autoTarget,I)&&(l.autoTarget=I,Se.set(l))}return t.$$set=I=>{"visible"in I&&s(0,i=I.visible)},[i,a,l,r,n,o,u,d,f,g,k,h,b,v,T,M,y,S]}class ti extends Ne{constructor(e){super(),Oe(this,e,ei,xl,Re,{visible:0})}}function ss(t,e,s){const l=t.slice();return l[31]=e[s],l[33]=s,l}function ls(t,e,s){const l=t.slice();l[34]=e[s];const i=Ge[l[34]];return l[35]=i,l}function is(t){let e,s,l,i="PERFORMANCE",a,r,n,o="üìä",u,d,f=t[4]?"‚àí":"+",g,k,h,b,v,T="FPS",M,y,S=t[3].fps+"",I,P,F,z,U,N,O,x,B="Frame",Q,G,X=t[3].frameTime.toFixed(1)+"",q,V,Y,W="ms",E,H,te,be,ve,oe,me,se,le=t[12]&&t[10]>0&&as(t),pe=t[4]&&ns(t),we=t[5]&&os(t);function Ze(j,ae){return j[12]?ni:ai}let ue=Ze(t),D=ue(t);return{c(){e=w("div"),s=w("div"),l=w("span"),l.textContent=i,a=A(),r=w("div"),n=w("button"),n.textContent=o,u=A(),d=w("button"),g=Z(f),k=A(),h=w("div"),b=w("div"),v=w("span"),v.textContent=T,M=A(),y=w("span"),I=Z(S),P=A(),F=w("span"),z=Z("/ "),U=Z(t[1]),N=A(),O=w("div"),x=w("span"),x.textContent=B,Q=A(),G=w("span"),q=Z(X),V=A(),Y=w("span"),Y.textContent=W,E=A(),le&&le.c(),H=A(),pe&&pe.c(),te=A(),we&&we.c(),be=A(),ve=w("div"),oe=w("span"),D.c(),this.h()},l(j){e=_(j,"DIV",{class:!0,"data-preset":!0});var ae=C(e);s=_(ae,"DIV",{class:!0});var Ie=C(s);l=_(Ie,"SPAN",{class:!0,"data-svelte-h":!0}),ne(l)!=="svelte-18fq72a"&&(l.textContent=i),a=L(Ie),r=_(Ie,"DIV",{class:!0});var He=C(r);n=_(He,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ne(n)!=="svelte-1jzkbaw"&&(n.textContent=o),u=L(He),d=_(He,"BUTTON",{class:!0,title:!0});var Qe=C(d);g=K(Qe,f),Qe.forEach(m),He.forEach(m),Ie.forEach(m),k=L(ae),h=_(ae,"DIV",{class:!0});var Ve=C(h);b=_(Ve,"DIV",{class:!0});var Fe=C(b);v=_(Fe,"SPAN",{class:!0,"data-svelte-h":!0}),ne(v)!=="svelte-1bu4eeu"&&(v.textContent=T),M=L(Fe),y=_(Fe,"SPAN",{class:!0,style:!0});var dt=C(y);I=K(dt,S),dt.forEach(m),P=L(Fe),F=_(Fe,"SPAN",{class:!0});var vt=C(F);z=K(vt,"/ "),U=K(vt,t[1]),vt.forEach(m),Fe.forEach(m),N=L(Ve),O=_(Ve,"DIV",{class:!0});var st=C(O);x=_(st,"SPAN",{class:!0,"data-svelte-h":!0}),ne(x)!=="svelte-1ikbzr0"&&(x.textContent=B),Q=L(st),G=_(st,"SPAN",{class:!0});var It=C(G);q=K(It,X),It.forEach(m),V=L(st),Y=_(st,"SPAN",{class:!0,"data-svelte-h":!0}),ne(Y)!=="svelte-13w5gq7"&&(Y.textContent=W),st.forEach(m),E=L(Ve),le&&le.l(Ve),Ve.forEach(m),H=L(ae),pe&&pe.l(ae),te=L(ae),we&&we.l(ae),be=L(ae),ve=_(ae,"DIV",{class:!0});var Tt=C(ve);oe=_(Tt,"SPAN",{class:!0});var qt=C(oe);D.l(qt),qt.forEach(m),Tt.forEach(m),ae.forEach(m),this.h()},h(){p(l,"class","panel-title svelte-ga4fuf"),p(n,"class","toggle-controls svelte-ga4fuf"),p(n,"title","Show layer profiling"),$(n,"active",t[5]),p(d,"class","toggle-controls svelte-ga4fuf"),p(d,"title","Show performance controls"),p(r,"class","header-actions svelte-ga4fuf"),p(s,"class","panel-header svelte-ga4fuf"),p(v,"class","label svelte-ga4fuf"),p(y,"class","value svelte-ga4fuf"),Ye(y,"color",t[11]),p(F,"class","target svelte-ga4fuf"),p(b,"class","stat svelte-ga4fuf"),p(x,"class","label svelte-ga4fuf"),p(G,"class","value svelte-ga4fuf"),p(Y,"class","unit svelte-ga4fuf"),p(O,"class","stat svelte-ga4fuf"),p(h,"class","stats-grid svelte-ga4fuf"),p(oe,"class","hint svelte-ga4fuf"),p(ve,"class","panel-footer svelte-ga4fuf"),p(e,"class","panel perf-panel svelte-ga4fuf"),p(e,"data-preset",t[2]),$(e,"eco-mode",t[12])},m(j,ae){R(j,e,ae),c(e,s),c(s,l),c(s,a),c(s,r),c(r,n),c(r,u),c(r,d),c(d,g),c(e,k),c(e,h),c(h,b),c(b,v),c(b,M),c(b,y),c(y,I),c(b,P),c(b,F),c(F,z),c(F,U),c(h,N),c(h,O),c(O,x),c(O,Q),c(O,G),c(G,q),c(O,V),c(O,Y),c(h,E),le&&le.m(h,null),c(e,H),pe&&pe.m(e,null),c(e,te),we&&we.m(e,null),c(e,be),c(e,ve),c(ve,oe),D.m(oe,null),me||(se=[ie(n,"click",t[23]),ie(d,"click",t[24])],me=!0)},p(j,ae){ae[0]&32&&$(n,"active",j[5]),ae[0]&16&&f!==(f=j[4]?"‚àí":"+")&&re(g,f),ae[0]&8&&S!==(S=j[3].fps+"")&&re(I,S),ae[0]&2048&&Ye(y,"color",j[11]),ae[0]&2&&re(U,j[1]),ae[0]&8&&X!==(X=j[3].frameTime.toFixed(1)+"")&&re(q,X),j[12]&&j[10]>0?le?le.p(j,ae):(le=as(j),le.c(),le.m(h,null)):le&&(le.d(1),le=null),j[4]?pe?pe.p(j,ae):(pe=ns(j),pe.c(),pe.m(e,te)):pe&&(pe.d(1),pe=null),j[5]?we?we.p(j,ae):(we=os(j),we.c(),we.m(e,be)):we&&(we.d(1),we=null),ue===(ue=Ze(j))&&D?D.p(j,ae):(D.d(1),D=ue(j),D&&(D.c(),D.m(oe,null))),ae[0]&4&&p(e,"data-preset",j[2]),ae[0]&4096&&$(e,"eco-mode",j[12])},d(j){j&&m(e),le&&le.d(),pe&&pe.d(),we&&we.d(),D.d(),me=!1,We(se)}}}function as(t){let e,s,l="Saved",i,a,r,n,o;return{c(){e=w("div"),s=w("span"),s.textContent=l,i=A(),a=w("span"),r=Z("~"),n=Z(t[10]),o=Z("%"),this.h()},l(u){e=_(u,"DIV",{class:!0});var d=C(e);s=_(d,"SPAN",{class:!0,"data-svelte-h":!0}),ne(s)!=="svelte-dz9cv6"&&(s.textContent=l),i=L(d),a=_(d,"SPAN",{class:!0});var f=C(a);r=K(f,"~"),n=K(f,t[10]),o=K(f,"%"),f.forEach(m),d.forEach(m),this.h()},h(){p(s,"class","label svelte-ga4fuf"),p(a,"class","value success svelte-ga4fuf"),p(e,"class","stat savings svelte-ga4fuf")},m(u,d){R(u,e,d),c(e,s),c(e,i),c(e,a),c(a,r),c(a,n),c(a,o)},p(u,d){d[0]&1024&&re(n,u[10])},d(u){u&&m(e)}}}function ns(t){let e,s,l,i,a,r="Device Preset",n,o,u,d,f,g,k="FPS Limit",h,b,v,T,M,y,S="Resolution",I,P,F,z,U,N,O,x="Max Layers",B,Q,G,X=je(t[16]),q=[];for(let V=0;V<X.length;V+=1)q[V]=rs(ls(t,X,V));return{c(){e=w("div"),s=A(),l=w("div"),i=w("div"),a=w("span"),a.textContent=r,n=A(),o=w("div");for(let V=0;V<q.length;V+=1)q[V].c();u=A(),d=w("div"),f=w("div"),g=w("span"),g.textContent=k,h=A(),b=w("span"),v=Z(t[1]),T=A(),M=w("div"),y=w("span"),y.textContent=S,I=A(),P=w("span"),F=Z(t[14]),z=Z("%"),U=A(),N=w("div"),O=w("span"),O.textContent=x,B=A(),Q=w("span"),G=Z(t[13]),this.h()},l(V){e=_(V,"DIV",{class:!0}),C(e).forEach(m),s=L(V),l=_(V,"DIV",{class:!0});var Y=C(l);i=_(Y,"DIV",{class:!0});var W=C(i);a=_(W,"SPAN",{class:!0,"data-svelte-h":!0}),ne(a)!=="svelte-qrzmpu"&&(a.textContent=r),n=L(W),o=_(W,"DIV",{class:!0});var E=C(o);for(let le=0;le<q.length;le+=1)q[le].l(E);E.forEach(m),W.forEach(m),u=L(Y),d=_(Y,"DIV",{class:!0});var H=C(d);f=_(H,"DIV",{class:!0});var te=C(f);g=_(te,"SPAN",{class:!0,"data-svelte-h":!0}),ne(g)!=="svelte-unnghm"&&(g.textContent=k),h=L(te),b=_(te,"SPAN",{class:!0});var be=C(b);v=K(be,t[1]),be.forEach(m),te.forEach(m),T=L(H),M=_(H,"DIV",{class:!0});var ve=C(M);y=_(ve,"SPAN",{class:!0,"data-svelte-h":!0}),ne(y)!=="svelte-767f9k"&&(y.textContent=S),I=L(ve),P=_(ve,"SPAN",{class:!0});var oe=C(P);F=K(oe,t[14]),z=K(oe,"%"),oe.forEach(m),ve.forEach(m),U=L(H),N=_(H,"DIV",{class:!0});var me=C(N);O=_(me,"SPAN",{class:!0,"data-svelte-h":!0}),ne(O)!=="svelte-1kvlchu"&&(O.textContent=x),B=L(me),Q=_(me,"SPAN",{class:!0});var se=C(Q);G=K(se,t[13]),se.forEach(m),me.forEach(m),H.forEach(m),Y.forEach(m),this.h()},h(){p(e,"class","divider svelte-ga4fuf"),p(a,"class","section-label svelte-ga4fuf"),p(o,"class","presets svelte-ga4fuf"),p(i,"class","preset-section svelte-ga4fuf"),p(g,"class","setting-label svelte-ga4fuf"),p(b,"class","setting-value svelte-ga4fuf"),p(f,"class","setting-row svelte-ga4fuf"),p(y,"class","setting-label svelte-ga4fuf"),p(P,"class","setting-value svelte-ga4fuf"),p(M,"class","setting-row svelte-ga4fuf"),p(O,"class","setting-label svelte-ga4fuf"),p(Q,"class","setting-value svelte-ga4fuf"),p(N,"class","setting-row svelte-ga4fuf"),p(d,"class","settings-summary svelte-ga4fuf"),p(l,"class","controls-grid svelte-ga4fuf")},m(V,Y){R(V,e,Y),R(V,s,Y),R(V,l,Y),c(l,i),c(i,a),c(i,n),c(i,o);for(let W=0;W<q.length;W+=1)q[W]&&q[W].m(o,null);c(l,u),c(l,d),c(d,f),c(f,g),c(f,h),c(f,b),c(b,v),c(d,T),c(d,M),c(M,y),c(M,I),c(M,P),c(P,F),c(P,z),c(d,U),c(d,N),c(N,O),c(N,B),c(N,Q),c(Q,G)},p(V,Y){if(Y[0]&65540){X=je(V[16]);let W;for(W=0;W<X.length;W+=1){const E=ls(V,X,W);q[W]?q[W].p(E,Y):(q[W]=rs(E),q[W].c(),q[W].m(o,null))}for(;W<q.length;W+=1)q[W].d(1);q.length=X.length}Y[0]&2&&re(v,V[1]),Y[0]&16384&&re(F,V[14]),Y[0]&8192&&re(G,V[13])},d(V){V&&(m(e),m(s),m(l)),kt(q,V)}}}function rs(t){let e,s,l=t[35].icon+"",i,a,r,n=t[35].label+"",o,u,d,f;function g(){return t[25](t[34])}return{c(){e=w("button"),s=w("span"),i=Z(l),a=A(),r=w("span"),o=Z(n),u=A(),this.h()},l(k){e=_(k,"BUTTON",{class:!0,"data-preset":!0,title:!0});var h=C(e);s=_(h,"SPAN",{class:!0});var b=C(s);i=K(b,l),b.forEach(m),a=L(h),r=_(h,"SPAN",{class:!0});var v=C(r);o=K(v,n),v.forEach(m),u=L(h),h.forEach(m),this.h()},h(){p(s,"class","preset-icon svelte-ga4fuf"),p(r,"class","preset-name svelte-ga4fuf"),p(e,"class","preset-btn svelte-ga4fuf"),p(e,"data-preset",t[34]),p(e,"title",t[35].label+": "+t[35].targetFps+"fps, "+Math.round(t[35].resolutionScale*100)+"% res, max "+t[35].maxActiveLayers+" layers, quality "+Math.round(t[35].qualityLevel*100)+"%, FFT "+t[35].audioFftSize+", sensitivity "+t[35].audioSensitivity.toFixed(1)+"x"),$(e,"active",t[2]===t[34])},m(k,h){R(k,e,h),c(e,s),c(s,i),c(e,a),c(e,r),c(r,o),c(e,u),d||(f=ie(e,"click",g),d=!0)},p(k,h){t=k,h[0]&65540&&$(e,"active",t[2]===t[34])},d(k){k&&m(e),d=!1,f()}}}function os(t){let e,s,l,i,a="Layer Profiling",r;function n(d,f){return d[9]?ii:d[8].length>0?li:si}let o=n(t),u=o(t);return{c(){e=w("div"),s=A(),l=w("div"),i=w("span"),i.textContent=a,r=A(),u.c(),this.h()},l(d){e=_(d,"DIV",{class:!0}),C(e).forEach(m),s=L(d),l=_(d,"DIV",{class:!0});var f=C(l);i=_(f,"SPAN",{class:!0,"data-svelte-h":!0}),ne(i)!=="svelte-179ce8"&&(i.textContent=a),r=L(f),u.l(f),f.forEach(m),this.h()},h(){p(e,"class","divider svelte-ga4fuf"),p(i,"class","section-label svelte-ga4fuf"),p(l,"class","profiling-section svelte-ga4fuf")},m(d,f){R(d,e,f),R(d,s,f),R(d,l,f),c(l,i),c(l,r),u.m(l,null)},p(d,f){o===(o=n(d))&&u?u.p(d,f):(u.d(1),u=o(d),u&&(u.c(),u.m(l,null)))},d(d){d&&(m(e),m(s),m(l)),u.d()}}}function si(t){let e,s,l="Profile each layer to measure GPU cost",i,a,r="Start Profiling",n,o;return{c(){e=w("div"),s=w("p"),s.textContent=l,i=A(),a=w("button"),a.textContent=r,this.h()},l(u){e=_(u,"DIV",{class:!0});var d=C(e);s=_(d,"P",{class:!0,"data-svelte-h":!0}),ne(s)!=="svelte-ea8ndm"&&(s.textContent=l),i=L(d),a=_(d,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(a)!=="svelte-1wipjbw"&&(a.textContent=r),d.forEach(m),this.h()},h(){p(s,"class","profiling-hint svelte-ga4fuf"),p(a,"class","profiling-btn start svelte-ga4fuf"),p(e,"class","profiling-idle svelte-ga4fuf")},m(u,d){R(u,e,d),c(e,s),c(e,i),c(e,a),n||(o=ie(a,"click",t[17]),n=!0)},p:ye,d(u){u&&m(e),n=!1,o()}}}function li(t){let e,s,l,i="GPU Cost Ranking",a,r,n="Re-run",o,u,d,f,g,k=je(t[8].slice(0,5)),h=[];for(let v=0;v<k.length;v+=1)h[v]=us(ss(t,k,v));let b=t[8].length>5&&ds(t);return{c(){e=w("div"),s=w("div"),l=w("span"),l.textContent=i,a=A(),r=w("button"),r.textContent=n,o=A(),u=w("div");for(let v=0;v<h.length;v+=1)h[v].c();d=A(),b&&b.c(),this.h()},l(v){e=_(v,"DIV",{class:!0});var T=C(e);s=_(T,"DIV",{class:!0});var M=C(s);l=_(M,"SPAN",{"data-svelte-h":!0}),ne(l)!=="svelte-bmc8wn"&&(l.textContent=i),a=L(M),r=_(M,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(r)!=="svelte-lr1w0g"&&(r.textContent=n),M.forEach(m),o=L(T),u=_(T,"DIV",{class:!0});var y=C(u);for(let S=0;S<h.length;S+=1)h[S].l(y);d=L(y),b&&b.l(y),y.forEach(m),T.forEach(m),this.h()},h(){p(r,"class","profiling-btn small svelte-ga4fuf"),p(s,"class","results-header svelte-ga4fuf"),p(u,"class","results-list svelte-ga4fuf"),p(e,"class","profiling-results svelte-ga4fuf")},m(v,T){R(v,e,T),c(e,s),c(s,l),c(s,a),c(s,r),c(e,o),c(e,u);for(let M=0;M<h.length;M+=1)h[M]&&h[M].m(u,null);c(u,d),b&&b.m(u,null),f||(g=ie(r,"click",t[17]),f=!0)},p(v,T){if(T[0]&256){k=je(v[8].slice(0,5));let M;for(M=0;M<k.length;M+=1){const y=ss(v,k,M);h[M]?h[M].p(y,T):(h[M]=us(y),h[M].c(),h[M].m(u,d))}for(;M<h.length;M+=1)h[M].d(1);h.length=k.length}v[8].length>5?b?b.p(v,T):(b=ds(v),b.c(),b.m(u,null)):b&&(b.d(1),b=null)},d(v){v&&m(e),kt(h,v),b&&b.d(),f=!1,g()}}}function ii(t){let e,s,l,i="Profiling:",a,r,n,o,u,d,f,g,k,h,b,v,T="Stop",M,y;return{c(){e=w("div"),s=w("div"),l=w("span"),l.textContent=i,a=A(),r=w("span"),n=Z(t[7]),o=A(),u=w("div"),d=w("div"),f=A(),g=w("div"),k=Z(t[6]),h=Z("%"),b=A(),v=w("button"),v.textContent=T,this.h()},l(S){e=_(S,"DIV",{class:!0});var I=C(e);s=_(I,"DIV",{class:!0});var P=C(s);l=_(P,"SPAN",{class:!0,"data-svelte-h":!0}),ne(l)!=="svelte-1fo8q2a"&&(l.textContent=i),a=L(P),r=_(P,"SPAN",{class:!0});var F=C(r);n=K(F,t[7]),F.forEach(m),P.forEach(m),o=L(I),u=_(I,"DIV",{class:!0});var z=C(u);d=_(z,"DIV",{class:!0,style:!0}),C(d).forEach(m),z.forEach(m),f=L(I),g=_(I,"DIV",{class:!0});var U=C(g);k=K(U,t[6]),h=K(U,"%"),U.forEach(m),b=L(I),v=_(I,"BUTTON",{class:!0,"data-svelte-h":!0}),ne(v)!=="svelte-cbsfqc"&&(v.textContent=T),I.forEach(m),this.h()},h(){p(l,"class","status-label svelte-ga4fuf"),p(r,"class","status-value svelte-ga4fuf"),p(s,"class","profiling-status svelte-ga4fuf"),p(d,"class","progress-fill svelte-ga4fuf"),Ye(d,"width",t[6]+"%"),p(u,"class","progress-bar svelte-ga4fuf"),p(g,"class","progress-text svelte-ga4fuf"),p(v,"class","profiling-btn stop svelte-ga4fuf"),p(e,"class","profiling-active svelte-ga4fuf")},m(S,I){R(S,e,I),c(e,s),c(s,l),c(s,a),c(s,r),c(r,n),c(e,o),c(e,u),c(u,d),c(e,f),c(e,g),c(g,k),c(g,h),c(e,b),c(e,v),M||(y=ie(v,"click",t[18]),M=!0)},p(S,I){I[0]&128&&re(n,S[7]),I[0]&64&&Ye(d,"width",S[6]+"%"),I[0]&64&&re(k,S[6])},d(S){S&&m(e),M=!1,y()}}}function us(t){let e,s,l,i=t[33]+1+"",a,r,n,o=t[31].layerName+"",u,d,f,g=t[31].relativeCost.toFixed(1)+"",k,h;return{c(){e=w("div"),s=w("span"),l=Z("#"),a=Z(i),r=A(),n=w("span"),u=Z(o),d=A(),f=w("span"),k=Z(g),h=Z("x"),this.h()},l(b){e=_(b,"DIV",{class:!0});var v=C(e);s=_(v,"SPAN",{class:!0});var T=C(s);l=K(T,"#"),a=K(T,i),T.forEach(m),r=L(v),n=_(v,"SPAN",{class:!0});var M=C(n);u=K(M,o),M.forEach(m),d=L(v),f=_(v,"SPAN",{class:!0,style:!0});var y=C(f);k=K(y,g),h=K(y,"x"),y.forEach(m),v.forEach(m),this.h()},h(){p(s,"class","result-rank svelte-ga4fuf"),p(n,"class","result-name svelte-ga4fuf"),p(f,"class","result-cost svelte-ga4fuf"),Ye(f,"color",t[33]===0?"var(--color-error)":t[33]<3?"var(--color-warning)":"var(--color-text-dim)"),p(e,"class","result-item svelte-ga4fuf")},m(b,v){R(b,e,v),c(e,s),c(s,l),c(s,a),c(e,r),c(e,n),c(n,u),c(e,d),c(e,f),c(f,k),c(f,h)},p(b,v){v[0]&256&&o!==(o=b[31].layerName+"")&&re(u,o),v[0]&256&&g!==(g=b[31].relativeCost.toFixed(1)+"")&&re(k,g)},d(b){b&&m(e)}}}function ds(t){let e,s,l=t[8].length-5+"",i,a;return{c(){e=w("div"),s=Z("+"),i=Z(l),a=Z(" more"),this.h()},l(r){e=_(r,"DIV",{class:!0});var n=C(e);s=K(n,"+"),i=K(n,l),a=K(n," more"),n.forEach(m),this.h()},h(){p(e,"class","result-more svelte-ga4fuf")},m(r,n){R(r,e,n),c(e,s),c(e,i),c(e,a)},p(r,n){n[0]&256&&l!==(l=r[8].length-5+"")&&re(i,l)},d(r){r&&m(e)}}}function ai(t){let e;return{c(){e=Z("üñ•Ô∏è Full quality mode")},l(s){e=K(s,"üñ•Ô∏è Full quality mode")},m(s,l){R(s,e,l)},p:ye,d(s){s&&m(e)}}}function ni(t){let e=t[15].icon+"",s,l,i=t[15].label+"",a,r,n,o;return{c(){s=Z(e),l=A(),a=Z(i),r=Z(" mode ("),n=Z(t[10]),o=Z("% lighter)")},l(u){s=K(u,e),l=L(u),a=K(u,i),r=K(u," mode ("),n=K(u,t[10]),o=K(u,"% lighter)")},m(u,d){R(u,s,d),R(u,l,d),R(u,a,d),R(u,r,d),R(u,n,d),R(u,o,d)},p(u,d){d[0]&32768&&e!==(e=u[15].icon+"")&&re(s,e),d[0]&32768&&i!==(i=u[15].label+"")&&re(a,i),d[0]&1024&&re(n,u[10])},d(u){u&&(m(s),m(l),m(a),m(r),m(n),m(o))}}}function ri(t){let e,s=t[0]&&is(t);return{c(){s&&s.c(),e=Me()},l(l){s&&s.l(l),e=Me()},m(l,i){s&&s.m(l,i),R(l,e,i)},p(l,i){l[0]?s?s.p(l,i):(s=is(l),s.c(),s.m(e.parentNode,e)):s&&(s.d(1),s=null)},i:ye,o:ye,d(l){l&&m(e),s&&s.d(l)}}}function oi(t,e,s){let l,i,a,r,n,o,u,d,f,g,k,h,b,v,T,M,y;Ee(t,ot,B=>s(21,T=B)),Ee(t,ge,B=>s(22,M=B)),Ee(t,Is,B=>s(3,y=B));let{visible:S=!0}=e,I=!1,P=!1;const F=["auto","desktop","laptop","mobile"];function z(){Sl()}function U(){Ts()}const N=()=>s(5,P=!P),O=()=>s(4,I=!I),x=B=>Mt(B);return t.$$set=B=>{"visible"in B&&s(0,S=B.visible)},t.$$.update=()=>{t.$$.dirty[0]&4194304&&s(2,l=M.devicePreset),t.$$.dirty[0]&4&&s(15,i=Ge[l]),t.$$.dirty[0]&4194304&&s(1,a=M.targetFps),t.$$.dirty[0]&4194304&&s(14,r=Math.round(M.resolutionScale*100)),t.$$.dirty[0]&4194304&&s(13,n=M.maxActiveLayers),t.$$.dirty[0]&4&&s(12,o=l==="mobile"||l==="laptop"),t.$$.dirty[0]&4,t.$$.dirty[0]&4,t.$$.dirty[0]&4,t.$$.dirty[0]&10&&s(11,u=y.fps>=a*.9?"var(--color-success)":y.fps>=a*.5?"var(--color-warning, #f59e0b)":"var(--color-error, #ef4444)"),t.$$.dirty[0]&4194304&&Math.round((1-M.resolutionScale)*100),t.$$.dirty[0]&2,t.$$.dirty[0]&4194306&&s(10,d=Math.round((1-a/60*M.resolutionScale)*100)),t.$$.dirty[0]&2097152&&s(9,f=T.isActive),t.$$.dirty[0]&2097152&&s(19,g=T.progress),t.$$.dirty[0]&2097152&&s(20,k=T.currentLayerIndex),t.$$.dirty[0]&2097152&&s(8,h=T.results),t.$$.dirty[0]&1048576&&s(7,b=k>=0?Ce[k]?.label||"Unknown":""),t.$$.dirty[0]&524288&&s(6,v=Math.round(g*100))},[S,a,l,y,I,P,v,b,h,f,d,u,o,n,r,i,F,z,U,g,k,T,M,N,O,x]}class ui extends Ne{constructor(e){super(),Oe(this,e,oi,ri,Re,{visible:0},null,[-1,-1])}}function cs(t){let e,s,l,i="‚úï",a,r,n='<h1 id="info-title" class="svelte-1ypq32x">SOUNDART</h1> <p class="tagline svelte-1ypq32x">Audio-reactive WebGL visualizer that transforms sound into mesmerizing visuals in real-time.</p>',o,u,d='<section class="svelte-1ypq32x"><h2 class="svelte-1ypq32x">üé§ Getting Started</h2> <ol class="svelte-1ypq32x"><li class="svelte-1ypq32x">Click <strong class="svelte-1ypq32x">MIC ON</strong> to enable microphone</li> <li class="svelte-1ypq32x">Play music or make sounds</li> <li class="svelte-1ypq32x">Watch the visuals react!</li></ol></section> <section class="svelte-1ypq32x"><h2 class="svelte-1ypq32x">‚å®Ô∏è Keyboard Shortcuts</h2> <div class="shortcuts svelte-1ypq32x"><div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">‚Üë</kbd><span>Zoom in</span></div> <div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">‚Üì</kbd><span>Zoom out</span></div> <div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">‚Üí</kbd><span>Speed up</span></div> <div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">‚Üê</kbd><span>Speed down</span></div> <div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">M</kbd><span>Toggle microphone</span></div> <div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">F</kbd><span>Toggle fullscreen</span></div> <div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">H</kbd><span>Hide/show all panels</span></div> <div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">?</kbd><span>Show/hide this help</span></div> <div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">R</kbd><span>Cycle randomizer modes</span></div> <div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">S</kbd><span>Cycle strobe modes</span></div> <div class="shortcut svelte-1ypq32x"><kbd class="svelte-1ypq32x">P</kbd><span>Cycle device presets</span></div></div></section> <section class="svelte-1ypq32x"><h2 class="svelte-1ypq32x">üì± Touch Controls</h2> <div class="shortcuts svelte-1ypq32x"><div class="shortcut svelte-1ypq32x"><span class="gesture svelte-1ypq32x">Single tap</span><span>Toggle panels</span></div> <div class="shortcut svelte-1ypq32x"><span class="gesture svelte-1ypq32x">Double tap</span><span>Toggle fullscreen</span></div></div></section> <section class="svelte-1ypq32x"><h2 class="svelte-1ypq32x">üé® Layers</h2> <ul class="svelte-1ypq32x"><li class="svelte-1ypq32x">Toggle layers on/off with the indicator dot</li> <li class="svelte-1ypq32x">Click <strong class="svelte-1ypq32x">+</strong> to expand and adjust settings</li> <li class="svelte-1ypq32x">Adjust <strong class="svelte-1ypq32x">intensity</strong>, <strong class="svelte-1ypq32x">zoom</strong>, <strong class="svelte-1ypq32x">theme</strong>, and <strong class="svelte-1ypq32x">sensitivity</strong></li></ul> <h3 class="svelte-1ypq32x">Global (Layers panel)</h3> <ul class="svelte-1ypq32x"><li class="svelte-1ypq32x"><strong class="svelte-1ypq32x">All R</strong> ‚Äì Include or exclude all layers from randomizer</li> <li class="svelte-1ypq32x"><strong class="svelte-1ypq32x">All S</strong> ‚Äì Include or exclude all layers from strobe</li></ul> <h3 class="svelte-1ypq32x">Per-layer buttons</h3> <div class="button-legend svelte-1ypq32x"><div class="legend-item svelte-1ypq32x"><span class="legend-btn svelte-1ypq32x">‚öÑ</span><span>Randomize this layer&#39;s parameters now</span></div> <div class="legend-item svelte-1ypq32x"><span class="legend-btn r svelte-1ypq32x">R</span><span>Include in randomizer (auto parameter changes on beat)</span></div> <div class="legend-item svelte-1ypq32x"><span class="legend-btn s svelte-1ypq32x">S</span><span>Include in strobe (layer flashes on/off with beat)</span></div></div></section> <section class="svelte-1ypq32x"><h2 class="svelte-1ypq32x">üé≤ Randomizer Modes</h2> <p class="mode-intro svelte-1ypq32x">Press <kbd class="svelte-1ypq32x">R</kbd> to cycle through modes:</p> <div class="mode-list svelte-1ypq32x"><div class="mode-item svelte-1ypq32x"><span class="mode-name svelte-1ypq32x">FLOW</span> <span class="mode-desc svelte-1ypq32x">Balanced changes ‚Äî moderate timing, up to 30% parameter shifts, 50% change chance</span></div> <div class="mode-item svelte-1ypq32x"><span class="mode-name svelte-1ypq32x">CHAOS</span> <span class="mode-desc svelte-1ypq32x">Aggressive ‚Äî 4√ó faster, full range jumps, 100% change chance on every beat</span></div> <div class="mode-item svelte-1ypq32x"><span class="mode-name svelte-1ypq32x">SUBTLE</span> <span class="mode-desc svelte-1ypq32x">Gentle nudges ‚Äî 2.5√ó slower, up to 10% shifts, 20% change chance, keeps themes stable</span></div></div></section> <section class="svelte-1ypq32x"><h2 class="svelte-1ypq32x">‚ö° Strobe Modes</h2> <p class="mode-intro svelte-1ypq32x">Press <kbd class="svelte-1ypq32x">S</kbd> to cycle through modes:</p> <div class="mode-list svelte-1ypq32x"><div class="mode-item svelte-1ypq32x"><span class="mode-name svelte-1ypq32x">FLASH</span> <span class="mode-desc svelte-1ypq32x">Standard flashing ‚Äî 30% toggle chance on beat</span></div> <div class="mode-item svelte-1ypq32x"><span class="mode-name svelte-1ypq32x">PULSE</span> <span class="mode-desc svelte-1ypq32x">Rapid pulsing ‚Äî 80% toggle chance, layers flash frequently</span></div> <div class="mode-item svelte-1ypq32x"><span class="mode-name svelte-1ypq32x">DRIFT</span> <span class="mode-desc svelte-1ypq32x">Slow transitions ‚Äî 5% toggle chance, gradual layer changes</span></div></div></section> <section class="svelte-1ypq32x"><h2 class="svelte-1ypq32x">üéöÔ∏è Audio Tuning</h2> <ul class="svelte-1ypq32x"><li class="svelte-1ypq32x"><strong class="svelte-1ypq32x">Global sensitivity</strong>: overall audio reactivity</li> <li class="svelte-1ypq32x"><strong class="svelte-1ypq32x">Frequency boosts</strong>: enhance specific ranges</li> <li class="svelte-1ypq32x"><strong class="svelte-1ypq32x">Beat gate</strong>: threshold for beat detection</li> <li class="svelte-1ypq32x"><strong class="svelte-1ypq32x">Auto-suggest</strong>: automatic sensitivity adjustment</li></ul></section> <section class="svelte-1ypq32x"><h2 class="svelte-1ypq32x">üí° Tips</h2> <ul class="svelte-1ypq32x"><li class="svelte-1ypq32x">Use <strong class="svelte-1ypq32x">fullscreen</strong> for best experience</li> <li class="svelte-1ypq32x">Try different <strong class="svelte-1ypq32x">themes</strong> on each layer</li> <li class="svelte-1ypq32x">Adjust <strong class="svelte-1ypq32x">sensitivity</strong> if visuals are too subtle or intense</li> <li class="svelte-1ypq32x">Enable <strong class="svelte-1ypq32x">Power Saver</strong> on laptops to save battery</li></ul></section>',f,g,k='<span>Press <kbd class="svelte-1ypq32x">?</kbd> or tap the help button to reopen</span>',h,b;return{c(){e=w("div"),s=w("div"),l=w("button"),l.textContent=i,a=A(),r=w("header"),r.innerHTML=n,o=A(),u=w("div"),u.innerHTML=d,f=A(),g=w("footer"),g.innerHTML=k,this.h()},l(v){e=_(v,"DIV",{class:!0});var T=C(e);s=_(T,"DIV",{class:!0,role:!0,"aria-modal":!0,"aria-labelledby":!0});var M=C(s);l=_(M,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),ne(l)!=="svelte-h7on2u"&&(l.textContent=i),a=L(M),r=_(M,"HEADER",{class:!0,"data-svelte-h":!0}),ne(r)!=="svelte-1jvg3xd"&&(r.innerHTML=n),o=L(M),u=_(M,"DIV",{class:!0,"data-svelte-h":!0}),ne(u)!=="svelte-1200ckn"&&(u.innerHTML=d),f=L(M),g=_(M,"FOOTER",{class:!0,"data-svelte-h":!0}),ne(g)!=="svelte-5jo3kb"&&(g.innerHTML=k),M.forEach(m),T.forEach(m),this.h()},h(){p(l,"class","close-btn svelte-1ypq32x"),p(l,"aria-label","Close"),p(r,"class","info-header svelte-1ypq32x"),p(u,"class","info-content svelte-1ypq32x"),p(g,"class","info-footer svelte-1ypq32x"),p(s,"class","info-panel svelte-1ypq32x"),p(s,"role","dialog"),p(s,"aria-modal","true"),p(s,"aria-labelledby","info-title"),p(e,"class","overlay svelte-1ypq32x")},m(v,T){R(v,e,T),c(e,s),c(s,l),c(s,a),c(s,r),c(s,o),c(s,u),c(s,f),c(s,g),h||(b=[ie(l,"click",t[1]),ie(e,"click",t[3])],h=!0)},p:ye,d(v){v&&m(e),h=!1,We(b)}}}function di(t){let e,s,l,i=t[0]&&cs(t);return{c(){i&&i.c(),e=Me()},l(a){i&&i.l(a),e=Me()},m(a,r){i&&i.m(a,r),R(a,e,r),s||(l=ie(window,"keydown",t[2]),s=!0)},p(a,[r]){a[0]?i?i.p(a,r):(i=cs(a),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:ye,o:ye,d(a){a&&m(e),i&&i.d(a),s=!1,l()}}}const fs="soundart-seen-info";function ci(t,e,s){let{visible:l=!1}=e,{onClose:i}=e;function a(){return!localStorage.getItem(fs)}function r(){localStorage.setItem(fs,"true")}function n(){r(),i()}function o(d){d.key==="Escape"&&l&&n()}function u(d){d.target===d.currentTarget&&n()}return t.$$set=d=>{"visible"in d&&s(0,l=d.visible),"onClose"in d&&s(4,i=d.onClose)},[l,n,o,u,i,a]}class fi extends Ne{constructor(e){super(),Oe(this,e,ci,di,Re,{visible:0,onClose:4,shouldShowOnFirstVisit:5})}get shouldShowOnFirstVisit(){return this.$$.ctx[5]}}function hi(t){let e,s,l,i,a,r,n,o,u,d,f,g,k,h,b,v,T,M={};return s=new Tl({props:M}),t[11](s),i=new Dl({props:{onEnableMic:t[4],onDisableMic:t[5],onShowInfo:t[6],visible:t[0].panelsVisible}}),r=new Zl({props:{visible:t[0].panelsVisible}}),o=new Jl({props:{visible:t[0].panelsVisible}}),d=new ti({props:{visible:t[0].panelsVisible}}),g=new ui({props:{visible:t[0].panelsVisible}}),h=new fi({props:{visible:t[2],onClose:t[7]}}),{c(){e=w("main"),he(s.$$.fragment),l=A(),he(i.$$.fragment),a=A(),he(r.$$.fragment),n=A(),he(o.$$.fragment),u=A(),he(d.$$.fragment),f=A(),he(g.$$.fragment),k=A(),he(h.$$.fragment),this.h()},l(y){e=_(y,"MAIN",{class:!0});var S=C(e);fe(s.$$.fragment,S),l=L(S),fe(i.$$.fragment,S),a=L(S),fe(r.$$.fragment,S),n=L(S),fe(o.$$.fragment,S),u=L(S),fe(d.$$.fragment,S),f=L(S),fe(g.$$.fragment,S),k=L(S),fe(h.$$.fragment,S),S.forEach(m),this.h()},h(){p(e,"class","app svelte-1p29ced"),$(e,"cursor-hidden",t[3])},m(y,S){R(y,e,S),ce(s,e,null),c(e,l),ce(i,e,null),c(e,a),ce(r,e,null),c(e,n),ce(o,e,null),c(e,u),ce(d,e,null),c(e,f),ce(g,e,null),c(e,k),ce(h,e,null),b=!0,v||(T=[ie(window,"keydown",t[8]),ie(window,"mousemove",t[9])],v=!0)},p(y,[S]){const I={};s.$set(I);const P={};S&1&&(P.visible=y[0].panelsVisible),i.$set(P);const F={};S&1&&(F.visible=y[0].panelsVisible),r.$set(F);const z={};S&1&&(z.visible=y[0].panelsVisible),o.$set(z);const U={};S&1&&(U.visible=y[0].panelsVisible),d.$set(U);const N={};S&1&&(N.visible=y[0].panelsVisible),g.$set(N);const O={};S&4&&(O.visible=y[2]),h.$set(O),(!b||S&8)&&$(e,"cursor-hidden",y[3])},i(y){b||(J(s.$$.fragment,y),J(i.$$.fragment,y),J(r.$$.fragment,y),J(o.$$.fragment,y),J(d.$$.fragment,y),J(g.$$.fragment,y),J(h.$$.fragment,y),b=!0)},o(y){ee(s.$$.fragment,y),ee(i.$$.fragment,y),ee(r.$$.fragment,y),ee(o.$$.fragment,y),ee(d.$$.fragment,y),ee(g.$$.fragment,y),ee(h.$$.fragment,y),b=!1},d(y){y&&m(e),t[11](null),de(s),de(i),de(r),de(o),de(d),de(g),de(h),v=!1,We(T)}}}const _t="soundart-seen-info",pi=3e3;function mi(t,e,s){let l,i,a;Ee(t,tt,P=>s(10,l=P)),Ee(t,ge,P=>s(0,i=P)),Ee(t,pt,P=>s(13,a=P));let r,n=!1,o=!1,u=null;async function d(){return r?await r.enableMicrophone():!1}function f(){r&&r.disableMicrophone()}async function g(){a?f():await d()}function k(){s(2,n=!0)}function h(){s(2,n=!1),localStorage.setItem(_t,"true")}function b(){n?h():k()}function v(P){if(!(P.target instanceof HTMLInputElement||P.target instanceof HTMLTextAreaElement))switch(P.key){case"ArrowUp":P.preventDefault(),n||Dt(.1);break;case"ArrowDown":P.preventDefault(),n||Dt(-.1);break;case"ArrowRight":P.preventDefault(),n||Vt(.1);break;case"ArrowLeft":P.preventDefault(),n||Vt(-.1);break;case"m":case"M":n||g();break;case"f":case"F":n||T();break;case"h":case"H":Js();break;case"?":b();break;case"r":case"R":n||ws();break;case"s":case"S":n||ks();break;case"p":case"P":n||_s();break}}async function T(){document.fullscreenElement?(await document.exitFullscreen(),ge.update(P=>({...P,fullscreen:!1}))):(await document.documentElement.requestFullscreen(),ge.update(P=>({...P,fullscreen:!0})))}function M(){ge.update(P=>({...P,fullscreen:!!document.fullscreenElement}))}function y(){o&&s(3,o=!1),u&&clearTimeout(u),u=setTimeout(()=>{s(3,o=!0)},pi)}function S(){y()}hs(()=>{Qs(),document.addEventListener("fullscreenchange",M),y(),localStorage.getItem(_t)||setTimeout(()=>{s(2,n=!0)},800);const P=localStorage.getItem(_t)?500:1500;return setTimeout(()=>{d()},P),()=>{document.removeEventListener("fullscreenchange",M),u&&clearTimeout(u)}});function I(P){Te[P?"unshift":"push"](()=>{r=P,s(1,r)})}return t.$$.update=()=>{if(t.$$.dirty&1025&&i.devicePreset==="auto"&&l.detectedPreset){const F=De(tt).detectedPreset,z=Ge[F],U=De(ge);(U.targetFps!==z.targetFps||U.resolutionScale!==z.resolutionScale||U.maxActiveLayers!==z.maxActiveLayers||U.feedbackEnabled!==z.feedbackEnabled)&&Mt("auto")}},[i,r,n,o,d,f,k,h,v,S,l,I]}class yi extends Ne{constructor(e){super(),Oe(this,e,mi,hi,Re,{})}}export{yi as component};
