import{r as Oe,P as xe,s as Le,n as ke,d as h,i as z,Q as le,A as m,c as w,e as B,h as T,k as ye,x as zt,R as Qt,C as pe,a as de,S as j,b as p,f as Q,g as U,t as J,j as V,T as Nt,U as Jt,V as ut,W as ft,B as Ze,v as ve,X as me,Y as be}from"../chunks/D6DlaX6_.js";import{a as $,t as G,S as Be,i as Pe,g as Ie,c as De,d as ee,m as te,e as ie,b as ne,f as _e}from"../chunks/COUIFFA3.js";import{b as $t,d as lt,w as Ce}from"../chunks/BcoWwgy0.js";function Ye(i){return i?.length!==void 0?i:Array.from(i)}function qt(i,e){G(i,1,1,()=>{e.delete(i.key)})}function Ot(i,e,n,t,a,l,r,o,s,f,u,c){let g=i.length,b=l.length,_=g;const M={};for(;_--;)M[i[_].key]=_;const E=[],k=new Map,L=new Map,d=[];for(_=b;_--;){const R=c(a,l,_),v=n(R);let A=r.get(v);A?d.push(()=>A.p(R,e)):(A=f(v,R),A.c()),k.set(v,E[_]=A),v in M&&L.set(v,Math.abs(_-M[v]))}const C=new Set,y=new Set;function N(R){$(R,1),R.m(o,u),r.set(R.key,R),u=R.first,b--}for(;g&&b;){const R=E[b-1],v=i[g-1],A=R.key,F=v.key;R===v?(u=R.first,g--,b--):k.has(F)?!r.has(A)||C.has(A)?N(R):y.has(F)?g--:L.get(A)>L.get(F)?(y.add(A),N(R)):(C.add(F),g--):(s(v,r),g--)}for(;g--;){const R=i[g];k.has(R.key)||s(R,r)}for(;b;)N(E[b-1]);return Oe(d),E}const et=new Map;async function Xt(i){if(et.has(i))return et.get(i);const e=await fetch(i);if(!e.ok)throw new Error(`Failed to load shader: ${i}`);const n=await e.text();return et.set(i,n),n}async function Gt(i,e,n=new Set){const t=/#include\s+"([^"]+)"/g;let a=i,l;const r=[];for(;(l=t.exec(i))!==null;)r.push({full:l[0],path:l[1]});for(const{full:o,path:s}of r){const f=e+s;if(n.has(f)){console.warn(`Circular include detected: ${f}`),a=a.replace(o,"");continue}n.add(f);try{let u=await Xt(f);u=await Gt(u,e,n),a=a.replace(o,u)}catch(u){console.error(`Failed to include shader: ${f}`,u),a=a.replace(o,`// Failed to include: ${s}`)}}return a}async function ct(i,e=`${$t}/shaders/`){const n=await Xt(e+i);return Gt(n,e)}function dt(i,e,n){const t=i.createShader(e);if(!t)return console.error("Failed to create shader"),null;if(i.shaderSource(t,n),i.compileShader(t),!i.getShaderParameter(t,i.COMPILE_STATUS)){const a=i.getShaderInfoLog(t);console.error("Shader compilation error:",a);const r=n.split(`
`).map((o,s)=>`${s+1}: ${o}`);return console.error(`Shader source:
`+r.join(`
`)),i.deleteShader(t),null}return t}function xt(i,e,n){const t=dt(i,i.VERTEX_SHADER,e),a=dt(i,i.FRAGMENT_SHADER,n);if(!t||!a)return null;const l=i.createProgram();if(!l)return console.error("Failed to create program"),null;if(i.attachShader(l,t),i.attachShader(l,a),i.linkProgram(l),!i.getProgramParameter(l,i.LINK_STATUS)){const r=i.getProgramInfoLog(l);return console.error("Program linking error:",r),i.deleteProgram(l),null}return i.deleteShader(t),i.deleteShader(a),l}async function mt(i,e,n,t=`${$t}/shaders/`){const[a,l]=await Promise.all([ct(e,t),ct(n,t)]);return xt(i,a,l)}const Xe=[{id:"glow",label:"Center Glow",description:"Pulsing core with arcs",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerGlow"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerGlowZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerGlowTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerGlowSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerGlowMouseSens"}],audioBindings:[{audioMetric:"beat",targetProperty:"intensity",sensitivity:1,transform:"envelope"},{audioMetric:"treble",targetProperty:"intensity",sensitivity:.5,transform:"linear"}],shaderPath:"layers/glow.glsl",randomizable:!0},{id:"turbulence",label:"Turbulence",description:"Audio-reactive turbulence",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerTurbulence"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerTurbulenceZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerTurbulenceTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerTurbulenceSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerTurbulenceMouseSens"}],audioBindings:[{audioMetric:"beat",targetProperty:"intensity",sensitivity:1,transform:"envelope"},{audioMetric:"energy",targetProperty:"intensity",sensitivity:.5,transform:"linear"},{audioMetric:"treble",targetProperty:"intensity",sensitivity:.3,transform:"linear"}],shaderPath:"layers/turbulence.glsl",randomizable:!0},{id:"displacement",label:"Displacement",description:"Cellular displacement waves",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerDisplacement"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerDisplacementZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerDisplacementTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerDisplacementSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerDisplacementMouseSens"}],audioBindings:[{audioMetric:"beat",targetProperty:"intensity",sensitivity:1,transform:"envelope"},{audioMetric:"energy",targetProperty:"intensity",sensitivity:.5,transform:"linear"},{audioMetric:"treble",targetProperty:"intensity",sensitivity:.3,transform:"linear"}],shaderPath:"layers/displacement.glsl",randomizable:!0},{id:"starfield",label:"Starfield",description:"Warp tunnel streaks",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerStarfield"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerStarfieldZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerStarfieldTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerStarfieldSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerStarfieldMouseSens"}],audioBindings:[{audioMetric:"beat",targetProperty:"intensity",sensitivity:1,transform:"envelope"}],shaderPath:"layers/starfield.glsl",randomizable:!0},{id:"cubescape",label:"Cubescape",description:"3D cube lattice",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerCubescape"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerCubescapeZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerCubescapeTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerCubescapeSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerCubescapeMouseSens"}],audioBindings:[{audioMetric:"beat",targetProperty:"intensity",sensitivity:1,transform:"envelope"},{audioMetric:"energy",targetProperty:"intensity",sensitivity:.5,transform:"linear"}],shaderPath:"layers/cubescape.glsl",randomizable:!0},{id:"spires",label:"Spires",description:"Cathedral-like pillars",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerSpires"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerSpiresZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerSpiresTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerSpiresSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerSpiresMouseSens"}],audioBindings:[{audioMetric:"beat",targetProperty:"intensity",sensitivity:1,transform:"envelope"},{audioMetric:"energy",targetProperty:"intensity",sensitivity:.5,transform:"linear"},{audioMetric:"treble",targetProperty:"intensity",sensitivity:.3,transform:"linear"}],shaderPath:"layers/spires.glsl",randomizable:!0},{id:"mandala",label:"Mandala",description:"Radial symmetries",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerMandala"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerMandalaZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerMandalaTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerMandalaSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerMandalaMouseSens"}],audioBindings:[{audioMetric:"beat",targetProperty:"intensity",sensitivity:1,transform:"envelope"},{audioMetric:"energy",targetProperty:"intensity",sensitivity:.5,transform:"linear"}],shaderPath:"layers/mandala.glsl",randomizable:!0},{id:"kaleidoscope",label:"Kaleidoscope",description:"Sacred geometry mirroring",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerKaleidoscope"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerKaleidoscopeZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerKaleidoscopeTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerKaleidoscopeSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerKaleidoscopeMouseSens"}],audioBindings:[{audioMetric:"treble",targetProperty:"intensity",sensitivity:1,transform:"linear"}],shaderPath:"layers/kaleidoscope.glsl",randomizable:!0},{id:"lissajous",label:"Lissajous",description:"Flowing curves",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerLissajous"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerLissajousZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerLissajousTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerLissajousSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerLissajousMouseSens"}],audioBindings:[{audioMetric:"energy",targetProperty:"intensity",sensitivity:1,transform:"linear"}],shaderPath:"layers/lissajous.glsl",randomizable:!0},{id:"flower",label:"Flower of Life",description:"Sacred circles",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerFlower"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerFlowerZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerFlowerTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerFlowerSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerFlowerMouseSens"}],audioBindings:[{audioMetric:"beat",targetProperty:"intensity",sensitivity:1,transform:"envelope"}],shaderPath:"layers/flower.glsl",randomizable:!0},{id:"fibonacci",label:"Fibonacci",description:"Golden spiral",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerFibonacci"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerFibonacciZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerFibonacciTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerFibonacciSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerFibonacciMouseSens"}],audioBindings:[{audioMetric:"beat",targetProperty:"intensity",sensitivity:1,transform:"envelope"}],shaderPath:"layers/fibonacci.glsl",randomizable:!0},{id:"hopalong",label:"Hopalong Orbits",description:"Barry Martin attractor",properties:[{id:"intensity",label:"Intensity",type:"range",default:.5,min:0,max:1,step:.01,uniform:"uLayerHopalong"},{id:"zoom",label:"Zoom",type:"range",default:1,min:.5,max:4,step:.01,uniform:"uLayerHopalongZoom"},{id:"theme",label:"Theme",type:"select",default:0,options:[],uniform:"uLayerHopalongTheme"},{id:"sensitivity",label:"Sensitivity",type:"range",default:1,min:0,max:2,step:.01,uniform:"uLayerHopalongSensitivity"},{id:"mouseSensitivity",label:"Mouse",type:"range",default:0,min:0,max:2,step:.01,uniform:"uLayerHopalongMouseSens"}],audioBindings:[{audioMetric:"beat",targetProperty:"intensity",sensitivity:1,transform:"envelope"},{audioMetric:"energy",targetProperty:"intensity",sensitivity:.5,transform:"linear"}],shaderPath:"layers/hopalong.glsl",randomizable:!0}];class ei{canvas;gl=null;program=null;uniformLocations={};mouseUniformLocations={};layerUniformLocations=new Map;reactionProgram=null;reactionUniforms={input:null,texel:null,time:null,treble:null};reactionSeeded=!1;feedbackTexture=null;feedbackReady=!1;reactionBuffer=null;positionBuffer=null;initialized=!1;currentTime=0;constructor(e){this.canvas=e}async init(){if(this.gl=this.canvas.getContext("webgl",{antialias:!1,preserveDrawingBuffer:!0}),!this.gl)return console.error("WebGL not supported"),!1;const e=this.gl;try{if(this.program=await mt(e,"quad.vert","composite.frag"),!this.program)return console.error("Failed to create shader program"),!1;if(this.reactionProgram=await mt(e,"quad.vert","reaction_diffusion.frag"),!this.reactionProgram)return console.error("Failed to create reaction-diffusion program"),!1;this.reactionUniforms={input:e.getUniformLocation(this.reactionProgram,"uInput"),texel:e.getUniformLocation(this.reactionProgram,"uTexel"),time:e.getUniformLocation(this.reactionProgram,"uTime"),treble:e.getUniformLocation(this.reactionProgram,"uTreble")}}catch(r){return console.error("Failed to load shaders:",r),!1}this.uniformLocations={time:e.getUniformLocation(this.program,"uTime"),resolution:e.getUniformLocation(this.program,"uResolution"),beat:e.getUniformLocation(this.program,"uBeat"),energy:e.getUniformLocation(this.program,"uEnergy"),treble:e.getUniformLocation(this.program,"uTreble"),feedbackTexture:e.getUniformLocation(this.program,"uFeedbackTex"),feedbackReady:e.getUniformLocation(this.program,"uFeedbackReady"),reactionTexture:e.getUniformLocation(this.program,"uReactionTex")},this.mouseUniformLocations={position:e.getUniformLocation(this.program,"uMouse"),velocity:e.getUniformLocation(this.program,"uMouseVelocity"),speed:e.getUniformLocation(this.program,"uMouseSpeed"),down:e.getUniformLocation(this.program,"uMouseDown"),click:e.getUniformLocation(this.program,"uMouseClick")};for(const r of Xe)for(const o of r.properties){const s=e.getUniformLocation(this.program,o.uniform);this.layerUniformLocations.set(o.uniform,s)}this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer);const n=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW);const t=e.getAttribLocation(this.program,"aPosition");e.enableVertexAttribArray(t),e.vertexAttribPointer(t,2,e.FLOAT,!1,0,0),this.feedbackTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.feedbackTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.canvas.width,this.canvas.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const a=Math.max(1,this.canvas.width),l=Math.max(1,this.canvas.height);return this.reactionBuffer=this.createPingPongBuffer(a,l),this.initialized=!0,!0}resize(){if(!this.gl||!this.canvas)return;const e=this.gl,n=window.devicePixelRatio||1,t=Math.floor(this.canvas.clientWidth*n),a=Math.floor(this.canvas.clientHeight*n);(this.canvas.width!==t||this.canvas.height!==a)&&(this.canvas.width=t,this.canvas.height=a,e.viewport(0,0,t,a),this.feedbackTexture&&(e.bindTexture(e.TEXTURE_2D,this.feedbackTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,a,0,e.RGBA,e.UNSIGNED_BYTE,null)),this.reactionBuffer&&(this.resizePingPongBuffer(this.reactionBuffer,t,a),this.reactionSeeded=!1),this.feedbackReady=!1)}render(e,n,t,a){if(!this.gl||!this.program||!this.initialized)return;const l=this.gl;this.currentTime=e,this.resize(),this.renderReactionDiffusion(8,n.treble),l.clearColor(0,0,0,1),l.clear(l.COLOR_BUFFER_BIT),l.useProgram(this.program);const r=l.getAttribLocation(this.program,"aPosition");l.bindBuffer(l.ARRAY_BUFFER,this.positionBuffer),l.enableVertexAttribArray(r),l.vertexAttribPointer(r,2,l.FLOAT,!1,0,0),l.uniform1f(this.uniformLocations.time,e),l.uniform2f(this.uniformLocations.resolution,this.canvas.width,this.canvas.height),l.uniform1f(this.uniformLocations.beat,n.beat),l.uniform1f(this.uniformLocations.energy,n.energy),l.uniform1f(this.uniformLocations.treble,n.treble),l.uniform2f(this.mouseUniformLocations.position,t.x,t.y),l.uniform2f(this.mouseUniformLocations.velocity,t.velocityX,t.velocityY),l.uniform1f(this.mouseUniformLocations.speed,t.speed),l.uniform1f(this.mouseUniformLocations.down,t.down),l.uniform2f(this.mouseUniformLocations.click,t.clickX,t.clickY);for(const[o,s]of Object.entries(a)){const f=this.layerUniformLocations.get(o);f&&l.uniform1f(f,s)}l.activeTexture(l.TEXTURE0),this.feedbackTexture&&this.feedbackReady?l.bindTexture(l.TEXTURE_2D,this.feedbackTexture):l.bindTexture(l.TEXTURE_2D,null),l.uniform1i(this.uniformLocations.feedbackTexture,0),l.uniform1f(this.uniformLocations.feedbackReady,this.feedbackReady?1:0),l.activeTexture(l.TEXTURE1),this.reactionBuffer&&this.reactionBuffer.textures[this.reactionBuffer.index]?l.bindTexture(l.TEXTURE_2D,this.reactionBuffer.textures[this.reactionBuffer.index]):l.bindTexture(l.TEXTURE_2D,null),l.uniform1i(this.uniformLocations.reactionTexture,1),l.drawArrays(l.TRIANGLES,0,6),this.canvas.width>0&&this.canvas.height>0&&this.feedbackTexture&&(l.bindTexture(l.TEXTURE_2D,this.feedbackTexture),l.copyTexSubImage2D(l.TEXTURE_2D,0,0,0,0,0,this.canvas.width,this.canvas.height),this.feedbackReady=!0),l.activeTexture(l.TEXTURE0)}dispose(){if(!this.gl)return;const e=this.gl;this.program&&(e.deleteProgram(this.program),this.program=null),this.reactionProgram&&(e.deleteProgram(this.reactionProgram),this.reactionProgram=null),this.positionBuffer&&(e.deleteBuffer(this.positionBuffer),this.positionBuffer=null),this.feedbackTexture&&(e.deleteTexture(this.feedbackTexture),this.feedbackTexture=null),this.reactionBuffer&&(this.disposePingPongBuffer(this.reactionBuffer),this.reactionBuffer=null),this.reactionSeeded=!1,this.initialized=!1}isInitialized(){return this.initialized}getCanvas(){return this.canvas}createPingPongBuffer(e,n){if(!this.gl)return null;const t=this.gl,a={textures:[null,null],framebuffers:[null,null],index:0,width:e,height:n};for(let l=0;l<2;l++){const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),a.textures[l]=r;const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const s=t.checkFramebufferStatus(t.FRAMEBUFFER);s!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer not complete:",s),a.framebuffers[l]=o}return t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,null),a}swapPingPong(e){e.index=1-e.index}resizePingPongBuffer(e,n,t){if(!this.gl||e.width===n&&e.height===t)return;const a=this.gl;e.width=n,e.height=t;for(let l=0;l<2;l++)e.textures[l]&&(a.bindTexture(a.TEXTURE_2D,e.textures[l]),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,n,t,0,a.RGBA,a.UNSIGNED_BYTE,null));a.bindTexture(a.TEXTURE_2D,null)}disposePingPongBuffer(e){if(!this.gl)return;const n=this.gl;for(let t=0;t<2;t++)e.textures[t]&&(n.deleteTexture(e.textures[t]),e.textures[t]=null),e.framebuffers[t]&&(n.deleteFramebuffer(e.framebuffers[t]),e.framebuffers[t]=null)}seedReactionBuffer(){if(!this.gl||!this.reactionBuffer)return;const e=this.gl,n=this.reactionBuffer.width,t=this.reactionBuffer.height,a=new Uint8Array(n*t*4);for(let l=0;l<t;l++)for(let r=0;r<n;r++){const o=(l*n+r)*4;a[o]=255;const s=r-n/2,f=l-t/2,u=Math.sqrt(s*s+f*f),c=Math.min(n,t)*.3;u<c&&Math.random()<.15?a[o+1]=255:a[o+1]=0,a[o+2]=0,a[o+3]=255}for(let l=0;l<2;l++)e.bindTexture(e.TEXTURE_2D,this.reactionBuffer.textures[l]),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,t,0,e.RGBA,e.UNSIGNED_BYTE,a);e.bindTexture(e.TEXTURE_2D,null),this.reactionSeeded=!0}renderReactionDiffusion(e,n){if(!this.gl||!this.reactionProgram||!this.reactionBuffer||!this.positionBuffer)return;const t=this.gl;this.reactionSeeded||this.seedReactionBuffer(),t.useProgram(this.reactionProgram);const a=t.getAttribLocation(this.reactionProgram,"aPosition");t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),t.uniform2f(this.reactionUniforms.texel,1/this.reactionBuffer.width,1/this.reactionBuffer.height),t.uniform1f(this.reactionUniforms.time,this.currentTime),t.uniform1f(this.reactionUniforms.treble,n);for(let l=0;l<e;l++){const r=this.reactionBuffer.index,o=1-r;t.bindFramebuffer(t.FRAMEBUFFER,this.reactionBuffer.framebuffers[o]),t.viewport(0,0,this.reactionBuffer.width,this.reactionBuffer.height),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.reactionBuffer.textures[r]),t.uniform1i(this.reactionUniforms.input,0),t.drawArrays(t.TRIANGLES,0,6),this.swapPingPong(this.reactionBuffer)}t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,this.canvas.width,this.canvas.height)}}function Ge(i,e,n){return i+(e-i)*n}function ti(i,e,n){return Math.min(Math.max(i,e),n)}class ii{context=null;analyser=null;source=null;freqData=null;stream=null;energy=0;treble=0;highs=0;mids=0;lows=0;bass=0;beatValue=0;beatCutoff=0;beatHold=0;smoothing=.3;beatFalloff=2.4;beatMin=.15;beatDecay=.98;beatHoldTime=.08;async init(){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});const e=window.AudioContext||window.webkitAudioContext;return this.context=new e,this.source=this.context.createMediaStreamSource(this.stream),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=2048,this.analyser.smoothingTimeConstant=.8,this.source.connect(this.analyser),this.freqData=new Uint8Array(this.analyser.frequencyBinCount),!0}catch(e){return console.error("Failed to initialize audio:",e),!1}}dispose(){this.source&&(this.source.disconnect(),this.source=null),this.context&&(this.context.close(),this.context=null),this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.analyser=null,this.freqData=null}update(e){if(!this.analyser||!this.freqData)return this.getEmptyMetrics();this.analyser.getByteFrequencyData(this.freqData);const n=this.freqData.length,a=(this.context?.sampleRate||44100)/this.analyser.fftSize,l=120,r=200,o=2e3,s=6e3,f=Math.max(2,Math.floor(l/a)),u=Math.max(f+1,Math.floor(r/a)),c=Math.max(u+1,Math.floor(o/a)),g=Math.max(c+1,Math.floor(s/a)),b=Math.min(n-1,u),_=Math.min(n-1,c),M=Math.min(n-1,g);let E=0,k=0,L=0,d=0,C=0,y=0;for(let Z=0;Z<n;Z++){const Y=this.freqData[Z];E+=Y,Z<f&&(k+=Y),Z<b?L+=Y:Z<_?d+=Y:Z<M?C+=Y:y+=Y}const N=E/(n*255),R=k/(Math.max(1,f)*255),v=L/(Math.max(1,b)*255),A=d/(Math.max(1,_-b)*255),F=C/(Math.max(1,M-_)*255),O=y/(Math.max(1,n-M)*255);this.energy=Ge(this.energy,N,this.smoothing),this.treble=Ge(this.treble,O,this.smoothing),this.highs=Ge(this.highs,F,this.smoothing),this.mids=Ge(this.mids,A,this.smoothing),this.lows=Ge(this.lows,v,this.smoothing),this.bass=Ge(this.bass,R,this.smoothing);const X=Math.max(0,e);return this.beatValue=Math.max(0,this.beatValue-X*this.beatFalloff),v>this.beatCutoff&&v>this.beatMin&&(this.beatValue=ti(v*1.5,0,1),this.beatCutoff=v*1.1,this.beatHold=this.beatHoldTime),this.beatHold>0?this.beatHold-=X:this.beatCutoff=Math.max(this.beatMin,this.beatCutoff-X*this.beatDecay),{energy:this.energy,treble:this.treble,highs:this.highs,mids:this.mids,lows:this.lows,bass:this.bass,beat:this.beatValue}}getEmptyMetrics(){return{energy:0,treble:0,highs:0,mids:0,lows:0,bass:0,beat:0}}isInitialized(){return this.analyser!==null}}const ni={energy:0,treble:0,bass:0,mids:0,highs:0,lows:0,beat:0},ai={sensitivity:1,highsBoost:1,midsBoost:1,lowsBoost:1,trebleBoost:1,bassBoost:1,beatBoost:1,minMotion:.02,beatGate:.35,autoEnabled:!1,autoStrength:.4,autoDecay:.6,autoTarget:"all"},Ht=Ce(ni),ge=Ce(ai),at=Ce(!1),jt=Ce(0);function Te(i,e,n){return Math.min(Math.max(i,e),n)}const st=lt([Ht,ge,jt],([i,e,n])=>{const t=Te(e.sensitivity,0,2);let a=Te(i.energy*t,0,2),l=Te(i.treble*t*e.trebleBoost,0,2),r=Te(i.beat*t*e.beatBoost*e.bassBoost,0,2);const o=(e.highsBoost+e.midsBoost+e.lowsBoost)/3;if(a*=o,a=Math.max(a,e.minMotion),l=Math.max(l,e.minMotion),r=Math.max(r,e.minMotion),e.autoEnabled&&n>0){const s=n*e.autoStrength;switch(e.autoTarget){case"energy":a+=s;break;case"treble":l+=s;break;case"beat":r+=s;break;default:a+=s,l+=s,r+=s}}return{energy:Te(a,0,2),treble:Te(l,0,2),beat:Te(r,0,2),raw:{highs:Te(i.highs*t,0,2),mids:Te(i.mids*t,0,2),lows:Te(i.lows*t,0,2),treble:Te(i.treble*t,0,2),bass:Te(i.bass*t,0,2),beat:Te(i.beat*t,0,2)}}});function li(){const i=new Map;for(const e of Xe){const n={};for(const t of e.properties)n[t.id]=t.default;i.set(e.id,{id:e.id,enabled:!1,properties:n,includeInRandomizer:e.randomizable!==!1,includeInStrobe:e.randomizable!==!1})}return i}const Ae=Ce(li());function ht(i,e,n){Ae.update(t=>{const a=t.get(i);return a&&(a.properties[e]=n),t})}function si(i){Ae.update(e=>{const n=e.get(i);if(n&&(n.enabled=!n.enabled,n.enabled)){const a=Xe.find(l=>l.id===i)?.properties.find(l=>l.id==="intensity");a&&(n.properties.intensity=a.default)}return e})}function ri(i){Ae.update(e=>{const n=e.get(i);return n&&(n.includeInRandomizer=!n.includeInRandomizer),e})}function oi(i){Ae.update(e=>{const n=e.get(i);return n&&(n.includeInStrobe=!n.includeInStrobe),e})}function ui(i){Ae.update(e=>{for(const n of e.values())if(n.enabled=i,i){const a=Xe.find(l=>l.id===n.id)?.properties.find(l=>l.id==="intensity");a&&(n.properties.intensity=a.default)}return e})}const fi=lt([Ae,st],([i,e])=>{const n={};for(const t of Xe){const a=i.get(t.id);if(a){for(const l of t.properties){let r=a.properties[l.id]??l.default;l.id==="intensity"&&!a.enabled&&(r=0),n[l.uniform]=r}for(const l of t.audioBindings)if(e[l.audioMetric],t.properties.find(o=>o.id===l.targetProperty)){const o=t.properties.find(s=>s.id==="sensitivity");o&&(n[o.uniform]=a.properties.sensitivity??1)}}}return n}),ci={panelsVisible:!0,fullscreen:!1,pipEnabled:!1,powerSaverEnabled:!1,targetFps:60,randomizerEnabled:!0,randomizerCooldown:2,randomizerTogglesLayers:!0,randomizerToggleChance:.3},ce=Ce(ci);function di(){ce.update(i=>({...i,panelsVisible:!i.panelsVisible}))}function mi(){ce.update(i=>({...i,powerSaverEnabled:!i.powerSaverEnabled}))}function hi(){ce.update(i=>({...i,randomizerEnabled:!i.randomizerEnabled}))}function pi(){ce.update(i=>({...i,randomizerTogglesLayers:!i.randomizerTogglesLayers}))}const rt=[{id:0,label:"LSD (Rainbow)",preview:"linear-gradient(90deg, #ff0000, #ff8800, #ffff00, #00ff00, #00ffff, #0088ff, #8800ff, #ff00ff)",brightness:"bright",temperature:"neutral",saturation:"high",family:"spectrum"},{id:1,label:"Sunset",preview:"linear-gradient(90deg, #ff2e1f, #ff8c1f, #ffd940)",brightness:"bright",temperature:"warm",saturation:"high",family:"fire"},{id:2,label:"Aurora",preview:"linear-gradient(90deg, #0dd9b3, #1a59ff, #8ce6ff)",brightness:"medium",temperature:"cool",saturation:"high",family:"ocean"},{id:3,label:"Ultraviolet",preview:"linear-gradient(90deg, #8c26ff, #ff33bf, #3366ff)",brightness:"medium",temperature:"cool",saturation:"high",family:"cosmic"},{id:4,label:"Neon",preview:"linear-gradient(90deg, #1aff73, #ff1ad9)",brightness:"bright",temperature:"neutral",saturation:"high",family:"neon"},{id:5,label:"Split Complement",preview:"linear-gradient(90deg, #14d1ff, #ff7333, #cc33ff)",brightness:"bright",temperature:"neutral",saturation:"high",family:"spectrum"},{id:6,label:"Analogous Cool",preview:"linear-gradient(90deg, #14e6bf, #268cff, #6640ff)",brightness:"medium",temperature:"cool",saturation:"high",family:"ocean"},{id:7,label:"Tetradic",preview:"linear-gradient(90deg, #ff4d59, #33e699, #4073ff, #ffd933)",brightness:"bright",temperature:"neutral",saturation:"high",family:"spectrum"},{id:8,label:"Pastel Triad",preview:"linear-gradient(90deg, #e6a3a3, #a3e6b8, #a3b8e6)",brightness:"medium",temperature:"neutral",saturation:"low",family:"twilight"},{id:9,label:"Bioluminescent",preview:"linear-gradient(90deg, #001426, #00a3cc, #4dff99, #004066)",brightness:"dark",temperature:"cool",saturation:"medium",family:"ocean"},{id:10,label:"Iridescent",preview:"linear-gradient(90deg, #1a004d, #0080a6, #e6338c, #ffcc33, #33e666)",brightness:"medium",temperature:"neutral",saturation:"medium",family:"twilight"},{id:11,label:"Chromatic",preview:"linear-gradient(90deg, #ff0066, #00ff88, #0066ff, #ff0066)",brightness:"bright",temperature:"neutral",saturation:"high",family:"neon"},{id:12,label:"Golden Liminal",preview:"linear-gradient(90deg, #ffbf4d, #d9738c, #664db3, #261a59)",brightness:"medium",temperature:"warm",saturation:"medium",family:"twilight"},{id:13,label:"OK Rainbow",preview:"linear-gradient(90deg, #ff6b8a, #e6a040, #8fbf40, #40bfbf, #6b8aff, #bf40bf)",brightness:"medium",temperature:"neutral",saturation:"medium",family:"spectrum"},{id:14,label:"Synesthetic",preview:"linear-gradient(90deg, #7733ff, #cc33cc, #ff33aa, #ff66cc)",brightness:"medium",temperature:"cool",saturation:"high",family:"cosmic"},{id:15,label:"Entropy",preview:"linear-gradient(90deg, #00ffff, #1a0033, #ff4d00, #00cc33)",brightness:"medium",temperature:"neutral",saturation:"high",family:"neon"},{id:16,label:"Velvet Depths",preview:"linear-gradient(90deg, #1f142e, #8c59a6, #e6d9f2, #402659)",brightness:"dark",temperature:"cool",saturation:"low",family:"cosmic"},{id:17,label:"Solar Flare",preview:"linear-gradient(90deg, #1a0000, #cc1a00, #ff9900, #ffffb3)",brightness:"bright",temperature:"warm",saturation:"high",family:"fire"},{id:18,label:"Void Pulse",preview:"linear-gradient(90deg, #000000, #660019, #cc3366, #000000)",brightness:"dark",temperature:"warm",saturation:"low",family:"cosmic"},{id:19,label:"Starless Night",preview:"linear-gradient(90deg, #050a14, #1a3a66, #050a14)",brightness:"dark",temperature:"cool",saturation:"low",family:"ocean"},{id:20,label:"Event Horizon",preview:"linear-gradient(90deg, #000000, #000000, #ff6619, #99ccff, #000000)",brightness:"dark",temperature:"neutral",saturation:"medium",family:"cosmic"}],gi={spectrum:[0,5,7,13],fire:[1,12,17,18],ocean:[2,6,9,19],cosmic:[3,14,16,18,20],neon:[4,11,15],twilight:[8,10,12]};function Je(i){return rt.find(e=>e.id===i)}const vi={dark:.2,medium:.5,bright:1},pt=Ce({lastChangeTime:0,cooldown:2}),gt=2.5;function tt(i,e){return i+Math.random()*(e-i)}function Zt(i,e){return Math.floor(Math.random()*(e-i+1))+i}function it(i){if(i.length===0)throw new Error("randomChoice called with empty array");return i[Zt(0,i.length-1)]}function bi(i,e){let n=0;for(const[t,a]of i)if(a.enabled&&t!==e){const l=Je(a.properties.theme);l&&(n+=vi[l.brightness])}return n}function _i(i){return rt.filter(e=>i.includes(e.brightness))}function yi(i,e){const n={};for(const[l,r]of i)if(r.enabled&&l!==e){const o=Je(r.properties.theme);o&&(n[o.family]=(n[o.family]||0)+1)}let t=0,a=null;for(const[l,r]of Object.entries(n))r>t&&(t=r,a=l);return a}function wi(i,e){const n=bi(i,e),t=yi(i,e);let a;n>=gt?a=["dark"]:n>=gt-.5?a=["dark","medium"]:a=["dark","medium","bright"];const l=_i(a);if(l.length===0)return 0;if(t&&Math.random()<.5){const r=gi[t],o=l.filter(s=>r.includes(s.id));if(o.length>0)return it(o).id}if(Math.random()<.3){const r=new Set;for(const[o,s]of i)if(s.enabled&&o!==e){const f=Je(s.properties.theme);f&&r.add(f.temperature)}if(r.size===1){const o=[...r][0];let s=null;if(o==="warm"?s="cool":o==="cool"&&(s="warm"),s){const f=l.filter(u=>u.temperature===s);if(f.length>0)return it(f).id}}}return it(l).id}function Ti(i){const e=Je(i);if(!e)return{min:.3,max:.7};switch(e.brightness){case"dark":return{min:.5,max:.9};case"medium":return{min:.3,max:.7};case"bright":return{min:.2,max:.5}}}function Ei(i){const e=xe(ce);if(!e.randomizerEnabled)return;const n=xe(pt),t=performance.now()/1e3;if(t-n.lastChangeTime<e.randomizerCooldown||i<.6)return;const a=xe(Ae),l=Xe.filter(s=>{const f=a.get(s.id);return s.randomizable!==!1&&(f?.includeInRandomizer||f?.includeInStrobe)});if(l.length===0)return;const r=l[Zt(0,l.length-1)];a.get(r.id)&&(Ae.update(s=>{const f=s.get(r.id);if(!f)return s;if(e.randomizerTogglesLayers&&f.includeInStrobe&&Math.random()<e.randomizerToggleChance&&(f.enabled=!f.enabled),f.enabled&&f.includeInRandomizer){const u=wi(s,r.id);f.properties.theme=u;const c=Ti(u);f.properties.intensity=tt(c.min,c.max),f.properties.zoom=tt(.7,2.5),f.properties.sensitivity=tt(.5,1.5)}return s}),pt.update(s=>({...s,lastChangeTime:t})))}const ki={position:{x:.5,y:.5},velocity:{x:0,y:0},speed:0,isDown:!1,clickPosition:{x:.5,y:.5},isInside:!1},We=Ce(ki),vt=.15,Si=.1;let He={x:0,y:0},nt=0;function Ne(i,e,n){return Math.min(Math.max(i,e),n)}const Mi=lt(We,i=>(He.x+=(i.velocity.x-He.x)*vt,He.y+=(i.velocity.y-He.y)*vt,nt+=(i.speed-nt)*Si,{x:i.position.x,y:i.position.y,velocityX:Ne(He.x,-1,1),velocityY:Ne(He.y,-1,1),speed:Ne(nt,0,1),down:i.isDown?1:0,clickX:i.clickPosition.x,clickY:i.clickPosition.y,inside:i.isInside?1:0}));function Li(i,e,n,t){We.update(a=>{const l=Ne((i-n.left)/n.width,0,1),r=Ne((e-n.top)/n.height,0,1),o=Math.max(t,1),s=(l-a.position.x)/o*16.67,f=(r-a.position.y)/o*16.67,u=Math.sqrt(s*s+f*f);return{...a,position:{x:l,y:r},velocity:{x:s,y:f},speed:Ne(u*10,0,1),isInside:!0}})}function Bi(i,e,n){We.update(t=>{const a=Ne((i-n.left)/n.width,0,1),l=Ne((e-n.top)/n.height,0,1);return{...t,isDown:!0,clickPosition:{x:a,y:l}}})}function Pi(){We.update(i=>({...i,isDown:!1}))}function Ii(){We.update(i=>({...i,isInside:!1,velocity:{x:0,y:0},speed:0}))}const Di={fps:0,frameTime:0,targetFps:60,cpuSavings:0,mode:"normal"},Yt=Ce(Di);function Ri(i){let e,n,t;return{c(){e=T("canvas"),this.h()},l(a){e=w(a,"CANVAS",{class:!0,"aria-label":!0}),B(e).forEach(h),this.h()},h(){m(e,"class","visualizer-canvas svelte-1nin8xa"),m(e,"aria-label","Audio reactive canvas")},m(a,l){z(a,e,l),i[9](e),n||(t=[le(e,"click",i[1]),le(e,"touchend",i[2]),le(e,"mousemove",i[3]),le(e,"mousedown",i[4]),le(e,"mouseup",i[5]),le(e,"mouseleave",i[6])],n=!0)},p:ke,i:ke,o:ke,d(a){a&&h(e),i[9](null),n=!1,Oe(t)}}}const Ai=500,Ci=100,Qe=32;function Fi(i,e,n){let t,a,l,r,o;ye(i,ce,P=>n(22,t=P)),ye(i,fi,P=>n(23,a=P)),ye(i,Mi,P=>n(24,l=P)),ye(i,st,P=>n(25,r=P)),ye(i,ge,P=>n(26,o=P));let s,f=null,u=null,c,g=0,b=0,_=0,M=0,E=0,k=null,L=null,d=null;function C(){k=document.createElement("canvas"),k.width=Qe,k.height=Qe,L=k.getContext("2d"),d=document.querySelector('link[rel="icon"]'),d||(d=document.createElement("link"),d.rel="icon",d.type="image/png",document.head.appendChild(d))}function y(P){if(!k||!L||!d||!s||P-_<Ci)return;_=P;const H=Math.min(s.width,s.height),ae=(s.width-H)/2,W=(s.height-H)/2;L.drawImage(s,ae,W,H,H,0,0,Qe,Qe);try{d.href=k.toDataURL("image/png")}catch{}}async function N(){u||(u=new ii);const P=await u.init();return at.set(P),P}function R(){u&&(u.dispose(),u=null),at.set(!1)}function v(P){const H=1e3/t.targetFps;if(t.powerSaverEnabled){const W=P-g;if(W<H){c=window.setTimeout(()=>requestAnimationFrame(v),H-W);return}}t.powerSaverEnabled?c=window.setTimeout(()=>requestAnimationFrame(v),H):c=requestAnimationFrame(v);const ae=(P-g)/1e3;if(g=P,u?.isInitialized()){const W=u.update(ae);Ht.set(W);const se=o.beatGate,he=W.beat>se;jt.update(Se=>{if(o.autoEnabled){if(he)return 1;const fe=.5+o.autoDecay*3.5;return Math.max(0,Se-ae*fe)}return 0}),Ei(W.beat)}if(f?.isInitialized()&&(f.render(P/1e3,r,l,a),y(P)),M++,P-E>=Ai){const W=(P-E)/1e3,se=Math.round(M/W),he=t.targetFps,Se=W*1e3/M,fe=t.powerSaverEnabled?Math.round((1-he/60)*100):0;Yt.set({fps:se,frameTime:Se,targetFps:he,cpuSavings:Math.max(0,fe),mode:t.powerSaverEnabled?"power-saver":"normal"}),M=0,E=P}}zt(async()=>{if(f=new ei(s),await f.init()){const H=performance.now();g=H,E=H,C(),c=requestAnimationFrame(v)}}),Qt(()=>{c&&(cancelAnimationFrame(c),clearTimeout(c)),f&&f.dispose(),u&&u.dispose()});function A(){ce.update(P=>({...P,panelsVisible:!P.panelsVisible}))}let F=0;function O(P){const H=Date.now();H-F<300&&X(),F=H}async function X(){document.fullscreenElement?(await document.exitFullscreen(),ce.update(P=>({...P,fullscreen:!1}))):(await document.documentElement.requestFullscreen(),ce.update(P=>({...P,fullscreen:!0})))}function Z(P){if(!s)return;const H=performance.now(),ae=H-b;b=H;const W=s.getBoundingClientRect();Li(P.clientX,P.clientY,W,ae)}function Y(P){if(!s)return;const H=s.getBoundingClientRect();Bi(P.clientX,P.clientY,H)}function q(){Pi()}function I(){Ii()}function D(P){pe[P?"unshift":"push"](()=>{s=P,n(0,s)})}return[s,A,O,Z,Y,q,I,N,R,D]}class Ui extends Be{constructor(e){super(),Pe(this,e,Fi,Ri,Le,{enableMicrophone:7,disableMicrophone:8})}get enableMicrophone(){return this.$$.ctx[7]}get disableMicrophone(){return this.$$.ctx[8]}}function bt(i){let e,n=i[6](i[0])+"",t;return{c(){e=T("span"),t=J(n),this.h()},l(a){e=w(a,"SPAN",{class:!0});var l=B(e);t=Q(l,n),l.forEach(h),this.h()},h(){m(e,"class","slider-value svelte-13dvwfr")},m(a,l){z(a,e,l),p(e,t)},p(a,l){l&65&&n!==(n=a[6](a[0])+"")&&de(t,n)},d(a){a&&h(e)}}}function Vi(i){let e,n,t,a,l,r,o,s,f,u=i[5]&&bt(i);return{c(){e=T("div"),n=T("div"),t=T("span"),a=J(i[1]),l=V(),u&&u.c(),r=V(),o=T("input"),this.h()},l(c){e=w(c,"DIV",{class:!0});var g=B(e);n=w(g,"DIV",{class:!0});var b=B(n);t=w(b,"SPAN",{class:!0});var _=B(t);a=Q(_,i[1]),_.forEach(h),l=U(b),u&&u.l(b),b.forEach(h),r=U(g),o=w(g,"INPUT",{type:!0,min:!0,max:!0,step:!0,"aria-label":!0,class:!0}),g.forEach(h),this.h()},h(){m(t,"class","slider-label svelte-13dvwfr"),m(n,"class","slider-header svelte-13dvwfr"),m(o,"type","range"),m(o,"min",i[2]),m(o,"max",i[3]),m(o,"step",i[4]),o.value=i[0],m(o,"aria-label",i[1]),m(o,"class","svelte-13dvwfr"),m(e,"class","slider svelte-13dvwfr"),j(e,"compact",i[7])},m(c,g){z(c,e,g),p(e,n),p(n,t),p(t,a),p(n,l),u&&u.m(n,null),p(e,r),p(e,o),s||(f=le(o,"input",i[8]),s=!0)},p(c,[g]){g&2&&de(a,c[1]),c[5]?u?u.p(c,g):(u=bt(c),u.c(),u.m(n,null)):u&&(u.d(1),u=null),g&4&&m(o,"min",c[2]),g&8&&m(o,"max",c[3]),g&16&&m(o,"step",c[4]),g&1&&(o.value=c[0]),g&2&&m(o,"aria-label",c[1]),g&128&&j(e,"compact",c[7])},i:ke,o:ke,d(c){c&&h(e),u&&u.d(),s=!1,f()}}}function zi(i,e,n){let{label:t}=e,{value:a}=e,{min:l=0}=e,{max:r=1}=e,{step:o=.01}=e,{showValue:s=!0}=e,{formatValue:f=b=>b.toFixed(2)}=e,{compact:u=!0}=e;const c=Nt();function g(b){const _=b.target;n(0,a=parseFloat(_.value)),c("input",a)}return i.$$set=b=>{"label"in b&&n(1,t=b.label),"value"in b&&n(0,a=b.value),"min"in b&&n(2,l=b.min),"max"in b&&n(3,r=b.max),"step"in b&&n(4,o=b.step),"showValue"in b&&n(5,s=b.showValue),"formatValue"in b&&n(6,f=b.formatValue),"compact"in b&&n(7,u=b.compact)},[a,t,l,r,o,s,f,u,g]}class Ee extends Be{constructor(e){super(),Pe(this,e,zi,Vi,Le,{label:1,value:0,min:2,max:3,step:4,showValue:5,formatValue:6,compact:7})}}function Ni(i){let e,n,t,a,l,r,o;return{c(){e=T("button"),n=T("span"),t=V(),a=T("span"),l=J(i[1]),this.h()},l(s){e=w(s,"BUTTON",{class:!0,"aria-pressed":!0,type:!0});var f=B(e);n=w(f,"SPAN",{class:!0}),B(n).forEach(h),t=U(f),a=w(f,"SPAN",{class:!0});var u=B(a);l=Q(u,i[1]),u.forEach(h),f.forEach(h),this.h()},h(){m(n,"class","toggle-indicator svelte-1qxicao"),m(a,"class","toggle-label svelte-1qxicao"),m(e,"class","toggle svelte-1qxicao"),m(e,"aria-pressed",i[0]),e.disabled=i[2],m(e,"type","button"),j(e,"checked",i[0]),j(e,"disabled",i[2]),j(e,"compact",i[3])},m(s,f){z(s,e,f),p(e,n),p(e,t),p(e,a),p(a,l),r||(o=le(e,"click",i[4]),r=!0)},p(s,[f]){f&2&&de(l,s[1]),f&1&&m(e,"aria-pressed",s[0]),f&4&&(e.disabled=s[2]),f&1&&j(e,"checked",s[0]),f&4&&j(e,"disabled",s[2]),f&8&&j(e,"compact",s[3])},i:ke,o:ke,d(s){s&&h(e),r=!1,o()}}}function $i(i,e,n){let{label:t}=e,{checked:a=!1}=e,{disabled:l=!1}=e,{compact:r=!0}=e;function o(){l||n(0,a=!a)}return i.$$set=s=>{"label"in s&&n(1,t=s.label),"checked"in s&&n(0,a=s.checked),"disabled"in s&&n(2,l=s.disabled),"compact"in s&&n(3,r=s.compact)},[a,t,l,r,o]}class Wt extends Be{constructor(e){super(),Pe(this,e,$i,Ni,Le,{label:1,checked:0,disabled:2,compact:3})}}function _t(i,e,n){const t=i.slice();return t[8]=e[n],t}function yt(i){let e;return{c(){e=T("span"),this.h()},l(n){e=w(n,"SPAN",{class:!0,style:!0}),B(e).forEach(h),this.h()},h(){m(e,"class","select-preview svelte-1weciec"),Ze(e,"background",i[2].find(i[6])?.preview)},m(n,t){z(n,e,t)},p(n,t){t&5&&Ze(e,"background",n[2].find(n[6])?.preview)},d(n){n&&h(e)}}}function wt(i){let e,n=i[8].label+"",t,a;return{c(){e=T("option"),t=J(n),this.h()},l(l){e=w(l,"OPTION",{});var r=B(e);t=Q(r,n),r.forEach(h),this.h()},h(){e.__value=a=i[8].value,ft(e,e.__value)},m(l,r){z(l,e,r),p(e,t)},p(l,r){r&4&&n!==(n=l[8].label+"")&&de(t,n),r&4&&a!==(a=l[8].value)&&(e.__value=a,ft(e,e.__value))},d(l){l&&h(e)}}}function qi(i){let e,n,t,a,l,r=i[2].find(i[5])?.preview,o,s,f,u,c=r&&yt(i),g=Ye(i[2]),b=[];for(let _=0;_<g.length;_+=1)b[_]=wt(_t(i,g,_));return{c(){e=T("div"),n=T("span"),t=J(i[1]),a=V(),l=T("div"),c&&c.c(),o=V(),s=T("select");for(let _=0;_<b.length;_+=1)b[_].c();this.h()},l(_){e=w(_,"DIV",{class:!0});var M=B(e);n=w(M,"SPAN",{class:!0});var E=B(n);t=Q(E,i[1]),E.forEach(h),a=U(M),l=w(M,"DIV",{class:!0});var k=B(l);c&&c.l(k),o=U(k),s=w(k,"SELECT",{"aria-label":!0,class:!0});var L=B(s);for(let d=0;d<b.length;d+=1)b[d].l(L);L.forEach(h),k.forEach(h),M.forEach(h),this.h()},h(){m(n,"class","select-label svelte-1weciec"),m(s,"aria-label",i[1]),m(s,"class","svelte-1weciec"),m(l,"class","select-container svelte-1weciec"),m(e,"class","select-wrapper svelte-1weciec"),j(e,"compact",i[3])},m(_,M){z(_,e,M),p(e,n),p(n,t),p(e,a),p(e,l),c&&c.m(l,null),p(l,o),p(l,s);for(let E=0;E<b.length;E+=1)b[E]&&b[E].m(s,null);ut(s,i[0]),f||(u=le(s,"change",i[4]),f=!0)},p(_,[M]){if(M&2&&de(t,_[1]),M&5&&(r=_[2].find(_[5])?.preview),r?c?c.p(_,M):(c=yt(_),c.c(),c.m(l,o)):c&&(c.d(1),c=null),M&4){g=Ye(_[2]);let E;for(E=0;E<g.length;E+=1){const k=_t(_,g,E);b[E]?b[E].p(k,M):(b[E]=wt(k),b[E].c(),b[E].m(s,null))}for(;E<b.length;E+=1)b[E].d(1);b.length=g.length}M&5&&ut(s,_[0]),M&2&&m(s,"aria-label",_[1]),M&8&&j(e,"compact",_[3])},i:ke,o:ke,d(_){_&&h(e),c&&c.d(),Jt(b,_),f=!1,u()}}}function Oi(i,e,n){let{label:t}=e,{value:a}=e,{options:l=[]}=e,{compact:r=!0}=e;const o=Nt();function s(c){const g=c.target;n(0,a=isNaN(Number(g.value))?g.value:Number(g.value)),o("change",a)}const f=c=>c.value===a,u=c=>c.value===a;return i.$$set=c=>{"label"in c&&n(1,t=c.label),"value"in c&&n(0,a=c.value),"options"in c&&n(2,l=c.options),"compact"in c&&n(3,r=c.compact)},[a,t,l,r,s,f,u]}class Kt extends Be{constructor(e){super(),Pe(this,e,Oi,qi,Le,{label:1,value:0,options:2,compact:3})}}function Xi(i){let e,n,t,a,l,r,o,s,f;return{c(){e=T("div"),n=T("span"),t=J(i[0]),a=V(),l=T("div"),r=T("div"),o=V(),s=T("span"),f=J(i[1]),this.h()},l(u){e=w(u,"DIV",{class:!0});var c=B(e);n=w(c,"SPAN",{class:!0});var g=B(n);t=Q(g,i[0]),g.forEach(h),a=U(c),l=w(c,"DIV",{class:!0});var b=B(l);r=w(b,"DIV",{class:!0,style:!0}),B(r).forEach(h),b.forEach(h),o=U(c),s=w(c,"SPAN",{class:!0});var _=B(s);f=Q(_,i[1]),_.forEach(h),c.forEach(h),this.h()},h(){m(n,"class","level-label svelte-2vktfp"),m(r,"class","level-fill svelte-2vktfp"),Ze(r,"width",i[2]+"%"),m(l,"class","level-bar svelte-2vktfp"),m(s,"class","level-value svelte-2vktfp"),m(e,"class","level-meter svelte-2vktfp")},m(u,c){z(u,e,c),p(e,n),p(n,t),p(e,a),p(e,l),p(l,r),p(e,o),p(e,s),p(s,f)},p(u,[c]){c&1&&de(t,u[0]),c&4&&Ze(r,"width",u[2]+"%"),c&2&&de(f,u[1])},i:ke,o:ke,d(u){u&&h(e)}}}function Gi(i,e,n){let t,a,{label:l}=e,{value:r=0}=e,{max:o=1}=e;return i.$$set=s=>{"label"in s&&n(0,l=s.label),"value"in s&&n(3,r=s.value),"max"in s&&n(4,o=s.max)},i.$$.update=()=>{i.$$.dirty&24&&n(2,t=Math.min(100,r/o*100)),i.$$.dirty&8&&n(1,a=r.toFixed(2))},[l,a,t,r,o]}class je extends Be{constructor(e){super(),Pe(this,e,Gi,Xi,Le,{label:0,value:3,max:4})}}function Tt(i){let e,n,t='<span class="panel-title svelte-60ik2m">CONTROLS</span>',a,l,r,o,s,f,u,c,g='<span class="label">FULLSCR</span>',b,_,M='<span class="label">PWR SAV</span>',E,k,L='<kbd class="svelte-60ik2m">C</kbd> hide/show panels <kbd class="svelte-60ik2m">F</kbd> fullscreen',d,C;function y(v,A){return v[1]?Zi:v[2]?ji:Hi}let N=y(i),R=N(i);return{c(){e=T("div"),n=T("div"),n.innerHTML=t,a=V(),l=T("div"),r=T("button"),o=T("span"),s=V(),f=T("span"),R.c(),u=V(),c=T("button"),c.innerHTML=g,b=V(),_=T("button"),_.innerHTML=M,E=V(),k=T("div"),k.innerHTML=L,this.h()},l(v){e=w(v,"DIV",{class:!0});var A=B(e);n=w(A,"DIV",{class:!0,"data-svelte-h":!0}),me(n)!=="svelte-i65zl2"&&(n.innerHTML=t),a=U(A),l=w(A,"DIV",{class:!0});var F=B(l);r=w(F,"BUTTON",{class:!0,title:!0});var O=B(r);o=w(O,"SPAN",{class:!0}),B(o).forEach(h),s=U(O),f=w(O,"SPAN",{class:!0});var X=B(f);R.l(X),X.forEach(h),O.forEach(h),u=U(F),c=w(F,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),me(c)!=="svelte-1xg66l0"&&(c.innerHTML=g),b=U(F),_=w(F,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),me(_)!=="svelte-e1kxas"&&(_.innerHTML=M),F.forEach(h),E=U(A),k=w(A,"DIV",{class:!0,title:!0,"data-svelte-h":!0}),me(k)!=="svelte-1r8dk9l"&&(k.innerHTML=L),A.forEach(h),this.h()},h(){m(n,"class","panel-header svelte-60ik2m"),m(o,"class","indicator svelte-60ik2m"),j(o,"on",i[2]),m(f,"class","label"),m(r,"class","ctrl-btn mic svelte-60ik2m"),r.disabled=i[1],m(r,"title","Enable microphone to let visuals react to music and sounds around you"),j(r,"active",i[2]),j(r,"loading",i[1]),m(c,"class","ctrl-btn svelte-60ik2m"),m(c,"title","Enter or exit fullscreen mode for an immersive experience"),j(c,"active",i[3].fullscreen),m(_,"class","ctrl-btn svelte-60ik2m"),m(_,"title","Reduce frame rate to save battery and CPU on laptops"),j(_,"active",i[3].powerSaverEnabled),m(l,"class","controls-grid svelte-60ik2m"),m(k,"class","panel-footer svelte-60ik2m"),m(k,"title","Keyboard shortcuts for quick access"),m(e,"class","panel controls-panel svelte-60ik2m")},m(v,A){z(v,e,A),p(e,n),p(e,a),p(e,l),p(l,r),p(r,o),p(r,s),p(r,f),R.m(f,null),p(l,u),p(l,c),p(l,b),p(l,_),p(e,E),p(e,k),d||(C=[le(r,"click",i[4]),le(c,"click",i[5]),le(_,"click",mi)],d=!0)},p(v,A){A&4&&j(o,"on",v[2]),N!==(N=y(v))&&(R.d(1),R=N(v),R&&(R.c(),R.m(f,null))),A&2&&(r.disabled=v[1]),A&4&&j(r,"active",v[2]),A&2&&j(r,"loading",v[1]),A&8&&j(c,"active",v[3].fullscreen),A&8&&j(_,"active",v[3].powerSaverEnabled)},d(v){v&&h(e),R.d(),d=!1,Oe(C)}}}function Hi(i){let e;return{c(){e=J("MIC OFF")},l(n){e=Q(n,"MIC OFF")},m(n,t){z(n,e,t)},d(n){n&&h(e)}}}function ji(i){let e;return{c(){e=J("MIC ON")},l(n){e=Q(n,"MIC ON")},m(n,t){z(n,e,t)},d(n){n&&h(e)}}}function Zi(i){let e;return{c(){e=J("...")},l(n){e=Q(n,"...")},m(n,t){z(n,e,t)},d(n){n&&h(e)}}}function Yi(i){let e,n=i[0]&&Tt(i);return{c(){n&&n.c(),e=ve()},l(t){n&&n.l(t),e=ve()},m(t,a){n&&n.m(t,a),z(t,e,a)},p(t,[a]){t[0]?n?n.p(t,a):(n=Tt(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:ke,o:ke,d(t){t&&h(e),n&&n.d(t)}}}function Wi(i,e,n){let t,a;ye(i,at,u=>n(2,t=u)),ye(i,ce,u=>n(3,a=u));let{onEnableMic:l}=e,{visible:r=!0}=e,o=!1;async function s(){t||(n(1,o=!0),await l(),n(1,o=!1))}async function f(){document.fullscreenElement?(await document.exitFullscreen(),ce.update(u=>({...u,fullscreen:!1}))):(await document.documentElement.requestFullscreen(),ce.update(u=>({...u,fullscreen:!0})))}return i.$$set=u=>{"onEnableMic"in u&&n(6,l=u.onEnableMic),"visible"in u&&n(0,r=u.visible)},[r,o,t,a,s,f,l]}class Ki extends Be{constructor(e){super(),Pe(this,e,Wi,Yi,Le,{onEnableMic:6,visible:0})}}function Et(i,e,n){const t=i.slice();return t[16]=e[n].definition,t[17]=e[n].state,t}function kt(i,e,n){const t=i.slice();return t[20]=e[n],t}function St(i){let e,n,t,a,l,r,o,s="LAYERS",f,u,c=i[1].filter(It).length+"",g,b,_=i[1].length+"",M,E,k,L,d="RANDOM",C,y,N="STROBE",R,v,A=[],F=new Map,O,X,Z,Y=Ye(i[1]);const q=I=>I[16].id;for(let I=0;I<Y.length;I+=1){let D=Et(i,Y,I),P=q(D);F.set(P,A[I]=Pt(P,D))}return{c(){e=T("div"),n=T("div"),t=T("button"),a=T("span"),r=V(),o=T("span"),o.textContent=s,f=V(),u=T("span"),g=J(c),b=J("/"),M=J(_),E=V(),k=T("div"),L=T("button"),L.textContent=d,C=V(),y=T("button"),y.textContent=N,R=V(),v=T("div");for(let I=0;I<A.length;I+=1)A[I].c();this.h()},l(I){e=w(I,"DIV",{class:!0});var D=B(e);n=w(D,"DIV",{class:!0});var P=B(n);t=w(P,"BUTTON",{class:!0,title:!0,type:!0});var H=B(t);a=w(H,"SPAN",{class:!0}),B(a).forEach(h),H.forEach(h),r=U(P),o=w(P,"SPAN",{class:!0,title:!0,"data-svelte-h":!0}),me(o)!=="svelte-1k3t9ew"&&(o.textContent=s),f=U(P),u=w(P,"SPAN",{class:!0,title:!0});var ae=B(u);g=Q(ae,c),b=Q(ae,"/"),M=Q(ae,_),ae.forEach(h),P.forEach(h),E=U(D),k=w(D,"DIV",{class:!0});var W=B(k);L=w(W,"BUTTON",{class:!0,title:!0,type:!0,"data-svelte-h":!0}),me(L)!=="svelte-oljq6x"&&(L.textContent=d),C=U(W),y=w(W,"BUTTON",{class:!0,title:!0,type:!0,"data-svelte-h":!0}),me(y)!=="svelte-1j3wa1w"&&(y.textContent=N),W.forEach(h),R=U(D),v=w(D,"DIV",{class:!0});var se=B(v);for(let he=0;he<A.length;he+=1)A[he].l(se);se.forEach(h),D.forEach(h),this.h()},h(){m(a,"class","master-indicator svelte-19n2guw"),m(t,"class","master-toggle svelte-19n2guw"),m(t,"title",l=i[3]?"Turn off all layers":"Turn on all layers"),m(t,"type","button"),j(t,"active",i[3]),m(o,"class","panel-title svelte-19n2guw"),m(o,"title","Visual effect layers - toggle and customize each one"),m(u,"class","panel-count svelte-19n2guw"),m(u,"title","Number of active layers"),m(n,"class","panel-header svelte-19n2guw"),m(L,"class","global-btn svelte-19n2guw"),m(L,"title","Automatically change visual settings on every beat for variety"),m(L,"type","button"),j(L,"active",i[4].randomizerEnabled),m(y,"class","global-btn strobe svelte-19n2guw"),m(y,"title","Flash layers on/off with the beat for a strobe-like effect"),m(y,"type","button"),j(y,"active",i[4].randomizerTogglesLayers),m(k,"class","global-controls svelte-19n2guw"),m(v,"class","layer-list svelte-19n2guw"),m(e,"class","panel layers-panel svelte-19n2guw")},m(I,D){z(I,e,D),p(e,n),p(n,t),p(t,a),p(n,r),p(n,o),p(n,f),p(n,u),p(u,g),p(u,b),p(u,M),p(e,E),p(e,k),p(k,L),p(k,C),p(k,y),p(e,R),p(e,v);for(let P=0;P<A.length;P+=1)A[P]&&A[P].m(v,null);O=!0,X||(Z=[le(t,"click",i[5]),le(L,"click",hi),le(y,"click",pi)],X=!0)},p(I,D){(!O||D&8&&l!==(l=I[3]?"Turn off all layers":"Turn on all layers"))&&m(t,"title",l),(!O||D&8)&&j(t,"active",I[3]),(!O||D&2)&&c!==(c=I[1].filter(It).length+"")&&de(g,c),(!O||D&2)&&_!==(_=I[1].length+"")&&de(M,_),(!O||D&16)&&j(L,"active",I[4].randomizerEnabled),(!O||D&16)&&j(y,"active",I[4].randomizerTogglesLayers),D&198&&(Y=Ye(I[1]),Ie(),A=Ot(A,D,q,1,I,Y,F,v,qt,Pt,null,Et),De())},i(I){if(!O){for(let D=0;D<Y.length;D+=1)$(A[D]);O=!0}},o(I){for(let D=0;D<A.length;D+=1)G(A[D]);O=!1},d(I){I&&h(e);for(let D=0;D<A.length;D+=1)A[D].d();X=!1,Oe(Z)}}}function Mt(i){let e,n="R",t,a,l="S",r,o;function s(){return i[11](i[16])}function f(){return i[12](i[16])}return{c(){e=T("button"),e.textContent=n,t=V(),a=T("button"),a.textContent=l,this.h()},l(u){e=w(u,"BUTTON",{class:!0,title:!0,type:!0,"data-svelte-h":!0}),me(e)!=="svelte-mwgvpg"&&(e.textContent=n),t=U(u),a=w(u,"BUTTON",{class:!0,title:!0,type:!0,"data-svelte-h":!0}),me(a)!=="svelte-v7hsdo"&&(a.textContent=l),this.h()},h(){m(e,"class","quick-btn svelte-19n2guw"),m(e,"title","Include in randomizer - properties (theme, intensity, zoom) will change automatically"),m(e,"type","button"),j(e,"active",i[17].includeInRandomizer),m(a,"class","quick-btn strobe-btn svelte-19n2guw"),m(a,"title","Include in strobe - layer can flash on/off with the beat"),m(a,"type","button"),j(a,"active",i[17].includeInStrobe)},m(u,c){z(u,e,c),z(u,t,c),z(u,a,c),r||(o=[le(e,"click",s),le(a,"click",f)],r=!0)},p(u,c){i=u,c&2&&j(e,"active",i[17].includeInRandomizer),c&2&&j(a,"active",i[17].includeInStrobe)},d(u){u&&(h(e),h(t),h(a)),r=!1,Oe(o)}}}function Lt(i){let e,n=[],t=new Map,a,l=Ye(i[16].properties);const r=o=>o[20].id;for(let o=0;o<l.length;o+=1){let s=kt(i,l,o),f=r(s);t.set(f,n[o]=Bt(f,s))}return{c(){e=T("div");for(let o=0;o<n.length;o+=1)n[o].c();this.h()},l(o){e=w(o,"DIV",{class:!0});var s=B(e);for(let f=0;f<n.length;f+=1)n[f].l(s);s.forEach(h),this.h()},h(){m(e,"class","layer-controls svelte-19n2guw")},m(o,s){z(o,e,s);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(e,null);a=!0},p(o,s){s&66&&(l=Ye(o[16].properties),Ie(),n=Ot(n,s,r,1,o,l,t,e,qt,Bt,null,kt),De())},i(o){if(!a){for(let s=0;s<l.length;s+=1)$(n[s]);a=!0}},o(o){for(let s=0;s<n.length;s+=1)G(n[s]);a=!1},d(o){o&&h(e);for(let s=0;s<n.length;s+=1)n[s].d()}}}function Qi(i){let e,n,t,a;function l(...r){return i[15](i[16],i[20],...r)}return n=new Kt({props:{label:"Thm",value:i[17].properties[i[20].id]??i[20].default,options:i[6]}}),n.$on("change",l),{c(){e=T("div"),ne(n.$$.fragment),t=V(),this.h()},l(r){e=w(r,"DIV",{title:!0});var o=B(e);ie(n.$$.fragment,o),t=U(o),o.forEach(h),this.h()},h(){m(e,"title","Color scheme for this visual effect")},m(r,o){z(r,e,o),te(n,e,null),p(e,t),a=!0},p(r,o){i=r;const s={};o&2&&(s.value=i[17].properties[i[20].id]??i[20].default),n.$set(s)},i(r){a||($(n.$$.fragment,r),a=!0)},o(r){G(n.$$.fragment,r),a=!1},d(r){r&&h(e),ee(n)}}}function Ji(i){let e,n,t,a,l;function r(...o){return i[14](i[16],i[20],...o)}return n=new Ee({props:{label:i[20].label.slice(0,4),value:i[17].properties[i[20].id]??i[20].default,min:i[20].min??0,max:i[20].max??1,step:i[20].step??.01}}),n.$on("input",r),{c(){e=T("div"),ne(n.$$.fragment),t=V(),this.h()},l(o){e=w(o,"DIV",{title:!0});var s=B(e);ie(n.$$.fragment,s),t=U(s),s.forEach(h),this.h()},h(){m(e,"title",a=i[20].id==="intensity"?"How visible/strong this effect is":i[20].id==="zoom"?"Scale/size of the effect pattern":i[20].id==="sensitivity"?"How much this layer reacts to audio":i[20].label)},m(o,s){z(o,e,s),te(n,e,null),p(e,t),l=!0},p(o,s){i=o;const f={};s&2&&(f.label=i[20].label.slice(0,4)),s&2&&(f.value=i[17].properties[i[20].id]??i[20].default),s&2&&(f.min=i[20].min??0),s&2&&(f.max=i[20].max??1),s&2&&(f.step=i[20].step??.01),n.$set(f),(!l||s&2&&a!==(a=i[20].id==="intensity"?"How visible/strong this effect is":i[20].id==="zoom"?"Scale/size of the effect pattern":i[20].id==="sensitivity"?"How much this layer reacts to audio":i[20].label))&&m(e,"title",a)},i(o){l||($(n.$$.fragment,o),l=!0)},o(o){G(n.$$.fragment,o),l=!1},d(o){o&&h(e),ee(n)}}}function Bt(i,e){let n,t,a,l,r;const o=[Ji,Qi],s=[];function f(u,c){return u[20].type==="range"?0:u[20].type==="select"&&u[20].id==="theme"?1:-1}return~(t=f(e))&&(a=s[t]=o[t](e)),{key:i,first:null,c(){n=ve(),a&&a.c(),l=ve(),this.h()},l(u){n=ve(),a&&a.l(u),l=ve(),this.h()},h(){this.first=n},m(u,c){z(u,n,c),~t&&s[t].m(u,c),z(u,l,c),r=!0},p(u,c){e=u;let g=t;t=f(e),t===g?~t&&s[t].p(e,c):(a&&(Ie(),G(s[g],1,1,()=>{s[g]=null}),De()),~t?(a=s[t],a?a.p(e,c):(a=s[t]=o[t](e),a.c()),$(a,1),a.m(l.parentNode,l)):a=null)},i(u){r||($(a),r=!0)},o(u){G(a),r=!1},d(u){u&&(h(n),h(l)),~t&&s[t].d(u)}}}function Pt(i,e){let n,t,a,l,r,o,s=e[16].label+"",f,u,c,g,b,_,M=e[2]===e[16].id?"":"+",E,k,L,d,C,y;function N(){return e[9](e[16])}function R(){return e[10](e[16])}let v=e[16].randomizable!==!1&&Mt(e);function A(){return e[13](e[16])}let F=e[2]===e[16].id&&Lt(e);return{key:i,first:null,c(){n=T("div"),t=T("div"),a=T("button"),l=T("span"),r=V(),o=T("button"),f=J(s),c=V(),g=T("div"),v&&v.c(),b=V(),_=T("button"),E=J(M),k=V(),F&&F.c(),L=V(),this.h()},l(O){n=w(O,"DIV",{class:!0});var X=B(n);t=w(X,"DIV",{class:!0});var Z=B(t);a=w(Z,"BUTTON",{class:!0,type:!0,title:!0});var Y=B(a);l=w(Y,"SPAN",{class:!0}),B(l).forEach(h),Y.forEach(h),r=U(Z),o=w(Z,"BUTTON",{class:!0,type:!0,title:!0});var q=B(o);f=Q(q,s),q.forEach(h),c=U(Z),g=w(Z,"DIV",{class:!0});var I=B(g);v&&v.l(I),b=U(I),_=w(I,"BUTTON",{class:!0,type:!0,title:!0});var D=B(_);E=Q(D,M),D.forEach(h),I.forEach(h),Z.forEach(h),k=U(X),F&&F.l(X),L=U(X),X.forEach(h),this.h()},h(){m(l,"class","indicator svelte-19n2guw"),j(l,"active",e[17].enabled),m(a,"class","layer-toggle svelte-19n2guw"),m(a,"type","button"),m(a,"title","Turn this visual effect on or off"),m(o,"class","layer-name svelte-19n2guw"),m(o,"type","button"),m(o,"title",u=e[16].description+" - click to adjust settings"),m(_,"class","quick-btn expand-btn svelte-19n2guw"),m(_,"type","button"),m(_,"title","Expand to see detailed controls for this layer"),m(g,"class","layer-quick svelte-19n2guw"),m(t,"class","layer-row svelte-19n2guw"),m(n,"class","layer-item svelte-19n2guw"),j(n,"disabled",!e[17].enabled),j(n,"expanded",e[2]===e[16].id),this.first=n},m(O,X){z(O,n,X),p(n,t),p(t,a),p(a,l),p(t,r),p(t,o),p(o,f),p(t,c),p(t,g),v&&v.m(g,null),p(g,b),p(g,_),p(_,E),p(n,k),F&&F.m(n,null),p(n,L),d=!0,C||(y=[le(a,"click",N),le(o,"click",R),le(_,"click",A)],C=!0)},p(O,X){e=O,(!d||X&2)&&j(l,"active",e[17].enabled),(!d||X&2)&&s!==(s=e[16].label+"")&&de(f,s),(!d||X&2&&u!==(u=e[16].description+" - click to adjust settings"))&&m(o,"title",u),e[16].randomizable!==!1?v?v.p(e,X):(v=Mt(e),v.c(),v.m(g,b)):v&&(v.d(1),v=null),(!d||X&6)&&M!==(M=e[2]===e[16].id?"":"+")&&de(E,M),e[2]===e[16].id?F?(F.p(e,X),X&6&&$(F,1)):(F=Lt(e),F.c(),$(F,1),F.m(n,L)):F&&(Ie(),G(F,1,1,()=>{F=null}),De()),(!d||X&2)&&j(n,"disabled",!e[17].enabled),(!d||X&6)&&j(n,"expanded",e[2]===e[16].id)},i(O){d||($(F),d=!0)},o(O){G(F),d=!1},d(O){O&&h(n),v&&v.d(),F&&F.d(),C=!1,Oe(y)}}}function xi(i){let e,n,t=i[0]&&St(i);return{c(){t&&t.c(),e=ve()},l(a){t&&t.l(a),e=ve()},m(a,l){t&&t.m(a,l),z(a,e,l),n=!0},p(a,[l]){a[0]?t?(t.p(a,l),l&1&&$(t,1)):(t=St(a),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(Ie(),G(t,1,1,()=>{t=null}),De())},i(a){n||($(t),n=!0)},o(a){G(t),n=!1},d(a){a&&h(e),t&&t.d(a)}}}const It=i=>i.state.enabled;function en(i,e,n){let t,a,l,r;ye(i,Ae,d=>n(8,l=d)),ye(i,ce,d=>n(4,r=d));let{visible:o=!0}=e,s=null;function f(){ui(!a)}const u=rt.map(d=>({value:d.id,label:d.label,preview:d.preview}));function c(d){n(2,s=s===d?null:d)}const g=d=>si(d.id),b=d=>c(d.id),_=d=>ri(d.id),M=d=>oi(d.id),E=d=>c(d.id),k=(d,C,y)=>ht(d.id,C.id,y.detail),L=(d,C,y)=>ht(d.id,C.id,y.detail);return i.$$set=d=>{"visible"in d&&n(0,o=d.visible)},i.$$.update=()=>{i.$$.dirty&256&&n(1,t=Xe.map(d=>({definition:d,state:l.get(d.id)})).filter(d=>d.state)),i.$$.dirty&2&&n(3,a=t.some(d=>d.state.enabled))},[o,t,s,a,r,f,u,c,l,g,b,_,M,E,k,L]}class tn extends Be{constructor(e){super(),Pe(this,e,en,xi,Le,{visible:0})}}function Dt(i){let e,n,t='<span class="panel-title svelte-9wroah">LEVELS</span>',a,l,r,o,s,f,u,c,g,b,_,M,E,k,L,d,C,y,N,R;return o=new je({props:{label:"HI",value:i[1].raw.highs}}),u=new je({props:{label:"MD",value:i[1].raw.mids}}),b=new je({props:{label:"LO",value:i[1].raw.lows}}),E=new je({props:{label:"TR",value:i[1].raw.treble}}),d=new je({props:{label:"BS",value:i[1].raw.bass}}),N=new je({props:{label:"BT",value:i[1].raw.beat}}),{c(){e=T("div"),n=T("div"),n.innerHTML=t,a=V(),l=T("div"),r=T("div"),ne(o.$$.fragment),s=V(),f=T("div"),ne(u.$$.fragment),c=V(),g=T("div"),ne(b.$$.fragment),_=V(),M=T("div"),ne(E.$$.fragment),k=V(),L=T("div"),ne(d.$$.fragment),C=V(),y=T("div"),ne(N.$$.fragment),this.h()},l(v){e=w(v,"DIV",{class:!0});var A=B(e);n=w(A,"DIV",{class:!0,title:!0,"data-svelte-h":!0}),me(n)!=="svelte-1qdq6z0"&&(n.innerHTML=t),a=U(A),l=w(A,"DIV",{class:!0});var F=B(l);r=w(F,"DIV",{title:!0});var O=B(r);ie(o.$$.fragment,O),O.forEach(h),s=U(F),f=w(F,"DIV",{title:!0});var X=B(f);ie(u.$$.fragment,X),X.forEach(h),c=U(F),g=w(F,"DIV",{title:!0});var Z=B(g);ie(b.$$.fragment,Z),Z.forEach(h),_=U(F),M=w(F,"DIV",{title:!0});var Y=B(M);ie(E.$$.fragment,Y),Y.forEach(h),k=U(F),L=w(F,"DIV",{title:!0});var q=B(L);ie(d.$$.fragment,q),q.forEach(h),C=U(F),y=w(F,"DIV",{title:!0});var I=B(y);ie(N.$$.fragment,I),I.forEach(h),F.forEach(h),A.forEach(h),this.h()},h(){m(n,"class","panel-header svelte-9wroah"),m(n,"title","Real-time audio levels from your microphone"),m(r,"title","High frequencies - cymbals, hi-hats, bright sounds"),m(f,"title","Mid frequencies - vocals, guitars, main melody"),m(g,"title","Low frequencies - bass, kick drum, rumble"),m(M,"title","Treble - combined high-pitched sounds"),m(L,"title","Bass - combined low-pitched sounds"),m(y,"title","Beat detection - pulses when drums or strong beats hit"),m(l,"class","levels-grid svelte-9wroah"),m(e,"class","panel levels-panel svelte-9wroah")},m(v,A){z(v,e,A),p(e,n),p(e,a),p(e,l),p(l,r),te(o,r,null),p(l,s),p(l,f),te(u,f,null),p(l,c),p(l,g),te(b,g,null),p(l,_),p(l,M),te(E,M,null),p(l,k),p(l,L),te(d,L,null),p(l,C),p(l,y),te(N,y,null),R=!0},p(v,A){const F={};A&2&&(F.value=v[1].raw.highs),o.$set(F);const O={};A&2&&(O.value=v[1].raw.mids),u.$set(O);const X={};A&2&&(X.value=v[1].raw.lows),b.$set(X);const Z={};A&2&&(Z.value=v[1].raw.treble),E.$set(Z);const Y={};A&2&&(Y.value=v[1].raw.bass),d.$set(Y);const q={};A&2&&(q.value=v[1].raw.beat),N.$set(q)},i(v){R||($(o.$$.fragment,v),$(u.$$.fragment,v),$(b.$$.fragment,v),$(E.$$.fragment,v),$(d.$$.fragment,v),$(N.$$.fragment,v),R=!0)},o(v){G(o.$$.fragment,v),G(u.$$.fragment,v),G(b.$$.fragment,v),G(E.$$.fragment,v),G(d.$$.fragment,v),G(N.$$.fragment,v),R=!1},d(v){v&&h(e),ee(o),ee(u),ee(b),ee(E),ee(d),ee(N)}}}function nn(i){let e,n,t=i[0]&&Dt(i);return{c(){t&&t.c(),e=ve()},l(a){t&&t.l(a),e=ve()},m(a,l){t&&t.m(a,l),z(a,e,l),n=!0},p(a,[l]){a[0]?t?(t.p(a,l),l&1&&$(t,1)):(t=Dt(a),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(Ie(),G(t,1,1,()=>{t=null}),De())},i(a){n||($(t),n=!0)},o(a){G(t),n=!1},d(a){a&&h(e),t&&t.d(a)}}}function an(i,e,n){let t;ye(i,st,l=>n(1,t=l));let{visible:a=!0}=e;return i.$$set=l=>{"visible"in l&&n(0,a=l.visible)},[a,t]}class ln extends Be{constructor(e){super(),Pe(this,e,an,nn,Le,{visible:0})}}function Rt(i){let e,n,t,a="TUNING",l,r,o=i[1]?"":"+",s,f,u,c,g,b,_,M,E,k,L,d,C,y,N,R,v,A;function F(D){i[5](D)}let O={label:"Sens",min:0,max:2,formatValue:i[3]};i[2].sensitivity!==void 0&&(O.value=i[2].sensitivity),g=new Ee({props:O}),pe.push(()=>_e(g,"value",F));function X(D){i[6](D)}let Z={label:"Beat",min:0,max:2,formatValue:i[3]};i[2].beatBoost!==void 0&&(Z.value=i[2].beatBoost),E=new Ee({props:Z}),pe.push(()=>_e(E,"value",X));function Y(D){i[7](D)}let q={label:"Gate",min:0,max:1,formatValue:i[3]};i[2].beatGate!==void 0&&(q.value=i[2].beatGate),C=new Ee({props:q}),pe.push(()=>_e(C,"value",Y));let I=i[1]&&At(i);return{c(){e=T("div"),n=T("div"),t=T("span"),t.textContent=a,l=V(),r=T("button"),s=J(o),f=V(),u=T("div"),c=T("div"),ne(g.$$.fragment),_=V(),M=T("div"),ne(E.$$.fragment),L=V(),d=T("div"),ne(C.$$.fragment),N=V(),I&&I.c(),this.h()},l(D){e=w(D,"DIV",{class:!0});var P=B(e);n=w(P,"DIV",{class:!0});var H=B(n);t=w(H,"SPAN",{class:!0,title:!0,"data-svelte-h":!0}),me(t)!=="svelte-hff578"&&(t.textContent=a),l=U(H),r=w(H,"BUTTON",{class:!0,title:!0});var ae=B(r);s=Q(ae,o),ae.forEach(h),H.forEach(h),f=U(P),u=w(P,"DIV",{class:!0});var W=B(u);c=w(W,"DIV",{title:!0});var se=B(c);ie(g.$$.fragment,se),se.forEach(h),_=U(W),M=w(W,"DIV",{title:!0});var he=B(M);ie(E.$$.fragment,he),he.forEach(h),L=U(W),d=w(W,"DIV",{title:!0});var Se=B(d);ie(C.$$.fragment,Se),Se.forEach(h),N=U(W),I&&I.l(W),W.forEach(h),P.forEach(h),this.h()},h(){m(t,"class","panel-title svelte-1rkomi4"),m(t,"title","Adjust how visuals respond to audio"),m(r,"class","toggle-advanced svelte-1rkomi4"),m(r,"title","Show more advanced audio controls"),m(n,"class","panel-header svelte-1rkomi4"),m(c,"title","Overall sensitivity - how much visuals react to sound"),m(M,"title","Beat boost - make beat reactions stronger or weaker"),m(d,"title","Beat gate - ignore quiet sounds, only react to loud beats"),m(u,"class","tuning-grid svelte-1rkomi4"),m(e,"class","panel tuning-panel svelte-1rkomi4")},m(D,P){z(D,e,P),p(e,n),p(n,t),p(n,l),p(n,r),p(r,s),p(e,f),p(e,u),p(u,c),te(g,c,null),p(u,_),p(u,M),te(E,M,null),p(u,L),p(u,d),te(C,d,null),p(u,N),I&&I.m(u,null),R=!0,v||(A=le(r,"click",i[4]),v=!0)},p(D,P){(!R||P&2)&&o!==(o=D[1]?"":"+")&&de(s,o);const H={};!b&&P&4&&(b=!0,H.value=D[2].sensitivity,be(()=>b=!1)),g.$set(H);const ae={};!k&&P&4&&(k=!0,ae.value=D[2].beatBoost,be(()=>k=!1)),E.$set(ae);const W={};!y&&P&4&&(y=!0,W.value=D[2].beatGate,be(()=>y=!1)),C.$set(W),D[1]?I?(I.p(D,P),P&2&&$(I,1)):(I=At(D),I.c(),$(I,1),I.m(u,null)):I&&(Ie(),G(I,1,1,()=>{I=null}),De())},i(D){R||($(g.$$.fragment,D),$(E.$$.fragment,D),$(C.$$.fragment,D),$(I),R=!0)},o(D){G(g.$$.fragment,D),G(E.$$.fragment,D),G(C.$$.fragment,D),G(I),R=!1},d(D){D&&h(e),ee(g),ee(E),ee(C),I&&I.d(),v=!1,A()}}}function At(i){let e,n,t,a,l,r,o,s,f,u,c,g,b,_,M,E,k,L,d,C,y,N,R,v,A,F,O,X,Z,Y,q,I,D,P;function H(S){i[8](S)}let ae={label:"Hi+",min:0,max:2,formatValue:i[3]};i[2].highsBoost!==void 0&&(ae.value=i[2].highsBoost),a=new Ee({props:ae}),pe.push(()=>_e(a,"value",H));function W(S){i[9](S)}let se={label:"Mid+",min:0,max:2,formatValue:i[3]};i[2].midsBoost!==void 0&&(se.value=i[2].midsBoost),s=new Ee({props:se}),pe.push(()=>_e(s,"value",W));function he(S){i[10](S)}let Se={label:"Low+",min:0,max:2,formatValue:i[3]};i[2].lowsBoost!==void 0&&(Se.value=i[2].lowsBoost),g=new Ee({props:Se}),pe.push(()=>_e(g,"value",he));function fe(S){i[11](S)}let oe={label:"Trbl",min:0,max:2,formatValue:i[3]};i[2].trebleBoost!==void 0&&(oe.value=i[2].trebleBoost),E=new Ee({props:oe}),pe.push(()=>_e(E,"value",fe));function Ke(S){i[12](S)}let $e={label:"Bass",min:0,max:2,formatValue:i[3]};i[2].bassBoost!==void 0&&($e.value=i[2].bassBoost),C=new Ee({props:$e}),pe.push(()=>_e(C,"value",Ke));function we(S){i[13](S)}let x={label:"Min",min:0,max:.1,step:.005,formatValue:i[3]};i[2].minMotion!==void 0&&(x.value=i[2].minMotion),v=new Ee({props:x}),pe.push(()=>_e(v,"value",we));function re(S){i[14](S)}let qe={label:"Auto Suggest"};i[2].autoEnabled!==void 0&&(qe.checked=i[2].autoEnabled),Y=new Wt({props:qe}),pe.push(()=>_e(Y,"checked",re));let ue=i[2].autoEnabled&&Ct(i);return{c(){e=T("div"),n=V(),t=T("div"),ne(a.$$.fragment),r=V(),o=T("div"),ne(s.$$.fragment),u=V(),c=T("div"),ne(g.$$.fragment),_=V(),M=T("div"),ne(E.$$.fragment),L=V(),d=T("div"),ne(C.$$.fragment),N=V(),R=T("div"),ne(v.$$.fragment),F=V(),O=T("div"),X=V(),Z=T("div"),ne(Y.$$.fragment),I=V(),ue&&ue.c(),D=ve(),this.h()},l(S){e=w(S,"DIV",{class:!0}),B(e).forEach(h),n=U(S),t=w(S,"DIV",{title:!0});var K=B(t);ie(a.$$.fragment,K),K.forEach(h),r=U(S),o=w(S,"DIV",{title:!0});var Fe=B(o);ie(s.$$.fragment,Fe),Fe.forEach(h),u=U(S),c=w(S,"DIV",{title:!0});var Re=B(c);ie(g.$$.fragment,Re),Re.forEach(h),_=U(S),M=w(S,"DIV",{title:!0});var Me=B(M);ie(E.$$.fragment,Me),Me.forEach(h),L=U(S),d=w(S,"DIV",{title:!0});var Ue=B(d);ie(C.$$.fragment,Ue),Ue.forEach(h),N=U(S),R=w(S,"DIV",{title:!0});var Ve=B(R);ie(v.$$.fragment,Ve),Ve.forEach(h),F=U(S),O=w(S,"DIV",{class:!0}),B(O).forEach(h),X=U(S),Z=w(S,"DIV",{title:!0});var ze=B(Z);ie(Y.$$.fragment,ze),ze.forEach(h),I=U(S),ue&&ue.l(S),D=ve(),this.h()},h(){m(e,"class","divider svelte-1rkomi4"),m(t,"title","Boost high frequency response (cymbals, hi-hats)"),m(o,"title","Boost mid frequency response (vocals, guitars)"),m(c,"title","Boost low frequency response (bass, kick drums)"),m(M,"title","Boost treble (bright, high-pitched sounds)"),m(d,"title","Boost bass (deep, low-pitched sounds)"),m(R,"title","Minimum motion - keep some movement even in silence"),m(O,"class","divider svelte-1rkomi4"),m(Z,"title","Automatically adjust settings based on audio levels")},m(S,K){z(S,e,K),z(S,n,K),z(S,t,K),te(a,t,null),z(S,r,K),z(S,o,K),te(s,o,null),z(S,u,K),z(S,c,K),te(g,c,null),z(S,_,K),z(S,M,K),te(E,M,null),z(S,L,K),z(S,d,K),te(C,d,null),z(S,N,K),z(S,R,K),te(v,R,null),z(S,F,K),z(S,O,K),z(S,X,K),z(S,Z,K),te(Y,Z,null),z(S,I,K),ue&&ue.m(S,K),z(S,D,K),P=!0},p(S,K){const Fe={};!l&&K&4&&(l=!0,Fe.value=S[2].highsBoost,be(()=>l=!1)),a.$set(Fe);const Re={};!f&&K&4&&(f=!0,Re.value=S[2].midsBoost,be(()=>f=!1)),s.$set(Re);const Me={};!b&&K&4&&(b=!0,Me.value=S[2].lowsBoost,be(()=>b=!1)),g.$set(Me);const Ue={};!k&&K&4&&(k=!0,Ue.value=S[2].trebleBoost,be(()=>k=!1)),E.$set(Ue);const Ve={};!y&&K&4&&(y=!0,Ve.value=S[2].bassBoost,be(()=>y=!1)),C.$set(Ve);const ze={};!A&&K&4&&(A=!0,ze.value=S[2].minMotion,be(()=>A=!1)),v.$set(ze);const ot={};!q&&K&4&&(q=!0,ot.checked=S[2].autoEnabled,be(()=>q=!1)),Y.$set(ot),S[2].autoEnabled?ue?(ue.p(S,K),K&4&&$(ue,1)):(ue=Ct(S),ue.c(),$(ue,1),ue.m(D.parentNode,D)):ue&&(Ie(),G(ue,1,1,()=>{ue=null}),De())},i(S){P||($(a.$$.fragment,S),$(s.$$.fragment,S),$(g.$$.fragment,S),$(E.$$.fragment,S),$(C.$$.fragment,S),$(v.$$.fragment,S),$(Y.$$.fragment,S),$(ue),P=!0)},o(S){G(a.$$.fragment,S),G(s.$$.fragment,S),G(g.$$.fragment,S),G(E.$$.fragment,S),G(C.$$.fragment,S),G(v.$$.fragment,S),G(Y.$$.fragment,S),G(ue),P=!1},d(S){S&&(h(e),h(n),h(t),h(r),h(o),h(u),h(c),h(_),h(M),h(L),h(d),h(N),h(R),h(F),h(O),h(X),h(Z),h(I),h(D)),ee(a),ee(s),ee(g),ee(E),ee(C),ee(v),ee(Y),ue&&ue.d(S)}}}function Ct(i){let e,n,t,a,l,r,o,s,f,u,c,g;function b(d){i[15](d)}let _={label:"Str",min:0,max:1,formatValue:i[3]};i[2].autoStrength!==void 0&&(_.value=i[2].autoStrength),n=new Ee({props:_}),pe.push(()=>_e(n,"value",b));function M(d){i[16](d)}let E={label:"Dec",min:0,max:1,formatValue:i[3]};i[2].autoDecay!==void 0&&(E.value=i[2].autoDecay),r=new Ee({props:E}),pe.push(()=>_e(r,"value",M));function k(d){i[17](d)}let L={label:"Tgt",options:[{value:"all",label:"All"},{value:"energy",label:"Energy"},{value:"treble",label:"Treble"},{value:"beat",label:"Beat"}]};return i[2].autoTarget!==void 0&&(L.value=i[2].autoTarget),u=new Kt({props:L}),pe.push(()=>_e(u,"value",k)),{c(){e=T("div"),ne(n.$$.fragment),a=V(),l=T("div"),ne(r.$$.fragment),s=V(),f=T("div"),ne(u.$$.fragment),this.h()},l(d){e=w(d,"DIV",{title:!0});var C=B(e);ie(n.$$.fragment,C),C.forEach(h),a=U(d),l=w(d,"DIV",{title:!0});var y=B(l);ie(r.$$.fragment,y),y.forEach(h),s=U(d),f=w(d,"DIV",{title:!0});var N=B(f);ie(u.$$.fragment,N),N.forEach(h),this.h()},h(){m(e,"title","How strongly auto-adjust affects the visuals"),m(l,"title","How quickly auto-adjustments fade back to normal"),m(f,"title","Which audio metric to use for auto-adjustment")},m(d,C){z(d,e,C),te(n,e,null),z(d,a,C),z(d,l,C),te(r,l,null),z(d,s,C),z(d,f,C),te(u,f,null),g=!0},p(d,C){const y={};!t&&C&4&&(t=!0,y.value=d[2].autoStrength,be(()=>t=!1)),n.$set(y);const N={};!o&&C&4&&(o=!0,N.value=d[2].autoDecay,be(()=>o=!1)),r.$set(N);const R={};!c&&C&4&&(c=!0,R.value=d[2].autoTarget,be(()=>c=!1)),u.$set(R)},i(d){g||($(n.$$.fragment,d),$(r.$$.fragment,d),$(u.$$.fragment,d),g=!0)},o(d){G(n.$$.fragment,d),G(r.$$.fragment,d),G(u.$$.fragment,d),g=!1},d(d){d&&(h(e),h(a),h(l),h(s),h(f)),ee(n),ee(r),ee(u)}}}function sn(i){let e,n,t=i[0]&&Rt(i);return{c(){t&&t.c(),e=ve()},l(a){t&&t.l(a),e=ve()},m(a,l){t&&t.m(a,l),z(a,e,l),n=!0},p(a,[l]){a[0]?t?(t.p(a,l),l&1&&$(t,1)):(t=Rt(a),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(Ie(),G(t,1,1,()=>{t=null}),De())},i(a){n||($(t),n=!0)},o(a){G(t),n=!1},d(a){a&&h(e),t&&t.d(a)}}}function rn(i,e,n){let t;ye(i,ge,y=>n(2,t=y));let{visible:a=!0}=e,l=!1;const r=y=>`${Math.round(y*100)}%`,o=()=>n(1,l=!l);function s(y){i.$$.not_equal(t.sensitivity,y)&&(t.sensitivity=y,ge.set(t))}function f(y){i.$$.not_equal(t.beatBoost,y)&&(t.beatBoost=y,ge.set(t))}function u(y){i.$$.not_equal(t.beatGate,y)&&(t.beatGate=y,ge.set(t))}function c(y){i.$$.not_equal(t.highsBoost,y)&&(t.highsBoost=y,ge.set(t))}function g(y){i.$$.not_equal(t.midsBoost,y)&&(t.midsBoost=y,ge.set(t))}function b(y){i.$$.not_equal(t.lowsBoost,y)&&(t.lowsBoost=y,ge.set(t))}function _(y){i.$$.not_equal(t.trebleBoost,y)&&(t.trebleBoost=y,ge.set(t))}function M(y){i.$$.not_equal(t.bassBoost,y)&&(t.bassBoost=y,ge.set(t))}function E(y){i.$$.not_equal(t.minMotion,y)&&(t.minMotion=y,ge.set(t))}function k(y){i.$$.not_equal(t.autoEnabled,y)&&(t.autoEnabled=y,ge.set(t))}function L(y){i.$$.not_equal(t.autoStrength,y)&&(t.autoStrength=y,ge.set(t))}function d(y){i.$$.not_equal(t.autoDecay,y)&&(t.autoDecay=y,ge.set(t))}function C(y){i.$$.not_equal(t.autoTarget,y)&&(t.autoTarget=y,ge.set(t))}return i.$$set=y=>{"visible"in y&&n(0,a=y.visible)},[a,l,t,r,o,s,f,u,c,g,b,_,M,E,k,L,d,C]}class on extends Be{constructor(e){super(),Pe(this,e,rn,sn,Le,{visible:0})}}function Ft(i){let e,n,t,a="PERFORMANCE",l,r,o=i[4]?"":"+",s,f,u,c,g,b="FPS",_,M,E=i[2].fps+"",k,L,d,C,y,N,R,v,A="Frame",F,O,X=i[2].frameTime.toFixed(1)+"",Z,Y,q,I="ms",D,P,H,ae,W,se,he,Se,fe=i[7]&&i[5]>0&&Ut(i),oe=i[4]&&Vt(i);function Ke(x,re){return x[7]?fn:un}let $e=Ke(i),we=$e(i);return{c(){e=T("div"),n=T("div"),t=T("span"),t.textContent=a,l=V(),r=T("button"),s=J(o),f=V(),u=T("div"),c=T("div"),g=T("span"),g.textContent=b,_=V(),M=T("span"),k=J(E),L=V(),d=T("span"),C=J("/ "),y=J(i[1]),N=V(),R=T("div"),v=T("span"),v.textContent=A,F=V(),O=T("span"),Z=J(X),Y=V(),q=T("span"),q.textContent=I,D=V(),fe&&fe.c(),P=V(),oe&&oe.c(),H=V(),ae=T("div"),W=T("span"),we.c(),this.h()},l(x){e=w(x,"DIV",{class:!0});var re=B(e);n=w(re,"DIV",{class:!0});var qe=B(n);t=w(qe,"SPAN",{class:!0,"data-svelte-h":!0}),me(t)!=="svelte-18fq72a"&&(t.textContent=a),l=U(qe),r=w(qe,"BUTTON",{class:!0,title:!0});var ue=B(r);s=Q(ue,o),ue.forEach(h),qe.forEach(h),f=U(re),u=w(re,"DIV",{class:!0});var S=B(u);c=w(S,"DIV",{class:!0});var K=B(c);g=w(K,"SPAN",{class:!0,"data-svelte-h":!0}),me(g)!=="svelte-1bu4eeu"&&(g.textContent=b),_=U(K),M=w(K,"SPAN",{class:!0,style:!0});var Fe=B(M);k=Q(Fe,E),Fe.forEach(h),L=U(K),d=w(K,"SPAN",{class:!0});var Re=B(d);C=Q(Re,"/ "),y=Q(Re,i[1]),Re.forEach(h),K.forEach(h),N=U(S),R=w(S,"DIV",{class:!0});var Me=B(R);v=w(Me,"SPAN",{class:!0,"data-svelte-h":!0}),me(v)!=="svelte-1ikbzr0"&&(v.textContent=A),F=U(Me),O=w(Me,"SPAN",{class:!0});var Ue=B(O);Z=Q(Ue,X),Ue.forEach(h),Y=U(Me),q=w(Me,"SPAN",{class:!0,"data-svelte-h":!0}),me(q)!=="svelte-13w5gq7"&&(q.textContent=I),Me.forEach(h),D=U(S),fe&&fe.l(S),S.forEach(h),P=U(re),oe&&oe.l(re),H=U(re),ae=w(re,"DIV",{class:!0});var Ve=B(ae);W=w(Ve,"SPAN",{class:!0});var ze=B(W);we.l(ze),ze.forEach(h),Ve.forEach(h),re.forEach(h),this.h()},h(){m(t,"class","panel-title svelte-j1uypr"),m(r,"class","toggle-controls svelte-j1uypr"),m(r,"title","Show performance controls"),m(n,"class","panel-header svelte-j1uypr"),m(g,"class","label svelte-j1uypr"),m(M,"class","value svelte-j1uypr"),Ze(M,"color",i[6]),m(d,"class","target svelte-j1uypr"),m(c,"class","stat svelte-j1uypr"),m(v,"class","label svelte-j1uypr"),m(O,"class","value svelte-j1uypr"),m(q,"class","unit svelte-j1uypr"),m(R,"class","stat svelte-j1uypr"),m(u,"class","stats-grid svelte-j1uypr"),m(W,"class","hint svelte-j1uypr"),m(ae,"class","panel-footer svelte-j1uypr"),m(e,"class","panel perf-panel svelte-j1uypr"),j(e,"power-saver",i[7])},m(x,re){z(x,e,re),p(e,n),p(n,t),p(n,l),p(n,r),p(r,s),p(e,f),p(e,u),p(u,c),p(c,g),p(c,_),p(c,M),p(M,k),p(c,L),p(c,d),p(d,C),p(d,y),p(u,N),p(u,R),p(R,v),p(R,F),p(R,O),p(O,Z),p(R,Y),p(R,q),p(u,D),fe&&fe.m(u,null),p(e,P),oe&&oe.m(e,null),p(e,H),p(e,ae),p(ae,W),we.m(W,null),se=!0,he||(Se=le(r,"click",i[10]),he=!0)},p(x,re){(!se||re&16)&&o!==(o=x[4]?"":"+")&&de(s,o),(!se||re&4)&&E!==(E=x[2].fps+"")&&de(k,E),(!se||re&64)&&Ze(M,"color",x[6]),(!se||re&2)&&de(y,x[1]),(!se||re&4)&&X!==(X=x[2].frameTime.toFixed(1)+"")&&de(Z,X),x[7]&&x[5]>0?fe?fe.p(x,re):(fe=Ut(x),fe.c(),fe.m(u,null)):fe&&(fe.d(1),fe=null),x[4]?oe?(oe.p(x,re),re&16&&$(oe,1)):(oe=Vt(x),oe.c(),$(oe,1),oe.m(e,H)):oe&&(Ie(),G(oe,1,1,()=>{oe=null}),De()),$e===($e=Ke(x))&&we?we.p(x,re):(we.d(1),we=$e(x),we&&(we.c(),we.m(W,null))),(!se||re&128)&&j(e,"power-saver",x[7])},i(x){se||($(oe),se=!0)},o(x){G(oe),se=!1},d(x){x&&h(e),fe&&fe.d(),oe&&oe.d(),we.d(),he=!1,Se()}}}function Ut(i){let e,n,t="Saved",a,l,r,o,s;return{c(){e=T("div"),n=T("span"),n.textContent=t,a=V(),l=T("span"),r=J("~"),o=J(i[5]),s=J("%"),this.h()},l(f){e=w(f,"DIV",{class:!0});var u=B(e);n=w(u,"SPAN",{class:!0,"data-svelte-h":!0}),me(n)!=="svelte-dz9cv6"&&(n.textContent=t),a=U(u),l=w(u,"SPAN",{class:!0});var c=B(l);r=Q(c,"~"),o=Q(c,i[5]),s=Q(c,"%"),c.forEach(h),u.forEach(h),this.h()},h(){m(n,"class","label svelte-j1uypr"),m(l,"class","value success svelte-j1uypr"),m(e,"class","stat savings svelte-j1uypr")},m(f,u){z(f,e,u),p(e,n),p(e,a),p(e,l),p(l,r),p(l,o),p(l,s)},p(f,u){u&32&&de(o,f[5])},d(f){f&&h(e)}}}function Vt(i){let e,n,t,a,l,r,o,s,f,u,c,g,b,_="Quick:",M,E,k="Mobile",L,d,C="Laptop",y,N,R="Desktop",v,A,F;function O(q){i[11](q)}let X={label:"Power Saver"};i[3].powerSaverEnabled!==void 0&&(X.checked=i[3].powerSaverEnabled),l=new Wt({props:X}),pe.push(()=>_e(l,"checked",O));function Z(q){i[12](q)}let Y={label:"Target",min:15,max:60,step:5,formatValue:i[8]};return i[3].targetFps!==void 0&&(Y.value=i[3].targetFps),f=new Ee({props:Y}),pe.push(()=>_e(f,"value",Z)),{c(){e=T("div"),n=V(),t=T("div"),a=T("div"),ne(l.$$.fragment),o=V(),s=T("div"),ne(f.$$.fragment),c=V(),g=T("div"),b=T("span"),b.textContent=_,M=V(),E=T("button"),E.textContent=k,L=V(),d=T("button"),d.textContent=C,y=V(),N=T("button"),N.textContent=R,this.h()},l(q){e=w(q,"DIV",{class:!0}),B(e).forEach(h),n=U(q),t=w(q,"DIV",{class:!0});var I=B(t);a=w(I,"DIV",{title:!0});var D=B(a);ie(l.$$.fragment,D),D.forEach(h),o=U(I),s=w(I,"DIV",{title:!0});var P=B(s);ie(f.$$.fragment,P),P.forEach(h),c=U(I),g=w(I,"DIV",{class:!0});var H=B(g);b=w(H,"SPAN",{class:!0,"data-svelte-h":!0}),me(b)!=="svelte-9ap1jd"&&(b.textContent=_),M=U(H),E=w(H,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),me(E)!=="svelte-211gfj"&&(E.textContent=k),L=U(H),d=w(H,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),me(d)!=="svelte-mfdn79"&&(d.textContent=C),y=U(H),N=w(H,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),me(N)!=="svelte-13c6eed"&&(N.textContent=R),H.forEach(h),I.forEach(h),this.h()},h(){m(e,"class","divider svelte-j1uypr"),m(a,"title","Enable power saving mode to limit frame rate"),m(s,"title","Target frames per second - lower values save more battery"),m(b,"class","presets-label svelte-j1uypr"),m(E,"class","preset-btn svelte-j1uypr"),m(E,"title","24fps - Best for phones and old devices"),j(E,"active",i[1]<=24),m(d,"class","preset-btn svelte-j1uypr"),m(d,"title","30fps - Good for laptops on battery"),j(d,"active",i[1]===30),m(N,"class","preset-btn svelte-j1uypr"),m(N,"title","60fps - Full quality for desktops"),j(N,"active",i[1]>=60&&!i[7]),m(g,"class","presets svelte-j1uypr"),m(t,"class","controls-grid svelte-j1uypr")},m(q,I){z(q,e,I),z(q,n,I),z(q,t,I),p(t,a),te(l,a,null),p(t,o),p(t,s),te(f,s,null),p(t,c),p(t,g),p(g,b),p(g,M),p(g,E),p(g,L),p(g,d),p(g,y),p(g,N),v=!0,A||(F=[le(E,"click",i[13]),le(d,"click",i[14]),le(N,"click",i[15])],A=!0)},p(q,I){const D={};!r&&I&8&&(r=!0,D.checked=q[3].powerSaverEnabled,be(()=>r=!1)),l.$set(D);const P={};!u&&I&8&&(u=!0,P.value=q[3].targetFps,be(()=>u=!1)),f.$set(P),(!v||I&2)&&j(E,"active",q[1]<=24),(!v||I&2)&&j(d,"active",q[1]===30),(!v||I&130)&&j(N,"active",q[1]>=60&&!q[7])},i(q){v||($(l.$$.fragment,q),$(f.$$.fragment,q),v=!0)},o(q){G(l.$$.fragment,q),G(f.$$.fragment,q),v=!1},d(q){q&&(h(e),h(n),h(t)),ee(l),ee(f),A=!1,Oe(F)}}}function un(i){let e,n;return{c(){e=J(i[1]),n=J("fps target (full quality)")},l(t){e=Q(t,i[1]),n=Q(t,"fps target (full quality)")},m(t,a){z(t,e,a),z(t,n,a)},p(t,a){a&2&&de(e,t[1])},d(t){t&&(h(e),h(n))}}}function fn(i){let e,n,t,a;return{c(){e=J(i[1]),n=J("fps target ("),t=J(i[5]),a=J("% less GPU work)")},l(l){e=Q(l,i[1]),n=Q(l,"fps target ("),t=Q(l,i[5]),a=Q(l,"% less GPU work)")},m(l,r){z(l,e,r),z(l,n,r),z(l,t,r),z(l,a,r)},p(l,r){r&2&&de(e,l[1]),r&32&&de(t,l[5])},d(l){l&&(h(e),h(n),h(t),h(a))}}}function cn(i){let e,n,t=i[0]&&Ft(i);return{c(){t&&t.c(),e=ve()},l(a){t&&t.l(a),e=ve()},m(a,l){t&&t.m(a,l),z(a,e,l),n=!0},p(a,[l]){a[0]?t?(t.p(a,l),l&1&&$(t,1)):(t=Ft(a),t.c(),$(t,1),t.m(e.parentNode,e)):t&&(Ie(),G(t,1,1,()=>{t=null}),De())},i(a){n||($(t),n=!0)},o(a){G(t),n=!1},d(a){a&&h(e),t&&t.d(a)}}}function dn(i,e,n){let t,a,l,r,o,s;ye(i,Yt,d=>n(2,o=d)),ye(i,ce,d=>n(3,s=d));let{visible:f=!0}=e,u=!1;const c=d=>`${Math.round(d)}`;function g(d){ce.update(C=>{switch(d){case"mobile":return{...C,powerSaverEnabled:!0,targetFps:24};case"laptop":return{...C,powerSaverEnabled:!0,targetFps:30};case"desktop":return{...C,powerSaverEnabled:!1,targetFps:60};default:return C}})}const b=()=>n(4,u=!u);function _(d){i.$$.not_equal(s.powerSaverEnabled,d)&&(s.powerSaverEnabled=d,ce.set(s))}function M(d){i.$$.not_equal(s.targetFps,d)&&(s.targetFps=d,ce.set(s))}const E=()=>g("mobile"),k=()=>g("laptop"),L=()=>g("desktop");return i.$$set=d=>{"visible"in d&&n(0,f=d.visible)},i.$$.update=()=>{i.$$.dirty&8&&n(7,t=s.powerSaverEnabled),i.$$.dirty&8&&n(1,a=s.targetFps),i.$$.dirty&6&&n(6,l=o.fps>=a*.9?"var(--color-success)":o.fps>=a*.5?"var(--color-warning, #f59e0b)":"var(--color-error, #ef4444)"),i.$$.dirty&2&&n(5,r=Math.round((1-a/60)*100))},[f,a,o,s,u,r,l,t,c,g,b,_,M,E,k,L]}class mn extends Be{constructor(e){super(),Pe(this,e,dn,cn,Le,{visible:0})}}function hn(i){let e,n,t,a,l,r,o,s,f,u,c,g,b,_,M,E={};return n=new Ui({props:E}),i[4](n),a=new Ki({props:{onEnableMic:i[2],visible:i[1].panelsVisible}}),r=new tn({props:{visible:i[1].panelsVisible}}),s=new ln({props:{visible:i[1].panelsVisible}}),u=new on({props:{visible:i[1].panelsVisible}}),g=new mn({props:{visible:i[1].panelsVisible}}),{c(){e=T("main"),ne(n.$$.fragment),t=V(),ne(a.$$.fragment),l=V(),ne(r.$$.fragment),o=V(),ne(s.$$.fragment),f=V(),ne(u.$$.fragment),c=V(),ne(g.$$.fragment),this.h()},l(k){e=w(k,"MAIN",{class:!0});var L=B(e);ie(n.$$.fragment,L),t=U(L),ie(a.$$.fragment,L),l=U(L),ie(r.$$.fragment,L),o=U(L),ie(s.$$.fragment,L),f=U(L),ie(u.$$.fragment,L),c=U(L),ie(g.$$.fragment,L),L.forEach(h),this.h()},h(){m(e,"class","app svelte-1hyx21c")},m(k,L){z(k,e,L),te(n,e,null),p(e,t),te(a,e,null),p(e,l),te(r,e,null),p(e,o),te(s,e,null),p(e,f),te(u,e,null),p(e,c),te(g,e,null),b=!0,_||(M=le(window,"keydown",i[3]),_=!0)},p(k,[L]){const d={};n.$set(d);const C={};L&2&&(C.visible=k[1].panelsVisible),a.$set(C);const y={};L&2&&(y.visible=k[1].panelsVisible),r.$set(y);const N={};L&2&&(N.visible=k[1].panelsVisible),s.$set(N);const R={};L&2&&(R.visible=k[1].panelsVisible),u.$set(R);const v={};L&2&&(v.visible=k[1].panelsVisible),g.$set(v)},i(k){b||($(n.$$.fragment,k),$(a.$$.fragment,k),$(r.$$.fragment,k),$(s.$$.fragment,k),$(u.$$.fragment,k),$(g.$$.fragment,k),b=!0)},o(k){G(n.$$.fragment,k),G(a.$$.fragment,k),G(r.$$.fragment,k),G(s.$$.fragment,k),G(u.$$.fragment,k),G(g.$$.fragment,k),b=!1},d(k){k&&h(e),i[4](null),ee(n),ee(a),ee(r),ee(s),ee(u),ee(g),_=!1,M()}}}function pn(i,e,n){let t;ye(i,ce,u=>n(1,t=u));let a;async function l(){return a?await a.enableMicrophone():!1}function r(u){if(!(u.target instanceof HTMLInputElement||u.target instanceof HTMLTextAreaElement))switch(u.key.toLowerCase()){case"c":di();break;case"f":o();break}}async function o(){document.fullscreenElement?(await document.exitFullscreen(),ce.update(u=>({...u,fullscreen:!1}))):(await document.documentElement.requestFullscreen(),ce.update(u=>({...u,fullscreen:!0})))}function s(){ce.update(u=>({...u,fullscreen:!!document.fullscreenElement}))}zt(()=>(document.addEventListener("fullscreenchange",s),setTimeout(()=>{l()},500),()=>{document.removeEventListener("fullscreenchange",s)}));function f(u){pe[u?"unshift":"push"](()=>{a=u,n(0,a)})}return[a,t,l,r,f]}class _n extends Be{constructor(e){super(),Pe(this,e,pn,hn,Le,{})}}export{_n as component};
